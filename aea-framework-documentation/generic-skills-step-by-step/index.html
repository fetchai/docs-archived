
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Everything you need to know about Fetch.ai.">
      
      
        <meta name="author" content="developer@fetch.ai">
      
      
        <link rel="canonical" href="https://docs.fetch.ai/aea-framework-documentation/generic-skills-step-by-step/">
      
      
        <link rel="prev" href="../skill-guide/">
      
      
        <link rel="next" href="../skill-testing/">
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.11">
    
    
      
        <title>Trade between two AEAs - Developer Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/style.css">
    
      <link rel="stylesheet" href="../../css/termynal-fast.css">
    
      <link rel="stylesheet" href="../../css/admonitions.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-GYC9HYF1LD"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-GYC9HYF1LD",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-GYC9HYF1LD",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#trade-between-two-aeas" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
<!-- What you put here will be displayed as an announcement at the top of every page's header-->
<a href="/fund_form" class="announcement-link">
  <span class="twemoji">

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23 12-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68L23 12m-10 5h-2v-2h2v2m0-4h-2V7h2v6Z"/></svg>
</span> Apply for the $150M Developer Fund
</a>

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Developer Documentation" class="md-header__button md-logo" aria-label="Developer Documentation" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Developer Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Trade between two AEAs
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Overview
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../fetch-wallet/" class="md-tabs__link">
        Fetch wallet
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        AEA Framework
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../uAgents/" class="md-tabs__link">
        μAgents
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../CosmPy/" class="md-tabs__link">
        CosmPy
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Jenesis/" class="md-tabs__link">
        Jenesis
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../ledger_v2/" class="md-tabs__link">
        Ledger
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../ledger-subquery/introduction/" class="md-tabs__link">
        Indexer
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../create-react-app/introduction/" class="md-tabs__link">
        Create React App template
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../colearn/" class="md-tabs__link">
        Collective Learning
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../soef/simple-oef/" class="md-tabs__link">
        Archives
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Developer Documentation" class="md-nav__button md-logo" aria-label="Developer Documentation" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Developer Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        At a Glance
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
          Learn the Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Learn the Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../decentralisation/" class="md-nav__link">
        Decentralization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/peer_to_peer_systems/" class="md-nav__link">
        Peer-to-Peer Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/agent-based_and_multi-agents_systems/" class="md-nav__link">
        Agent-based and Multi-agents systems
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2_4" id="__nav_1_2_4_label" tabindex="0">
          Blockchains
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_2_4">
          <span class="md-nav__icon md-icon"></span>
          Blockchains
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/blockchains/what_is_a_blockchain/" class="md-nav__link">
        What is a Blockchain?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/blockchains/smart_contracts/" class="md-nav__link">
        Smart Contracts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/blockchains/decentralized_applications/" class="md-nav__link">
        Decentralized Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/blockchains/consensus/" class="md-nav__link">
        Consensus
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/blockchains/validators/" class="md-nav__link">
        Validators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/blockchains/transaction_fees/" class="md-nav__link">
        Transaction Fees
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/blockchains/oracles/" class="md-nav__link">
        Oracles
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
      
      
      
        <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
          Basics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          Basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1_3_1" id="__nav_1_3_1_label" tabindex="0">
          Wallet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_3_1">
          <span class="md-nav__icon md-icon"></span>
          Wallet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/wallet/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/wallet/how_to_use_wallet/" class="md-nav__link">
        How to Use
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_3_2" id="__nav_1_3_2_label" tabindex="0">
          Staking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_3_2">
          <span class="md-nav__icon md-icon"></span>
          Staking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/staking/what_is_staking/" class="md-nav__link">
        What is Staking?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/staking/how_to_stake/" class="md-nav__link">
        How to Stake
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/staking/redelegation/" class="md-nav__link">
        Re-Delegation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_1_3_3" id="__nav_1_3_3_label" tabindex="0">
          Native and ERC-20 FET
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_1_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_3_3">
          <span class="md-nav__icon md-icon"></span>
          Native and ERC-20 FET
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../native_and_erc20/native_and_erc20_fet/" class="md-nav__link">
        Native and ERC-20 FET
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../native_and_erc20/how_to_convert_fet/" class="md-nav__link">
        How to convert
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../native_and_erc20/reconciliation/" class="md-nav__link">
        Reconciliation service
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bug_bounty/" class="md-nav__link">
        Bug Bounty Program
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fund_form/" class="md-nav__link">
        Developer Fund
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_the_concepts/glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Fetch wallet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Fetch wallet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fetch-wallet/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fetch-wallet/account_management/" class="md-nav__link">
        Account Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fetch-wallet/deposit/" class="md-nav__link">
        Deposit Tokens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fetch-wallet/send_tokens/" class="md-nav__link">
        Send Tokens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fetch-wallet/migrate_erc20/" class="md-nav__link">
        Recover Migrated ETH Account
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fetch-wallet/stake/" class="md-nav__link">
        Staking
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
      
      
      
        <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
          Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fetch-wallet/address_book/" class="md-nav__link">
        Address Book
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fetch-wallet/connections/" class="md-nav__link">
        Connections
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          AEA Framework
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          AEA Framework
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          AEA Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          AEA Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aeas/" class="md-nav__link">
        Autonomous Economic Agents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../application/" class="md-nav__link">
        Application areas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ecosystem/" class="md-nav__link">
        Agent ecosystem
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          Installation and setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Installation and setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Setting up
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../development-setup/" class="md-nav__link">
        Development setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upgrading/" class="md-nav__link">
        Upgrading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../raspberry-set-up/" class="md-nav__link">
        Build an AEA on a Raspberry Pi
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-components/" class="md-nav__link">
        Core components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../step-one/" class="md-nav__link">
        Ways to build an AEA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build-aea-step-by-step/" class="md-nav__link">
        Build an AEA with the CLI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Architecture deep dives
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Architecture deep dives
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../language-agnostic-definition/" class="md-nav__link">
        Language Agnostic Definition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../diagram/" class="md-nav__link">
        Architectural diagram
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-components-1/" class="md-nav__link">
        Core components - Part 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core-components-2/" class="md-nav__link">
        Core components - Part 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4_5" id="__nav_3_4_5_label" tabindex="0">
          Comparisons
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4_5">
          <span class="md-nav__icon md-icon"></span>
          Comparisons
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aea-vs-mvc/" class="md-nav__link">
        AEA and web frameworks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../12-factor/" class="md-nav__link">
        12-Factor app and AEAs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../design-principles/" class="md-nav__link">
        Design principles
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Developing Agents
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Developing Agents
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../modes/" class="md-nav__link">
        Modes of running an AEA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multi-agent-manager/" class="md-nav__link">
        Multi agent manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        Debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../runtime-cost/" class="md-nav__link">
        Profiling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../performance-benchmark/" class="md-nav__link">
        Performance benchmark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        Security Considerations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          Developing Packages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Developing Packages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../package-imports/" class="md-nav__link">
        File structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scaffolding/" class="md-nav__link">
        Scaffolding packages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        Configurations
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_6_4" id="__nav_3_6_4_label" tabindex="0">
          Skills
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_6_4">
          <span class="md-nav__icon md-icon"></span>
          Skills
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../skill/" class="md-nav__link">
        Skills
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        AEA quick start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../skill-guide/" class="md-nav__link">
        Build your first skill - search & discovery
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Trade between two AEAs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Trade between two AEAs
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dependencies-required" class="md-nav__link">
    Dependencies (Required)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-code-optional" class="md-nav__link">
    Reference Code (Optional)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simplification-step" class="md-nav__link">
    Simplification Step
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generic-seller-aea" class="md-nav__link">
    Generic Seller AEA
  </a>
  
    <nav class="md-nav" aria-label="Generic Seller AEA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-the-aea" class="md-nav__link">
    Step 1: Create the AEA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-the-behaviour" class="md-nav__link">
    Step 2: Create the Behaviour
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-the-handler" class="md-nav__link">
    Step 3: Create the Handler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-the-strategy" class="md-nav__link">
    Step 4: Create the Strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-create-the-dialogues" class="md-nav__link">
    Step 5: Create the Dialogues
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-update-the-yaml-files" class="md-nav__link">
    Step 6: Update the YAML Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generic-buyer-aea" class="md-nav__link">
    Generic Buyer AEA
  </a>
  
    <nav class="md-nav" aria-label="Generic Buyer AEA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-the-aea_1" class="md-nav__link">
    Step 1: Create the AEA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-the-behaviour_1" class="md-nav__link">
    Step 2: Create the Behaviour
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-the-handler_1" class="md-nav__link">
    Step 3: Create the Handler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-the-strategy_1" class="md-nav__link">
    Step 4: Create the Strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-create-the-dialogues_1" class="md-nav__link">
    Step 5: Create the Dialogues
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-update-the-yaml-files_1" class="md-nav__link">
    Step 6: Update the YAML Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-the-aeas" class="md-nav__link">
    Run the AEAs
  </a>
  
    <nav class="md-nav" aria-label="Run the AEAs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-private-keys" class="md-nav__link">
    Create Private Keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-aea-configurations" class="md-nav__link">
    Update the AEA Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fund-the-buyer-aea" class="md-nav__link">
    Fund the Buyer AEA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-seller-aea" class="md-nav__link">
    Run Seller AEA
  </a>
  
    <nav class="md-nav" aria-label="Run Seller AEA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-buyer-aea" class="md-nav__link">
    Run Buyer AEA
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-the-aeas" class="md-nav__link">
    Delete the AEAs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
    <nav class="md-nav" aria-label="Next Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recommended" class="md-nav__link">
    Recommended
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../skill-testing/" class="md-nav__link">
        Testing Skills
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6_5" id="__nav_3_6_5_label" tabindex="0">
          Protocols
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6_5">
          <span class="md-nav__icon md-icon"></span>
          Protocols
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../protocol/" class="md-nav__link">
        Protocols
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../message-routing/" class="md-nav__link">
        Message routing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../protocol-generator/" class="md-nav__link">
        Generating protocols
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6_6" id="__nav_3_6_6_label" tabindex="0">
          Connections
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6_6">
          <span class="md-nav__icon md-icon"></span>
          Connections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../connection/" class="md-nav__link">
        Connections
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_7" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6_7" id="__nav_3_6_7_label" tabindex="0">
          Contracts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6_7">
          <span class="md-nav__icon md-icon"></span>
          Contracts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contract/" class="md-nav__link">
        Contracts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../erc1155-skills/" class="md-nav__link">
        Contract deploy and interact
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_8" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6_8" id="__nav_3_6_8_label" tabindex="0">
          Decision Maker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6_8">
          <span class="md-nav__icon md-icon"></span>
          Decision Maker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../decision-maker/" class="md-nav__link">
        Decision Maker
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_9" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6_9" id="__nav_3_6_9_label" tabindex="0">
          Ledger & Crypto APIs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6_9">
          <span class="md-nav__icon md-icon"></span>
          Ledger & Crypto APIs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ledger-integration/" class="md-nav__link">
        Ledger & Crypto APIs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
      
      
      
        <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
          Ecosystem
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Ecosystem
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_7_1" id="__nav_3_7_1_label" tabindex="0">
          Agent Communication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_7_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_7_1">
          <span class="md-nav__icon md-icon"></span>
          Agent Communication
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../acn/" class="md-nav__link">
        Agent Communication Network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../acn-internals/" class="md-nav__link">
        ACN Internals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../por/" class="md-nav__link">
        Proof of Representation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../p2p-connection/" class="md-nav__link">
        P2P Connection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_7_2" id="__nav_3_7_2_label" tabindex="0">
          Search & Discovery
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_7_2">
          <span class="md-nav__icon md-icon"></span>
          Search & Discovery
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../simple-oef/" class="md-nav__link">
        Simple OEF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../defining-data-models/" class="md-nav__link">
        Defining Data Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../query-language/" class="md-nav__link">
        The Query Language
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../simple-oef-usage/" class="md-nav__link">
        SOEF Connection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_7_3" id="__nav_3_7_3_label" tabindex="0">
          Integrations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_7_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_7_3">
          <span class="md-nav__icon md-icon"></span>
          Integrations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../connect-a-frontend/" class="md-nav__link">
        Front-end integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../orm-integration/" class="md-nav__link">
        ORM integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../generic-storage/" class="md-nav__link">
        Generic Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../prometheus/" class="md-nav__link">
        Prometheus monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wealth/" class="md-nav__link">
        Generating wealth
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
      
      
      
        <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../agent-oriented-development/" class="md-nav__link">
        Agent-oriented development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../interaction-protocol/" class="md-nav__link">
        Interaction protocols
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_8_3" id="__nav_3_8_3_label" tabindex="0">
          Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_8_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_8_3">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../identity/" class="md-nav__link">
        Identity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trust/" class="md-nav__link">
        Trust minimisation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_9" >
      
      
      
        <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
          Development - Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_9">
          <span class="md-nav__icon md-icon"></span>
          Development - Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build-aea-programmatically/" class="md-nav__link">
        Build an AEA programmatically
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli-vs-programmatic-aeas/" class="md-nav__link">
        CLI vs programmatic AEAs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../agent-vs-aea/" class="md-nav__link">
        AEAs vs agents
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multiplexer-standalone/" class="md-nav__link">
        Use multiplexer stand-alone
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../standalone-transaction/" class="md-nav__link">
        Create stand-alone transaction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../decision-maker-transaction/" class="md-nav__link">
        Create decision-maker transaction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" >
      
      
      
        <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="0">
          Demos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_10">
          <span class="md-nav__icon md-icon"></span>
          Demos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/" class="md-nav__link">
        Demos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../generic-skills/" class="md-nav__link">
        Generic skills
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../http-connection-and-skill/" class="md-nav__link">
        HTTP Connection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aries-cloud-agent-demo/" class="md-nav__link">
        Aries Cloud Agents Demo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../car-park-skills/" class="md-nav__link">
        Car park skills
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gym-example/" class="md-nav__link">
        Gym example
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gym-skill/" class="md-nav__link">
        Gym skill
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ml-skills/" class="md-nav__link">
        ML skills
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../oracle-demo/" class="md-nav__link">
        Oracle skills
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aggregation-demo/" class="md-nav__link">
        Aggregation skill
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tac-skills/" class="md-nav__link">
        TAC skills
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tac-skills-contract/" class="md-nav__link">
        TAC skills ledger-based
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../thermometer-skills/" class="md-nav__link">
        Thermometer skills
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../weather-skills/" class="md-nav__link">
        Weather skills
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11" id="__nav_3_11_label" tabindex="0">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli-commands/" class="md-nav__link">
        Command Line Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2" id="__nav_3_11_2_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_11_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/abstract_agent/" class="md-nav__link">
        AbstractAgent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/aea/" class="md-nav__link">
        AEA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/aea_builder/" class="md-nav__link">
        AEA Builder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/agent/" class="md-nav__link">
        Agent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/agent_loop/" class="md-nav__link">
        Agent Loop
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/common/" class="md-nav__link">
        Common
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/launcher/" class="md-nav__link">
        Launcher
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/multiplexer/" class="md-nav__link">
        Multiplexer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/runner/" class="md-nav__link">
        Runner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/runtime/" class="md-nav__link">
        Runtime
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_12" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_12" id="__nav_3_11_2_12_label" tabindex="0">
          Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_12_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_12">
          <span class="md-nav__icon md-icon"></span>
          Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/components/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/components/loader/" class="md-nav__link">
        Loader
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/components/utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_13" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_13" id="__nav_3_11_2_13_label" tabindex="0">
          Configurations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_13">
          <span class="md-nav__icon md-icon"></span>
          Configurations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/configurations/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/configurations/constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/configurations/data_types/" class="md-nav__link">
        Data Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/configurations/loader/" class="md-nav__link">
        Loader
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/configurations/manager/" class="md-nav__link">
        Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/configurations/pypi/" class="md-nav__link">
        Pypi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/configurations/utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/configurations/validation/" class="md-nav__link">
        Validation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_14" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_14" id="__nav_3_11_2_14_label" tabindex="0">
          Connections
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_14">
          <span class="md-nav__icon md-icon"></span>
          Connections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/connections/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/context/base/" class="md-nav__link">
        Context
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_16" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_16" id="__nav_3_11_2_16_label" tabindex="0">
          Contracts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_16_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_16">
          <span class="md-nav__icon md-icon"></span>
          Contracts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/contracts/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_17" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_17" id="__nav_3_11_2_17_label" tabindex="0">
          Crypto
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_17_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_17">
          <span class="md-nav__icon md-icon"></span>
          Crypto
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/crypto/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/crypto/helpers/" class="md-nav__link">
        Helpers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/crypto/ledger_apis/" class="md-nav__link">
        LedgerApis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/crypto/plugin/" class="md-nav__link">
        Plugin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/crypto/wallet/" class="md-nav__link">
        Wallet
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_17_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_17_6" id="__nav_3_11_2_17_6_label" tabindex="0">
          Registries
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_17_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_17_6">
          <span class="md-nav__icon md-icon"></span>
          Registries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/crypto/registries/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_18" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_18" id="__nav_3_11_2_18_label" tabindex="0">
          Decision Maker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_18_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_18">
          <span class="md-nav__icon md-icon"></span>
          Decision Maker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/decision_maker/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/decision_maker/default/" class="md-nav__link">
        Default
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/decision_maker/gop/" class="md-nav__link">
        GOP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_19" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_19" id="__nav_3_11_2_19_label" tabindex="0">
          Error Handler
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_19_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_19">
          <span class="md-nav__icon md-icon"></span>
          Error Handler
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/error_handler/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/error_handler/default/" class="md-nav__link">
        Default
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_20" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_20" id="__nav_3_11_2_20_label" tabindex="0">
          Helpers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_20_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_20">
          <span class="md-nav__icon md-icon"></span>
          Helpers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_20_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_20_1" id="__nav_3_11_2_20_1_label" tabindex="0">
          ACN
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_20_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_20_1">
          <span class="md-nav__icon md-icon"></span>
          ACN
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/acn/agent_record/" class="md-nav__link">
        Agent Record
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/acn/uri/" class="md-nav__link">
        URI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/async_friendly_queue/" class="md-nav__link">
        Async Friendly Queue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/async_utils/" class="md-nav__link">
        Async Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/env_vars/" class="md-nav__link">
        Env Vars
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/exception_policy/" class="md-nav__link">
        Exception Policy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/exec_timeout/" class="md-nav__link">
        Exec Timeout
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/file_io/" class="md-nav__link">
        File IO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/file_lock/" class="md-nav__link">
        File Lock
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/http_requests/" class="md-nav__link">
        HttpRequests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/install_dependency/" class="md-nav__link">
        Install Dependency
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/io/" class="md-nav__link">
        IO
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_20_14" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_20_14" id="__nav_3_11_2_20_14_label" tabindex="0">
          IPFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_20_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_20_14">
          <span class="md-nav__icon md-icon"></span>
          IPFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/ipfs/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/ipfs/utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_20_16" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_20_16" id="__nav_3_11_2_20_16_label" tabindex="0">
          MultiAddress
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_20_16_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_20_16">
          <span class="md-nav__icon md-icon"></span>
          MultiAddress
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/multiaddr/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/multiple_executor/" class="md-nav__link">
        MultipleExecutor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/pipe/" class="md-nav__link">
        Pipe
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_20_19" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_20_19" id="__nav_3_11_2_20_19_label" tabindex="0">
          Preferences
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_20_19_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_20_19">
          <span class="md-nav__icon md-icon"></span>
          Preferences
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/preference_representations/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/profiling/" class="md-nav__link">
        Profiling
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_20_21" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_20_21" id="__nav_3_11_2_20_21_label" tabindex="0">
          Search
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_20_21_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_20_21">
          <span class="md-nav__icon md-icon"></span>
          Search
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/search/generic/" class="md-nav__link">
        Generic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/search/models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/serializers/" class="md-nav__link">
        Serializers
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_20_23" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_20_23" id="__nav_3_11_2_20_23_label" tabindex="0">
          Storage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_20_23_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_20_23">
          <span class="md-nav__icon md-icon"></span>
          Storage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/storage/generic_storage/" class="md-nav__link">
        GenericStorage
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_20_23_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_20_23_2" id="__nav_3_11_2_20_23_2_label" tabindex="0">
          Backends
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_11_2_20_23_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_20_23_2">
          <span class="md-nav__icon md-icon"></span>
          Backends
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/storage/backends/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/storage/backends/sqlite/" class="md-nav__link">
        Sqlite
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/sym_link/" class="md-nav__link">
        Sym Link
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_20_25" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_20_25" id="__nav_3_11_2_20_25_label" tabindex="0">
          Transaction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_20_25_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_20_25">
          <span class="md-nav__icon md-icon"></span>
          Transaction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/transaction/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/win32/" class="md-nav__link">
        Win32
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/helpers/yaml_utils/" class="md-nav__link">
        YamlUtils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/identity/base/" class="md-nav__link">
        Identity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/mail/base/" class="md-nav__link">
        Mail
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_23" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_23" id="__nav_3_11_2_23_label" tabindex="0">
          Manager
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_23_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_23">
          <span class="md-nav__icon md-icon"></span>
          Manager
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/manager/manager/" class="md-nav__link">
        Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/manager/project/" class="md-nav__link">
        Project
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/manager/utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_24" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_24" id="__nav_3_11_2_24_label" tabindex="0">
          Protocols
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_24_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_24">
          <span class="md-nav__icon md-icon"></span>
          Protocols
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_24_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_24_2" id="__nav_3_11_2_24_2_label" tabindex="0">
          Dialogue
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_24_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_24_2">
          <span class="md-nav__icon md-icon"></span>
          Dialogue
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/dialogue/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_24_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_24_3" id="__nav_3_11_2_24_3_label" tabindex="0">
          Generator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_24_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_24_3">
          <span class="md-nav__icon md-icon"></span>
          Generator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/generator/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/generator/common/" class="md-nav__link">
        Common
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/generator/extract_specification/" class="md-nav__link">
        Extract Specification
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/generator/validate/" class="md-nav__link">
        Validate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_24_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_24_4" id="__nav_3_11_2_24_4_label" tabindex="0">
          Default Protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_24_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_24_4">
          <span class="md-nav__icon md-icon"></span>
          Default Protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/default/custom_types/" class="md-nav__link">
        Custom Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/default/dialogues/" class="md-nav__link">
        Dialogues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/default/message/" class="md-nav__link">
        Message
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/default/serialization/" class="md-nav__link">
        Serialization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_24_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_24_5" id="__nav_3_11_2_24_5_label" tabindex="0">
          Signing Protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_24_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_24_5">
          <span class="md-nav__icon md-icon"></span>
          Signing Protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/signing/custom_types/" class="md-nav__link">
        Custom Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/signing/dialogues/" class="md-nav__link">
        Dialogues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/signing/message/" class="md-nav__link">
        Message
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/signing/serialization/" class="md-nav__link">
        Serialization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_24_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_24_6" id="__nav_3_11_2_24_6_label" tabindex="0">
          State Update Protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_24_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_24_6">
          <span class="md-nav__icon md-icon"></span>
          State Update Protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/state_update/dialogues/" class="md-nav__link">
        Dialogues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/state_update/message/" class="md-nav__link">
        Message
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/protocols/state_update/serialization/" class="md-nav__link">
        Serialization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_25" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_25" id="__nav_3_11_2_25_label" tabindex="0">
          Registries
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_25_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_25">
          <span class="md-nav__icon md-icon"></span>
          Registries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/registries/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/registries/filter/" class="md-nav__link">
        Filter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/registries/resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_26" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_26" id="__nav_3_11_2_26_label" tabindex="0">
          Skills
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_26_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_26">
          <span class="md-nav__icon md-icon"></span>
          Skills
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/skills/base/" class="md-nav__link">
        Base
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/skills/behaviours/" class="md-nav__link">
        Behaviors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/skills/tasks/" class="md-nav__link">
        Task
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_27" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_27" id="__nav_3_11_2_27_label" tabindex="0">
          Test Tools
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_27_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_27">
          <span class="md-nav__icon md-icon"></span>
          Test Tools
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/test_tools/constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/test_tools/exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/test_tools/generic/" class="md-nav__link">
        Generic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/test_tools/test_cases/" class="md-nav__link">
        Test Cases
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/test_tools/test_contract/" class="md-nav__link">
        Test Contract
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/test_tools/test_skill/" class="md-nav__link">
        Test Skill
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_28" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_28" id="__nav_3_11_2_28_label" tabindex="0">
          Plugins
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_11_2_28_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_28">
          <span class="md-nav__icon md-icon"></span>
          Plugins
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_28_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_28_1" id="__nav_3_11_2_28_1_label" tabindex="0">
          CLI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_28_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_28_1">
          <span class="md-nav__icon md-icon"></span>
          CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_28_1_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_28_1_1" id="__nav_3_11_2_28_1_1_label" tabindex="0">
          IPFS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_11_2_28_1_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_28_1_1">
          <span class="md-nav__icon md-icon"></span>
          IPFS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/plugins/aea_cli_ipfs/core/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/plugins/aea_cli_ipfs/ipfs_utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_28_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_28_2" id="__nav_3_11_2_28_2_label" tabindex="0">
          Ledger
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_11_2_28_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_28_2">
          <span class="md-nav__icon md-icon"></span>
          Ledger
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_28_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_28_2_1" id="__nav_3_11_2_28_2_1_label" tabindex="0">
          Cosmos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_11_2_28_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_28_2_1">
          <span class="md-nav__icon md-icon"></span>
          Cosmos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/plugins/aea_ledger_cosmos/cosmos/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_28_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_28_2_2" id="__nav_3_11_2_28_2_2_label" tabindex="0">
          Ethereum
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_11_2_28_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_28_2_2">
          <span class="md-nav__icon md-icon"></span>
          Ethereum
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/plugins/aea_ledger_ethereum/ethereum/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_11_2_28_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_11_2_28_2_3" id="__nav_3_11_2_28_2_3_label" tabindex="0">
          Fetchai
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_11_2_28_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_11_2_28_2_3">
          <span class="md-nav__icon md-icon"></span>
          Fetchai
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/plugins/aea_ledger_fetchai/fetchai/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../api/plugins/aea_ledger_fetchai/_cosmos/" class="md-nav__link">
        Helper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../limits/" class="md-nav__link">
        Limitations of v1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../known-limits/" class="md-nav__link">
        Known limitations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../questions-and-answers/" class="md-nav__link">
        Q&A
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_16" >
      
      
      
        <label class="md-nav__link" for="__nav_3_16" id="__nav_3_16_label" tabindex="0">
          Archives
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_16_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_16">
          <span class="md-nav__icon md-icon"></span>
          Archives
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tac/" class="md-nav__link">
        TAC external app
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          μAgents
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          μAgents
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Quick start
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Quick start
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/run-agent/" class="md-nav__link">
        Running an agent
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/simple-interaction/" class="md-nav__link">
        Agent interactions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/remote-agents/" class="md-nav__link">
        Remote communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/booking-demo/" class="md-nav__link">
        Restaurant booking demo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          Key concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Key concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/addresses/" class="md-nav__link">
        Addresses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/interval-tasks/" class="md-nav__link">
        Interval tasks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/protocol/" class="md-nav__link">
        Exchange protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_5" >
      
      
      
        <label class="md-nav__link" for="__nav_4_4_5" id="__nav_4_4_5_label" tabindex="0">
          Almanac contract
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4_5">
          <span class="md-nav__icon md-icon"></span>
          Almanac contract
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/almanac-overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/almanac-registration/" class="md-nav__link">
        Registration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../uAgents/almanac-endpoint/" class="md-nav__link">
        Endpoint weighting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          CosmPy
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          CosmPy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          Beginner
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Beginner
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/connect-to-network/" class="md-nav__link">
        Connect to a network
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/query-balance/" class="md-nav__link">
        Querying balances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/wallets-and-keys/" class="md-nav__link">
        Wallets and Keys
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/send-tokens/" class="md-nav__link">
        Send tokens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/staking/" class="md-nav__link">
        Staking
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_6" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2_6" id="__nav_5_2_6_label" tabindex="0">
          Smart Contracts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2_6">
          <span class="md-nav__icon md-icon"></span>
          Smart Contracts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/deploy-a-contract/" class="md-nav__link">
        Deploy a contract
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/low-level-api/" class="md-nav__link">
        Low-level API
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
      
      
      
        <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
          Use-Cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Use-Cases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/auto-compounder/" class="md-nav__link">
        Stake Auto-Compounder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/stake-optimizer/" class="md-nav__link">
        Stake Optimizer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/oracles/" class="md-nav__link">
        Oracles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/wallet-topup/" class="md-nav__link">
        Wallet Top-up
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/liquidity-pool/" class="md-nav__link">
        Liquidity Pool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/swap-automation/" class="md-nav__link">
        Swap Automation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_1" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5_1" id="__nav_5_5_1_label" tabindex="0">
          Client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5_1">
          <span class="md-nav__icon md-icon"></span>
          Client
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/client/__init__/" class="md-nav__link">
        Client functionality
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/client/bank/" class="md-nav__link">
        Bank send message
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/client/distribution/" class="md-nav__link">
        Distribution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/client/staking/" class="md-nav__link">
        Staking functionality
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/client/utils/" class="md-nav__link">
        Helper functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5_2" id="__nav_5_5_2_label" tabindex="0">
          Contract
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5_2">
          <span class="md-nav__icon md-icon"></span>
          Contract
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/contract/__init__/" class="md-nav__link">
        Cosmwasm contract functionality
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/contract/cosmwasm/" class="md-nav__link">
        Cosmwasm contract store, instantiate, execute messages
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/coins/" class="md-nav__link">
        Parse the coins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/config/" class="md-nav__link">
        Network configurations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/faucet/" class="md-nav__link">
        Ledger faucet API interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/gas/" class="md-nav__link">
        Transaction gas strategy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/tx_helpers/" class="md-nav__link">
        Transaction helpers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/tx/" class="md-nav__link">
        Transaction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/urls/" class="md-nav__link">
        Parsing the URL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CosmPy/api/aerial/wallet/" class="md-nav__link">
        Wallet Generation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Jenesis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Jenesis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenesis/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          Working with contracts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Working with contracts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenesis/add-profile/" class="md-nav__link">
        Add profiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenesis/add-contracts/" class="md-nav__link">
        Add contracts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenesis/compile-contracts/" class="md-nav__link">
        Compile contracts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenesis/deploy-contracts/" class="md-nav__link">
        Deploy contracts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenesis/use-contracts/" class="md-nav__link">
        Interact with contracts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Jenesis/keys/" class="md-nav__link">
        Keys
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Ledger
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Ledger
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/building/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/versions/" class="md-nav__link">
        Versions
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
      
      
      
        <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
          Networks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          Networks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/live-networks/" class="md-nav__link">
        Active Networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/archived-networks/" class="md-nav__link">
        Mainnet Archive
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/snapshots/" class="md-nav__link">
        Snapshots
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/state-sync/" class="md-nav__link">
        State Sync
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
          Commandline Client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_7">
          <span class="md-nav__icon md-icon"></span>
          Commandline Client
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/cli-introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/cli-keys/" class="md-nav__link">
        Keys
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/cli-tokens/" class="md-nav__link">
        Tokens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/cli-multisig/" class="md-nav__link">
        Multisig Keys
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/delegator-guide-cli/" class="md-nav__link">
        Delegator Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/cli-governance/" class="md-nav__link">
        Governance Proposals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
      
      
      
        <label class="md-nav__link" for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
          Validators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_8">
          <span class="md-nav__icon md-icon"></span>
          Validators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/validators/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/validators/security/" class="md-nav__link">
        Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/validators/setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/joining-a-testnet/" class="md-nav__link">
        Joining a Testnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/single-node-network/" class="md-nav__link">
        Single Node Testnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/block-explorer/" class="md-nav__link">
        Block Explorer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/governance/" class="md-nav__link">
        Governance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger_v2/faucet/" class="md-nav__link">
        Faucet
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          Indexer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Indexer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ledger-subquery/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Create React App template
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Create React App template
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../create-react-app/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../create-react-app/example_dapp/" class="md-nav__link">
        Example DApp
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          Collective Learning
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Collective Learning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/" class="md-nav__link">
        Colearn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/about/" class="md-nav__link">
        Collective Learning Protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_3" >
      
      
      
        <label class="md-nav__link" for="__nav_10_3" id="__nav_10_3_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_3">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/intro_tutorial_keras/" class="md-nav__link">
        Keras
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/intro_tutorial_pytorch/" class="md-nav__link">
        PyTorch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/intro_tutorial_mli/" class="md-nav__link">
        The MachineLearningInterface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/differential_privacy/" class="md-nav__link">
        Differential Privacy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/grpc_tutorial/" class="md-nav__link">
        gRPC server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
      
      
      
        <label class="md-nav__link" for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_4">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/demo/" class="md-nav__link">
        Demo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/examples/" class="md-nav__link">
        Standalone examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../colearn/grpc_examples/" class="md-nav__link">
        gRPC example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
      
      
      
        <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
          Archives
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Archives
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_1" >
      
      
      
        <label class="md-nav__link" for="__nav_11_1" id="__nav_11_1_label" tabindex="0">
          Search and Discovery (SOEF)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11_1">
          <span class="md-nav__icon md-icon"></span>
          Search and Discovery (SOEF)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../soef/simple-oef/" class="md-nav__link">
        Simple OEF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../soef/simple-oef-usage/" class="md-nav__link">
        SOEF Connection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dependencies-required" class="md-nav__link">
    Dependencies (Required)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-code-optional" class="md-nav__link">
    Reference Code (Optional)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simplification-step" class="md-nav__link">
    Simplification Step
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generic-seller-aea" class="md-nav__link">
    Generic Seller AEA
  </a>
  
    <nav class="md-nav" aria-label="Generic Seller AEA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-the-aea" class="md-nav__link">
    Step 1: Create the AEA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-the-behaviour" class="md-nav__link">
    Step 2: Create the Behaviour
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-the-handler" class="md-nav__link">
    Step 3: Create the Handler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-the-strategy" class="md-nav__link">
    Step 4: Create the Strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-create-the-dialogues" class="md-nav__link">
    Step 5: Create the Dialogues
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-update-the-yaml-files" class="md-nav__link">
    Step 6: Update the YAML Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generic-buyer-aea" class="md-nav__link">
    Generic Buyer AEA
  </a>
  
    <nav class="md-nav" aria-label="Generic Buyer AEA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-the-aea_1" class="md-nav__link">
    Step 1: Create the AEA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-the-behaviour_1" class="md-nav__link">
    Step 2: Create the Behaviour
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-create-the-handler_1" class="md-nav__link">
    Step 3: Create the Handler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-the-strategy_1" class="md-nav__link">
    Step 4: Create the Strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-create-the-dialogues_1" class="md-nav__link">
    Step 5: Create the Dialogues
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-update-the-yaml-files_1" class="md-nav__link">
    Step 6: Update the YAML Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-the-aeas" class="md-nav__link">
    Run the AEAs
  </a>
  
    <nav class="md-nav" aria-label="Run the AEAs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-private-keys" class="md-nav__link">
    Create Private Keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-the-aea-configurations" class="md-nav__link">
    Update the AEA Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fund-the-buyer-aea" class="md-nav__link">
    Fund the Buyer AEA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-seller-aea" class="md-nav__link">
    Run Seller AEA
  </a>
  
    <nav class="md-nav" aria-label="Run Seller AEA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-buyer-aea" class="md-nav__link">
    Run Buyer AEA
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-the-aeas" class="md-nav__link">
    Delete the AEAs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
    <nav class="md-nav" aria-label="Next Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recommended" class="md-nav__link">
    Recommended
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="trade-between-two-aeas">Trade between Two AEAs<a class="headerlink" href="#trade-between-two-aeas" title="Permanent link">&para;</a></h1>
<p>This guide is a step-by-step introduction to building AEAs that advertise their static and dynamic data, find other AEAs with required data, negotiate terms of trade, and carry out trades via ledger transactions.</p>
<p>If you simply want to run the resulting AEAs <a href="../generic-skills">go here</a>.</p>
<h2 id="dependencies-required">Dependencies (Required)<a class="headerlink" href="#dependencies-required" title="Permanent link">&para;</a></h2>
<p>Follow the <a href="../quickstart/#preliminaries">Preliminaries</a> and <a href="../quickstart/#installation">Installation</a> sections from the AEA quick start.</p>
<h2 id="reference-code-optional">Reference Code (Optional)<a class="headerlink" href="#reference-code-optional" title="Permanent link">&para;</a></h2>
<p>This step-by-step guide goes through the creation of two AEAs which are already developed by Fetch.ai. You can get the finished AEAs, and compare your code against them, by following the next steps:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>aea<span class="w"> </span>fetch<span class="w"> </span>fetchai/generic_seller:0.29.5
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>generic_seller
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>aea<span class="w"> </span>eject<span class="w"> </span>skill<span class="w"> </span>fetchai/generic_seller:0.28.6
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>aea<span class="w"> </span>fetch<span class="w"> </span>fetchai/generic_buyer:0.30.5
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>generic_buyer
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>aea<span class="w"> </span>eject<span class="w"> </span>skill<span class="w"> </span>fetchai/generic_buyer:0.27.6
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nb">cd</span><span class="w"> </span>..
</code></pre></div>
<h2 id="simplification-step">Simplification Step<a class="headerlink" href="#simplification-step" title="Permanent link">&para;</a></h2>
<p>To keep file paths consistent with the reference code, we suggest you initialize your local author as <code>fetchai</code> for the purpose of this demo only:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>aea<span class="w"> </span>init<span class="w"> </span>--reset<span class="w"> </span>--author<span class="w"> </span>fetchai
</code></pre></div>
<h2 id="generic-seller-aea">Generic Seller AEA<a class="headerlink" href="#generic-seller-aea" title="Permanent link">&para;</a></h2>
<h3 id="step-1-create-the-aea">Step 1: Create the AEA<a class="headerlink" href="#step-1-create-the-aea" title="Permanent link">&para;</a></h3>
<p>Create a new AEA by typing the following command in the terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>aea<span class="w"> </span>create<span class="w"> </span>my_generic_seller
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nb">cd</span><span class="w"> </span>my_generic_seller
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>aea<span class="w"> </span>install
</code></pre></div>
<p>Our newly created AEA is inside the current working directory. Let’s create our new skill that will handle the sale of data. Type the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>aea<span class="w"> </span>scaffold<span class="w"> </span>skill<span class="w"> </span>generic_seller
</code></pre></div>
<p>The <code>scaffold skill</code> command creates the correct structure for a new skill inside our AEA project. You can locate the newly created skill under the "skills" folder (<code>my_generic_seller/skills/generic_seller/</code>), and it must contain the following files:</p>
<ul>
<li><code>__init__.py</code></li>
<li><code>behaviours.py</code></li>
<li><code>handlers.py</code></li>
<li><code>my_model.py</code></li>
<li><code>skills.yaml</code></li>
</ul>
<h3 id="step-2-create-the-behaviour">Step 2: Create the Behaviour<a class="headerlink" href="#step-2-create-the-behaviour" title="Permanent link">&para;</a></h3>
<p>A <a href="../api/skills/base#behaviour-objects"><code>Behaviour</code></a> class contains the business logic specific to actions initiated by the AEA, rather than reactions to other events.</p>
<p>Open the <code>behaviours.py</code> file (<code>my_generic_seller/skills/generic_seller/behaviours.py</code>) and replace the stub code with the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">cast</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">from</span> <span class="nn">aea.helpers.search.models</span> <span class="kn">import</span> <span class="n">Description</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">from</span> <span class="nn">aea.skills.behaviours</span> <span class="kn">import</span> <span class="n">TickerBehaviour</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="kn">from</span> <span class="nn">packages.fetchai.connections.ledger.base</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="n">CONNECTION_ID</span> <span class="k">as</span> <span class="n">LEDGER_CONNECTION_PUBLIC_ID</span><span class="p">,</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="p">)</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.message</span> <span class="kn">import</span> <span class="n">LedgerApiMessage</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.oef_search.message</span> <span class="kn">import</span> <span class="n">OefSearchMessage</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_seller.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    <span class="n">LedgerApiDialogues</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span class="n">OefSearchDialogues</span><span class="p">,</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="p">)</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_seller.strategy</span> <span class="kn">import</span> <span class="n">GenericStrategy</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="n">DEFAULT_SERVICES_INTERVAL</span> <span class="o">=</span> <span class="mf">60.0</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="n">DEFAULT_MAX_SOEF_REGISTRATION_RETRIES</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="n">LEDGER_API_ADDRESS</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">LEDGER_CONNECTION_PUBLIC_ID</span><span class="p">)</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="k">class</span> <span class="nc">GenericServiceRegistrationBehaviour</span><span class="p">(</span><span class="n">TickerBehaviour</span><span class="p">):</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements a behaviour.&quot;&quot;&quot;</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the behaviour.&quot;&quot;&quot;</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>        <span class="n">services_interval</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>            <span class="s2">&quot;services_interval&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVICES_INTERVAL</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>        <span class="p">)</span>  <span class="c1"># type: int</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_soef_registration_retries</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>            <span class="s2">&quot;max_soef_registration_retries&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MAX_SOEF_REGISTRATION_RETRIES</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>        <span class="p">)</span>  <span class="c1"># type: int</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">tick_interval</span><span class="o">=</span><span class="n">services_interval</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">failed_registration_msg</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[OefSearchMessage]</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_nb_retries</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the setup.&quot;&quot;&quot;</span>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>        <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_ledger_tx</span><span class="p">:</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>            <span class="n">ledger_api_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>                <span class="n">LedgerApiDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">ledger_api_dialogues</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>            <span class="p">)</span>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>            <span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ledger_api_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>                <span class="n">counterparty</span><span class="o">=</span><span class="n">LEDGER_API_ADDRESS</span><span class="p">,</span>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">GET_BALANCE</span><span class="p">,</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>                <span class="n">ledger_id</span><span class="o">=</span><span class="n">strategy</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>                <span class="n">address</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_addresses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">)),</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>            <span class="p">)</span>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register_agent</span><span class="p">()</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the act.&quot;&quot;&quot;</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retry_failed_registration</span><span class="p">()</span>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the task teardown.&quot;&quot;&quot;</span>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_unregister_service</span><span class="p">()</span>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_unregister_agent</span><span class="p">()</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a>    <span class="k">def</span> <span class="nf">_retry_failed_registration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retry a failed registration.&quot;&quot;&quot;</span>
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_registration_msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_nb_retries</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nb_retries</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_soef_registration_retries</span><span class="p">:</span>
<a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a>                <span class="k">return</span>
<a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a>
<a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a>            <span class="n">oef_search_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a>                <span class="n">OefSearchDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">oef_search_dialogues</span>
<a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a>            <span class="p">)</span>
<a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a>            <span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">oef_search_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a>                <span class="n">counterparty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">failed_registration_msg</span><span class="o">.</span><span class="n">to</span><span class="p">,</span>
<a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a>                <span class="n">performative</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">failed_registration_msg</span><span class="o">.</span><span class="n">performative</span><span class="p">,</span>
<a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a>                <span class="n">service_description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">failed_registration_msg</span><span class="o">.</span><span class="n">service_description</span><span class="p">,</span>
<a id="__codelineno-5-79" name="__codelineno-5-79" href="#__codelineno-5-79"></a>            <span class="p">)</span>
<a id="__codelineno-5-80" name="__codelineno-5-80" href="#__codelineno-5-80"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">oef_search_msg</span><span class="p">)</span>
<a id="__codelineno-5-81" name="__codelineno-5-81" href="#__codelineno-5-81"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-5-82" name="__codelineno-5-82" href="#__codelineno-5-82"></a>                <span class="sa">f</span><span class="s2">&quot;Retrying registration on SOEF. Retry </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_nb_retries</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_soef_registration_retries</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-5-83" name="__codelineno-5-83" href="#__codelineno-5-83"></a>            <span class="p">)</span>
<a id="__codelineno-5-84" name="__codelineno-5-84" href="#__codelineno-5-84"></a>
<a id="__codelineno-5-85" name="__codelineno-5-85" href="#__codelineno-5-85"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">failed_registration_msg</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-5-86" name="__codelineno-5-86" href="#__codelineno-5-86"></a>
<a id="__codelineno-5-87" name="__codelineno-5-87" href="#__codelineno-5-87"></a>    <span class="k">def</span> <span class="nf">_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="n">Description</span><span class="p">,</span> <span class="n">logger_msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-88" name="__codelineno-5-88" href="#__codelineno-5-88"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-5-89" name="__codelineno-5-89" href="#__codelineno-5-89"></a><span class="sd">        Register something on the SOEF.</span>
<a id="__codelineno-5-90" name="__codelineno-5-90" href="#__codelineno-5-90"></a>
<a id="__codelineno-5-91" name="__codelineno-5-91" href="#__codelineno-5-91"></a><span class="sd">        :param description: the description of what is being registered</span>
<a id="__codelineno-5-92" name="__codelineno-5-92" href="#__codelineno-5-92"></a><span class="sd">        :param logger_msg: the logger message to print after the registration</span>
<a id="__codelineno-5-93" name="__codelineno-5-93" href="#__codelineno-5-93"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-5-94" name="__codelineno-5-94" href="#__codelineno-5-94"></a>        <span class="n">oef_search_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-5-95" name="__codelineno-5-95" href="#__codelineno-5-95"></a>            <span class="n">OefSearchDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">oef_search_dialogues</span>
<a id="__codelineno-5-96" name="__codelineno-5-96" href="#__codelineno-5-96"></a>        <span class="p">)</span>
<a id="__codelineno-5-97" name="__codelineno-5-97" href="#__codelineno-5-97"></a>        <span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">oef_search_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-5-98" name="__codelineno-5-98" href="#__codelineno-5-98"></a>            <span class="n">counterparty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">search_service_address</span><span class="p">,</span>
<a id="__codelineno-5-99" name="__codelineno-5-99" href="#__codelineno-5-99"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">REGISTER_SERVICE</span><span class="p">,</span>
<a id="__codelineno-5-100" name="__codelineno-5-100" href="#__codelineno-5-100"></a>            <span class="n">service_description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
<a id="__codelineno-5-101" name="__codelineno-5-101" href="#__codelineno-5-101"></a>        <span class="p">)</span>
<a id="__codelineno-5-102" name="__codelineno-5-102" href="#__codelineno-5-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">oef_search_msg</span><span class="p">)</span>
<a id="__codelineno-5-103" name="__codelineno-5-103" href="#__codelineno-5-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">logger_msg</span><span class="p">)</span>
<a id="__codelineno-5-104" name="__codelineno-5-104" href="#__codelineno-5-104"></a>
<a id="__codelineno-5-105" name="__codelineno-5-105" href="#__codelineno-5-105"></a>    <span class="k">def</span> <span class="nf">_register_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-106" name="__codelineno-5-106" href="#__codelineno-5-106"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the agent&#39;s location.&quot;&quot;&quot;</span>
<a id="__codelineno-5-107" name="__codelineno-5-107" href="#__codelineno-5-107"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-5-108" name="__codelineno-5-108" href="#__codelineno-5-108"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_location_description</span><span class="p">()</span>
<a id="__codelineno-5-109" name="__codelineno-5-109" href="#__codelineno-5-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="s2">&quot;registering agent on SOEF.&quot;</span><span class="p">)</span>
<a id="__codelineno-5-110" name="__codelineno-5-110" href="#__codelineno-5-110"></a>
<a id="__codelineno-5-111" name="__codelineno-5-111" href="#__codelineno-5-111"></a>    <span class="k">def</span> <span class="nf">register_service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-112" name="__codelineno-5-112" href="#__codelineno-5-112"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the agent&#39;s service.&quot;&quot;&quot;</span>
<a id="__codelineno-5-113" name="__codelineno-5-113" href="#__codelineno-5-113"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-5-114" name="__codelineno-5-114" href="#__codelineno-5-114"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_register_service_description</span><span class="p">()</span>
<a id="__codelineno-5-115" name="__codelineno-5-115" href="#__codelineno-5-115"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="s2">&quot;registering agent&#39;s service on the SOEF.&quot;</span><span class="p">)</span>
<a id="__codelineno-5-116" name="__codelineno-5-116" href="#__codelineno-5-116"></a>
<a id="__codelineno-5-117" name="__codelineno-5-117" href="#__codelineno-5-117"></a>    <span class="k">def</span> <span class="nf">register_genus</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-118" name="__codelineno-5-118" href="#__codelineno-5-118"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the agent&#39;s personality genus.&quot;&quot;&quot;</span>
<a id="__codelineno-5-119" name="__codelineno-5-119" href="#__codelineno-5-119"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-5-120" name="__codelineno-5-120" href="#__codelineno-5-120"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_register_personality_description</span><span class="p">()</span>
<a id="__codelineno-5-121" name="__codelineno-5-121" href="#__codelineno-5-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register</span><span class="p">(</span>
<a id="__codelineno-5-122" name="__codelineno-5-122" href="#__codelineno-5-122"></a>            <span class="n">description</span><span class="p">,</span> <span class="s2">&quot;registering agent&#39;s personality genus on the SOEF.&quot;</span>
<a id="__codelineno-5-123" name="__codelineno-5-123" href="#__codelineno-5-123"></a>        <span class="p">)</span>
<a id="__codelineno-5-124" name="__codelineno-5-124" href="#__codelineno-5-124"></a>
<a id="__codelineno-5-125" name="__codelineno-5-125" href="#__codelineno-5-125"></a>    <span class="k">def</span> <span class="nf">register_classification</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-126" name="__codelineno-5-126" href="#__codelineno-5-126"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register the agent&#39;s personality classification.&quot;&quot;&quot;</span>
<a id="__codelineno-5-127" name="__codelineno-5-127" href="#__codelineno-5-127"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-5-128" name="__codelineno-5-128" href="#__codelineno-5-128"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_register_classification_description</span><span class="p">()</span>
<a id="__codelineno-5-129" name="__codelineno-5-129" href="#__codelineno-5-129"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_register</span><span class="p">(</span>
<a id="__codelineno-5-130" name="__codelineno-5-130" href="#__codelineno-5-130"></a>            <span class="n">description</span><span class="p">,</span> <span class="s2">&quot;registering agent&#39;s personality classification on the SOEF.&quot;</span>
<a id="__codelineno-5-131" name="__codelineno-5-131" href="#__codelineno-5-131"></a>        <span class="p">)</span>
<a id="__codelineno-5-132" name="__codelineno-5-132" href="#__codelineno-5-132"></a>
<a id="__codelineno-5-133" name="__codelineno-5-133" href="#__codelineno-5-133"></a>    <span class="k">def</span> <span class="nf">_unregister_service</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-134" name="__codelineno-5-134" href="#__codelineno-5-134"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unregister service from the SOEF.&quot;&quot;&quot;</span>
<a id="__codelineno-5-135" name="__codelineno-5-135" href="#__codelineno-5-135"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-5-136" name="__codelineno-5-136" href="#__codelineno-5-136"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_unregister_service_description</span><span class="p">()</span>
<a id="__codelineno-5-137" name="__codelineno-5-137" href="#__codelineno-5-137"></a>        <span class="n">oef_search_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-5-138" name="__codelineno-5-138" href="#__codelineno-5-138"></a>            <span class="n">OefSearchDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">oef_search_dialogues</span>
<a id="__codelineno-5-139" name="__codelineno-5-139" href="#__codelineno-5-139"></a>        <span class="p">)</span>
<a id="__codelineno-5-140" name="__codelineno-5-140" href="#__codelineno-5-140"></a>        <span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">oef_search_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-5-141" name="__codelineno-5-141" href="#__codelineno-5-141"></a>            <span class="n">counterparty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">search_service_address</span><span class="p">,</span>
<a id="__codelineno-5-142" name="__codelineno-5-142" href="#__codelineno-5-142"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">UNREGISTER_SERVICE</span><span class="p">,</span>
<a id="__codelineno-5-143" name="__codelineno-5-143" href="#__codelineno-5-143"></a>            <span class="n">service_description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
<a id="__codelineno-5-144" name="__codelineno-5-144" href="#__codelineno-5-144"></a>        <span class="p">)</span>
<a id="__codelineno-5-145" name="__codelineno-5-145" href="#__codelineno-5-145"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">oef_search_msg</span><span class="p">)</span>
<a id="__codelineno-5-146" name="__codelineno-5-146" href="#__codelineno-5-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;unregistering service from SOEF.&quot;</span><span class="p">)</span>
<a id="__codelineno-5-147" name="__codelineno-5-147" href="#__codelineno-5-147"></a>
<a id="__codelineno-5-148" name="__codelineno-5-148" href="#__codelineno-5-148"></a>    <span class="k">def</span> <span class="nf">_unregister_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-5-149" name="__codelineno-5-149" href="#__codelineno-5-149"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unregister agent from the SOEF.&quot;&quot;&quot;</span>
<a id="__codelineno-5-150" name="__codelineno-5-150" href="#__codelineno-5-150"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-5-151" name="__codelineno-5-151" href="#__codelineno-5-151"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_location_description</span><span class="p">()</span>
<a id="__codelineno-5-152" name="__codelineno-5-152" href="#__codelineno-5-152"></a>        <span class="n">oef_search_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-5-153" name="__codelineno-5-153" href="#__codelineno-5-153"></a>            <span class="n">OefSearchDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">oef_search_dialogues</span>
<a id="__codelineno-5-154" name="__codelineno-5-154" href="#__codelineno-5-154"></a>        <span class="p">)</span>
<a id="__codelineno-5-155" name="__codelineno-5-155" href="#__codelineno-5-155"></a>        <span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">oef_search_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-5-156" name="__codelineno-5-156" href="#__codelineno-5-156"></a>            <span class="n">counterparty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">search_service_address</span><span class="p">,</span>
<a id="__codelineno-5-157" name="__codelineno-5-157" href="#__codelineno-5-157"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">UNREGISTER_SERVICE</span><span class="p">,</span>
<a id="__codelineno-5-158" name="__codelineno-5-158" href="#__codelineno-5-158"></a>            <span class="n">service_description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
<a id="__codelineno-5-159" name="__codelineno-5-159" href="#__codelineno-5-159"></a>        <span class="p">)</span>
<a id="__codelineno-5-160" name="__codelineno-5-160" href="#__codelineno-5-160"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">oef_search_msg</span><span class="p">)</span>
<a id="__codelineno-5-161" name="__codelineno-5-161" href="#__codelineno-5-161"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;unregistering agent from SOEF.&quot;</span><span class="p">)</span>
</code></pre></div>
<p>This <a href="../api/skills/behaviours#tickerbehaviour-objects"><code>TickerBehaviour</code></a> registers (see <code>setup</code> method) and de-registers (see <code>teardown</code> method) our AEA’s service on the <a href="../simple-oef">SOEF search node</a> at regular tick intervals (here 60 seconds). By registering, the AEA becomes discoverable to other AEAs.</p>
<p>In <code>setup</code>, prior to registrations, we send a message to the ledger connection to check the account balance for the AEA's address on the configured ledger.</p>
<h3 id="step-3-create-the-handler">Step 3: Create the Handler<a class="headerlink" href="#step-3-create-the-handler" title="Permanent link">&para;</a></h3>
<p>So far, we have tasked the AEA with sending register/unregister requests to the <a href="../simple-oef">SOEF search node</a>. However at present, the AEA has no way of handling the responses it receives from the search node, or in fact messages sent by any other AEA.</p>
<p>We have to specify the logic to negotiate with another AEA based on the strategy we want our AEA to follow. The following diagram illustrates the negotiation flow that we want this AEA to use, as well as interactions with a search node and the blockchain between a <code>seller_AEA</code> and a <code>buyer_AEA</code>.</p>
<pre class="mermaid"><code>    sequenceDiagram
        participant Search
        participant Buyer_AEA
        participant Seller_AEA
        participant Blockchain

        activate Buyer_AEA
        activate Search
        activate Seller_AEA
        activate Blockchain

        Seller_AEA-&gt;&gt;Search: register_service
        Buyer_AEA-&gt;&gt;Search: search
        Search--&gt;&gt;Buyer_AEA: list_of_agents
        Buyer_AEA-&gt;&gt;Seller_AEA: call_for_proposal
        Seller_AEA-&gt;&gt;Buyer_AEA: propose
        Buyer_AEA-&gt;&gt;Seller_AEA: accept
        Seller_AEA-&gt;&gt;Buyer_AEA: match_accept
        loop Once with LedgerConnection
            Buyer_AEA-&gt;&gt;Buyer_AEA: Get raw transaction from ledger api
        end
        loop Once with DecisionMaker
            Buyer_AEA-&gt;&gt;Buyer_AEA: Get signed transaction from decision maker
        end
        loop Once with LedgerConnection
            Buyer_AEA-&gt;&gt;Buyer_AEA: Send transaction and get digest from ledger api
            Buyer_AEA-&gt;&gt;Blockchain: transfer_funds
        end
        Buyer_AEA-&gt;&gt;Seller_AEA: send_transaction_digest
        Seller_AEA-&gt;&gt;Blockchain: check_transaction_status
        Seller_AEA-&gt;&gt;Buyer_AEA: send_data

        deactivate Buyer_AEA
        deactivate Search
        deactivate Seller_AEA
        deactivate Blockchain</code></pre>
<p>In our case, <code>my_generic_seller</code> is the <code>Seller_AEA</code> in the above figure.</p>
<p>Let us now implement a <a href="../api/skills/base#handler-objects"><code>Handler</code></a> to deal with incoming messages. Open the <code>handlers.py</code> file (<code>my_generic_seller/skills/generic_seller/handlers.py</code>) and replace the stub code with the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">cast</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kn">from</span> <span class="nn">aea.configurations.base</span> <span class="kn">import</span> <span class="n">PublicId</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kn">from</span> <span class="nn">aea.crypto.ledger_apis</span> <span class="kn">import</span> <span class="n">LedgerApis</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kn">from</span> <span class="nn">aea.helpers.transaction.base</span> <span class="kn">import</span> <span class="n">TransactionDigest</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="kn">from</span> <span class="nn">aea.protocols.base</span> <span class="kn">import</span> <span class="n">Message</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="kn">from</span> <span class="nn">aea.skills.base</span> <span class="kn">import</span> <span class="n">Handler</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="kn">from</span> <span class="nn">packages.fetchai.connections.ledger.base</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="n">CONNECTION_ID</span> <span class="k">as</span> <span class="n">LEDGER_CONNECTION_PUBLIC_ID</span><span class="p">,</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="p">)</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.default.message</span> <span class="kn">import</span> <span class="n">DefaultMessage</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.fipa.message</span> <span class="kn">import</span> <span class="n">FipaMessage</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.message</span> <span class="kn">import</span> <span class="n">LedgerApiMessage</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.oef_search.message</span> <span class="kn">import</span> <span class="n">OefSearchMessage</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_seller.behaviours</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    <span class="n">GenericServiceRegistrationBehaviour</span><span class="p">,</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_seller.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>    <span class="n">DefaultDialogues</span><span class="p">,</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    <span class="n">FipaDialogue</span><span class="p">,</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>    <span class="n">FipaDialogues</span><span class="p">,</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>    <span class="n">LedgerApiDialogue</span><span class="p">,</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>    <span class="n">LedgerApiDialogues</span><span class="p">,</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>    <span class="n">OefSearchDialogue</span><span class="p">,</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>    <span class="n">OefSearchDialogues</span><span class="p">,</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="p">)</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_seller.strategy</span> <span class="kn">import</span> <span class="n">GenericStrategy</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="n">LEDGER_API_ADDRESS</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">LEDGER_CONNECTION_PUBLIC_ID</span><span class="p">)</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="k">class</span> <span class="nc">GenericFipaHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements a FIPA handler.&quot;&quot;&quot;</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>    <span class="n">SUPPORTED_PROTOCOL</span> <span class="o">=</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">protocol_id</span>  <span class="c1"># type: Optional[PublicId]</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the setup for the handler.&quot;&quot;&quot;</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="sd">        Implement the reaction to a message.</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="sd">        :param message: the message</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>        <span class="n">fipa_msg</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">FipaMessage</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a>        <span class="c1"># recover dialogue</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>        <span class="n">fipa_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">FipaDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">fipa_dialogues</span><span class="p">)</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a>        <span class="n">fipa_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">FipaDialogue</span><span class="p">,</span> <span class="n">fipa_dialogues</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">))</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>        <span class="k">if</span> <span class="n">fipa_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_unidentified_dialogue</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">)</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>            <span class="k">return</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>        <span class="c1"># handle message</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>        <span class="k">if</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">CFP</span><span class="p">:</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_cfp</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">)</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a>        <span class="k">elif</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">DECLINE</span><span class="p">:</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_decline</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">,</span> <span class="n">fipa_dialogues</span><span class="p">)</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a>        <span class="k">elif</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">ACCEPT</span><span class="p">:</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_accept</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">)</span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>        <span class="k">elif</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">INFORM</span><span class="p">:</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_inform</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">)</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_invalid</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">)</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the handler teardown.&quot;&quot;&quot;</span>
</code></pre></div>
<p>The code above contains the logic for handling <code>FipaMessages</code> received by the <code>my_generic_seller</code> AEA. We use <code>FipaDialogues</code> (more on this <a href="../generic-skills-step-by-step/#step-5-create-the-dialogues">below</a>) to keep track of the progress of the negotiation dialogue between the <code>my_generic_seller</code> AEA and the <code>my_generic_buyer</code> AEA.</p>
<p>In the above <code>handle</code> method, we first check if a received message belongs to an existing dialogue or if we have to create a new dialogue (the <code>recover dialogue</code> part). Once this is done, we break down the AEA's response to each type of negotiation message, as indicated by the message's performative (the <code>handle message</code> part). Therefore, we implement the AEA's response to each negotiation message type in a different handler function.</p>
<p>Below the unused <code>teardown</code> function, we continue by adding the following function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>    <span class="k">def</span> <span class="nf">_handle_unidentified_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="sd">        Handle an unidentified dialogue.</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>            <span class="s2">&quot;received invalid fipa message=</span><span class="si">{}</span><span class="s2">, unidentified dialogue.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">)</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        <span class="p">)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="n">default_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DefaultDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">default_dialogues</span><span class="p">)</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="n">default_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">default_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>            <span class="n">counterparty</span><span class="o">=</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">DefaultMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>            <span class="n">error_code</span><span class="o">=</span><span class="n">DefaultMessage</span><span class="o">.</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">INVALID_DIALOGUE</span><span class="p">,</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>            <span class="n">error_msg</span><span class="o">=</span><span class="s2">&quot;Invalid dialogue.&quot;</span><span class="p">,</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>            <span class="n">error_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fipa_message&quot;</span><span class="p">:</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">encode</span><span class="p">()},</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>        <span class="p">)</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">default_msg</span><span class="p">)</span>
</code></pre></div>
<p>The above code handles an unidentified dialogue by responding to the sender with a <code>DefaultMessage</code> containing the appropriate error information.</p>
<p>The next code block handles <code>CFP</code> (call-for-proposal) negotiation messages. Paste the following code below the <code>_handle_unidentified_dialogue</code> function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>    <span class="k">def</span> <span class="nf">_handle_cfp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="sd">        Handle the CFP.</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="sd">        If the CFP matches the supplied services then send a PROPOSE, otherwise send a DECLINE.</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="sd">        :param fipa_dialogue: the dialogue object</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>            <span class="s2">&quot;received CFP from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>        <span class="p">)</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>        <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_matching_supply</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">query</span><span class="p">):</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>            <span class="n">proposal</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="n">data_for_sale</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">generate_proposal_terms_and_data</span><span class="p">(</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>                <span class="n">fipa_msg</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>            <span class="p">)</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">data_for_sale</span> <span class="o">=</span> <span class="n">data_for_sale</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span> <span class="n">terms</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>                <span class="s2">&quot;sending a PROPOSE with proposal=</span><span class="si">{}</span><span class="s2"> to sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>                    <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>                <span class="p">)</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>            <span class="p">)</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>            <span class="n">proposal_msg</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">PROPOSE</span><span class="p">,</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>                <span class="n">target_message</span><span class="o">=</span><span class="n">fipa_msg</span><span class="p">,</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>                <span class="n">proposal</span><span class="o">=</span><span class="n">proposal</span><span class="p">,</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>            <span class="p">)</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">proposal_msg</span><span class="p">)</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>                <span class="s2">&quot;declined the CFP from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>            <span class="p">)</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>            <span class="n">decline_msg</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">DECLINE</span><span class="p">,</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>                <span class="n">target_message</span><span class="o">=</span><span class="n">fipa_msg</span><span class="p">,</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>            <span class="p">)</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">decline_msg</span><span class="p">)</span>
</code></pre></div>
<p>The above code sends a <code>PROPOSE</code> message back to the buyer as a response to its <code>CFP</code> if the requested services match our seller agent's supplied services, otherwise it will respond with a <code>DECLINE</code> message.</p>
<p>The next code-block  handles the decline message we receive from the buyer. Add the following code below the <code>_handle_cfp</code>function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>    <span class="k">def</span> <span class="nf">_handle_decline</span><span class="p">(</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>        <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>        <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span><span class="p">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>        <span class="n">fipa_dialogues</span><span class="p">:</span> <span class="n">FipaDialogues</span><span class="p">,</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="sd">        Handle the DECLINE.</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="sd">        Close the dialogue.</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="sd">        :param fipa_dialogue: the dialogue object</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="sd">        :param fipa_dialogues: the dialogues object</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>            <span class="s2">&quot;received DECLINE from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>        <span class="p">)</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>        <span class="n">fipa_dialogues</span><span class="o">.</span><span class="n">dialogue_stats</span><span class="o">.</span><span class="n">add_dialogue_endstate</span><span class="p">(</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>            <span class="n">FipaDialogue</span><span class="o">.</span><span class="n">EndState</span><span class="o">.</span><span class="n">DECLINED_PROPOSE</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">is_self_initiated</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>        <span class="p">)</span>
</code></pre></div>
<p>If we receive a decline message from the buyer we close the dialogue and terminate this conversation with <code>my_generic_buyer</code>.</p>
<p>Alternatively, we might receive an <code>ACCEPT</code> message. In order to handle this option add the following code below the <code>_handle_decline</code> function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>    <span class="k">def</span> <span class="nf">_handle_accept</span><span class="p">(</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="sd">        Handle the ACCEPT.</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="sd">        Respond with a MATCH_ACCEPT_W_INFORM which contains the address to send the funds to.</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="sd">        :param fipa_dialogue: the dialogue object</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>            <span class="s2">&quot;received ACCEPT from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>        <span class="p">)</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">sender_address</span><span class="p">}</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="n">match_accept_msg</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">MATCH_ACCEPT_W_INFORM</span><span class="p">,</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>            <span class="n">target_message</span><span class="o">=</span><span class="n">fipa_msg</span><span class="p">,</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>        <span class="p">)</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>            <span class="s2">&quot;sending MATCH_ACCEPT_W_INFORM to sender=</span><span class="si">{}</span><span class="s2"> with info=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>                <span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>                <span class="n">info</span><span class="p">,</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>            <span class="p">)</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>        <span class="p">)</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">match_accept_msg</span><span class="p">)</span>
</code></pre></div>
<p>When <code>my_generic_buyer</code> accepts the <code>Proposal</code> we send it and sends an <code>ACCEPT</code> message, we have to respond with another message (<code>MATCH_ACCEPT_W_INFORM</code>) to match the acceptance of the terms of trade and to inform the buyer of the address we would like it to send the funds to.</p>
<p>Lastly, we must handle an <code>INFORM</code> message, which the buyer uses to inform us that it has indeed sent the funds to the provided address. Add the following code at the end of the file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>    <span class="k">def</span> <span class="nf">_handle_inform</span><span class="p">(</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="sd">        Handle the INFORM.</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="sd">        If the INFORM message contains the transaction_digest then verify that it is settled, otherwise do nothing.</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="sd">        If the transaction is settled, send the data, otherwise do nothing.</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="sd">        :param fipa_dialogue: the dialogue object</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>            <span class="s2">&quot;received INFORM from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>        <span class="p">)</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_ledger_tx</span> <span class="ow">and</span> <span class="s2">&quot;transaction_digest&quot;</span> <span class="ow">in</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>                <span class="s2">&quot;checking whether transaction=</span><span class="si">{}</span><span class="s2"> has been received ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>                    <span class="n">fipa_msg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;transaction_digest&quot;</span><span class="p">]</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>                <span class="p">)</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>            <span class="p">)</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>            <span class="n">ledger_api_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>                <span class="n">LedgerApiDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">ledger_api_dialogues</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>            <span class="p">)</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>            <span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span> <span class="o">=</span> <span class="n">ledger_api_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>                <span class="n">counterparty</span><span class="o">=</span><span class="n">LEDGER_API_ADDRESS</span><span class="p">,</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">GET_TRANSACTION_RECEIPT</span><span class="p">,</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>                <span class="n">transaction_digest</span><span class="o">=</span><span class="n">TransactionDigest</span><span class="p">(</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>                    <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;transaction_digest&quot;</span><span class="p">]</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>                <span class="p">),</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>            <span class="p">)</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>            <span class="n">ledger_api_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">LedgerApiDialogue</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>            <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">associated_fipa_dialogue</span> <span class="o">=</span> <span class="n">fipa_dialogue</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>        <span class="k">elif</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_ledger_tx</span><span class="p">:</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>                <span class="s2">&quot;did not receive transaction digest from sender=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>                    <span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>                <span class="p">)</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>            <span class="p">)</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_ledger_tx</span> <span class="ow">and</span> <span class="s2">&quot;Done&quot;</span> <span class="ow">in</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>            <span class="n">inform_msg</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">INFORM</span><span class="p">,</span>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>                <span class="n">target_message</span><span class="o">=</span><span class="n">fipa_msg</span><span class="p">,</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>                <span class="n">info</span><span class="o">=</span><span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">data_for_sale</span><span class="p">,</span>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>            <span class="p">)</span>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">inform_msg</span><span class="p">)</span>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a>            <span class="n">fipa_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">FipaDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">fipa_dialogues</span><span class="p">)</span>
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a>            <span class="n">fipa_dialogues</span><span class="o">.</span><span class="n">dialogue_stats</span><span class="o">.</span><span class="n">add_dialogue_endstate</span><span class="p">(</span>
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a>                <span class="n">FipaDialogue</span><span class="o">.</span><span class="n">EndState</span><span class="o">.</span><span class="n">SUCCESSFUL</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">is_self_initiated</span>
<a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a>            <span class="p">)</span>
<a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a>                <span class="s2">&quot;transaction confirmed, sending data=</span><span class="si">{}</span><span class="s2"> to buyer=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a>                    <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">data_for_sale</span><span class="p">,</span>
<a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a>                    <span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span>
<a id="__codelineno-11-58" name="__codelineno-11-58" href="#__codelineno-11-58"></a>                <span class="p">)</span>
<a id="__codelineno-11-59" name="__codelineno-11-59" href="#__codelineno-11-59"></a>            <span class="p">)</span>
<a id="__codelineno-11-60" name="__codelineno-11-60" href="#__codelineno-11-60"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-61" name="__codelineno-11-61" href="#__codelineno-11-61"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-11-62" name="__codelineno-11-62" href="#__codelineno-11-62"></a>                <span class="s2">&quot;did not receive transaction confirmation from sender=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-11-63" name="__codelineno-11-63" href="#__codelineno-11-63"></a>                    <span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>
<a id="__codelineno-11-64" name="__codelineno-11-64" href="#__codelineno-11-64"></a>                <span class="p">)</span>
<a id="__codelineno-11-65" name="__codelineno-11-65" href="#__codelineno-11-65"></a>            <span class="p">)</span>
</code></pre></div>
<p>In the above code, we check the <code>INFORM</code> message. If it contains a transaction digest, then we verify that the transaction matches the proposal the buyer accepted. If the transaction is valid and we received the funds, then we send the data to the buyer. Otherwise, we do not send the data.</p>
<p>The remaining handlers are as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>    <span class="k">def</span> <span class="nf">_handle_invalid</span><span class="p">(</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="sd">        Handle a fipa message of invalid performative.</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="sd">        :param fipa_dialogue: the dialogue object</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>            <span class="s2">&quot;cannot handle fipa message of performative=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>                <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span><span class="p">,</span> <span class="n">fipa_dialogue</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>            <span class="p">)</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>        <span class="p">)</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="k">class</span> <span class="nc">GenericLedgerApiHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement the ledger handler.&quot;&quot;&quot;</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>    <span class="n">SUPPORTED_PROTOCOL</span> <span class="o">=</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">protocol_id</span>  <span class="c1"># type: Optional[PublicId]</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the setup for the handler.&quot;&quot;&quot;</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="sd">        Implement the reaction to a message.</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="sd">        :param message: the message</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>        <span class="n">ledger_api_msg</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>        <span class="c1"># recover dialogue</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>        <span class="n">ledger_api_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>            <span class="n">LedgerApiDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">ledger_api_dialogues</span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>        <span class="p">)</span>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>        <span class="n">ledger_api_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>            <span class="n">Optional</span><span class="p">[</span><span class="n">LedgerApiDialogue</span><span class="p">],</span> <span class="n">ledger_api_dialogues</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>        <span class="p">)</span>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>        <span class="k">if</span> <span class="n">ledger_api_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_unidentified_dialogue</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>            <span class="k">return</span>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>        <span class="c1"># handle message</span>
<a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>        <span class="k">if</span> <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span> <span class="ow">is</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">BALANCE</span><span class="p">:</span>
<a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_balance</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a>        <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a>            <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span>
<a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a>            <span class="ow">is</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">TRANSACTION_RECEIPT</span>
<a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a>        <span class="p">):</span>
<a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_transaction_receipt</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a>        <span class="k">elif</span> <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
<a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_error</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_invalid</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a>
<a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the handler teardown.&quot;&quot;&quot;</span>
<a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a>
<a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a>    <span class="k">def</span> <span class="nf">_handle_unidentified_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a><span class="sd">        Handle an unidentified dialogue.</span>
<a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a>
<a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a><span class="sd">        :param ledger_api_msg: the message</span>
<a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a>            <span class="s2">&quot;received invalid ledger_api message=</span><span class="si">{}</span><span class="s2">, unidentified dialogue.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a>                <span class="n">ledger_api_msg</span>
<a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a>            <span class="p">)</span>
<a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a>        <span class="p">)</span>
<a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a>
<a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a>    <span class="k">def</span> <span class="nf">_handle_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a><span class="sd">        Handle a message of balance performative.</span>
<a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a>
<a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a>            <span class="s2">&quot;starting balance on </span><span class="si">{}</span><span class="s2"> ledger=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-80" name="__codelineno-12-80" href="#__codelineno-12-80"></a>                <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span>
<a id="__codelineno-12-81" name="__codelineno-12-81" href="#__codelineno-12-81"></a>                <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span>
<a id="__codelineno-12-82" name="__codelineno-12-82" href="#__codelineno-12-82"></a>            <span class="p">)</span>
<a id="__codelineno-12-83" name="__codelineno-12-83" href="#__codelineno-12-83"></a>        <span class="p">)</span>
<a id="__codelineno-12-84" name="__codelineno-12-84" href="#__codelineno-12-84"></a>
<a id="__codelineno-12-85" name="__codelineno-12-85" href="#__codelineno-12-85"></a>    <span class="k">def</span> <span class="nf">_handle_transaction_receipt</span><span class="p">(</span>
<a id="__codelineno-12-86" name="__codelineno-12-86" href="#__codelineno-12-86"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span>
<a id="__codelineno-12-87" name="__codelineno-12-87" href="#__codelineno-12-87"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-88" name="__codelineno-12-88" href="#__codelineno-12-88"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-89" name="__codelineno-12-89" href="#__codelineno-12-89"></a><span class="sd">        Handle a message of balance performative.</span>
<a id="__codelineno-12-90" name="__codelineno-12-90" href="#__codelineno-12-90"></a>
<a id="__codelineno-12-91" name="__codelineno-12-91" href="#__codelineno-12-91"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-12-92" name="__codelineno-12-92" href="#__codelineno-12-92"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-12-93" name="__codelineno-12-93" href="#__codelineno-12-93"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-94" name="__codelineno-12-94" href="#__codelineno-12-94"></a>        <span class="n">fipa_dialogue</span> <span class="o">=</span> <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">associated_fipa_dialogue</span>
<a id="__codelineno-12-95" name="__codelineno-12-95" href="#__codelineno-12-95"></a>        <span class="n">is_settled</span> <span class="o">=</span> <span class="n">LedgerApis</span><span class="o">.</span><span class="n">is_transaction_settled</span><span class="p">(</span>
<a id="__codelineno-12-96" name="__codelineno-12-96" href="#__codelineno-12-96"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">transaction_receipt</span><span class="o">.</span><span class="n">receipt</span>
<a id="__codelineno-12-97" name="__codelineno-12-97" href="#__codelineno-12-97"></a>        <span class="p">)</span>
<a id="__codelineno-12-98" name="__codelineno-12-98" href="#__codelineno-12-98"></a>        <span class="n">is_valid</span> <span class="o">=</span> <span class="n">LedgerApis</span><span class="o">.</span><span class="n">is_transaction_valid</span><span class="p">(</span>
<a id="__codelineno-12-99" name="__codelineno-12-99" href="#__codelineno-12-99"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span>
<a id="__codelineno-12-100" name="__codelineno-12-100" href="#__codelineno-12-100"></a>            <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">transaction_receipt</span><span class="o">.</span><span class="n">transaction</span><span class="p">,</span>
<a id="__codelineno-12-101" name="__codelineno-12-101" href="#__codelineno-12-101"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">sender_address</span><span class="p">,</span>
<a id="__codelineno-12-102" name="__codelineno-12-102" href="#__codelineno-12-102"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">counterparty_address</span><span class="p">,</span>
<a id="__codelineno-12-103" name="__codelineno-12-103" href="#__codelineno-12-103"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">nonce</span><span class="p">,</span>
<a id="__codelineno-12-104" name="__codelineno-12-104" href="#__codelineno-12-104"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">counterparty_payable_amount</span><span class="p">,</span>
<a id="__codelineno-12-105" name="__codelineno-12-105" href="#__codelineno-12-105"></a>        <span class="p">)</span>
<a id="__codelineno-12-106" name="__codelineno-12-106" href="#__codelineno-12-106"></a>        <span class="k">if</span> <span class="n">is_settled</span> <span class="ow">and</span> <span class="n">is_valid</span><span class="p">:</span>
<a id="__codelineno-12-107" name="__codelineno-12-107" href="#__codelineno-12-107"></a>            <span class="n">last_message</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-12-108" name="__codelineno-12-108" href="#__codelineno-12-108"></a>                <span class="n">Optional</span><span class="p">[</span><span class="n">FipaMessage</span><span class="p">],</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">last_incoming_message</span>
<a id="__codelineno-12-109" name="__codelineno-12-109" href="#__codelineno-12-109"></a>            <span class="p">)</span>
<a id="__codelineno-12-110" name="__codelineno-12-110" href="#__codelineno-12-110"></a>            <span class="k">if</span> <span class="n">last_message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-111" name="__codelineno-12-111" href="#__codelineno-12-111"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot retrieve last fipa message.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-112" name="__codelineno-12-112" href="#__codelineno-12-112"></a>            <span class="n">inform_msg</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-12-113" name="__codelineno-12-113" href="#__codelineno-12-113"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">INFORM</span><span class="p">,</span>
<a id="__codelineno-12-114" name="__codelineno-12-114" href="#__codelineno-12-114"></a>                <span class="n">target_message</span><span class="o">=</span><span class="n">last_message</span><span class="p">,</span>
<a id="__codelineno-12-115" name="__codelineno-12-115" href="#__codelineno-12-115"></a>                <span class="n">info</span><span class="o">=</span><span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">data_for_sale</span><span class="p">,</span>
<a id="__codelineno-12-116" name="__codelineno-12-116" href="#__codelineno-12-116"></a>            <span class="p">)</span>
<a id="__codelineno-12-117" name="__codelineno-12-117" href="#__codelineno-12-117"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">inform_msg</span><span class="p">)</span>
<a id="__codelineno-12-118" name="__codelineno-12-118" href="#__codelineno-12-118"></a>            <span class="n">fipa_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">FipaDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">fipa_dialogues</span><span class="p">)</span>
<a id="__codelineno-12-119" name="__codelineno-12-119" href="#__codelineno-12-119"></a>            <span class="n">fipa_dialogues</span><span class="o">.</span><span class="n">dialogue_stats</span><span class="o">.</span><span class="n">add_dialogue_endstate</span><span class="p">(</span>
<a id="__codelineno-12-120" name="__codelineno-12-120" href="#__codelineno-12-120"></a>                <span class="n">FipaDialogue</span><span class="o">.</span><span class="n">EndState</span><span class="o">.</span><span class="n">SUCCESSFUL</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">is_self_initiated</span>
<a id="__codelineno-12-121" name="__codelineno-12-121" href="#__codelineno-12-121"></a>            <span class="p">)</span>
<a id="__codelineno-12-122" name="__codelineno-12-122" href="#__codelineno-12-122"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-12-123" name="__codelineno-12-123" href="#__codelineno-12-123"></a>                <span class="s2">&quot;transaction confirmed, sending data=</span><span class="si">{}</span><span class="s2"> to buyer=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-124" name="__codelineno-12-124" href="#__codelineno-12-124"></a>                    <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">data_for_sale</span><span class="p">,</span>
<a id="__codelineno-12-125" name="__codelineno-12-125" href="#__codelineno-12-125"></a>                    <span class="n">last_message</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span>
<a id="__codelineno-12-126" name="__codelineno-12-126" href="#__codelineno-12-126"></a>                <span class="p">)</span>
<a id="__codelineno-12-127" name="__codelineno-12-127" href="#__codelineno-12-127"></a>            <span class="p">)</span>
<a id="__codelineno-12-128" name="__codelineno-12-128" href="#__codelineno-12-128"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-129" name="__codelineno-12-129" href="#__codelineno-12-129"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-12-130" name="__codelineno-12-130" href="#__codelineno-12-130"></a>                <span class="s2">&quot;transaction_receipt=</span><span class="si">{}</span><span class="s2"> not settled or not valid, aborting&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-131" name="__codelineno-12-131" href="#__codelineno-12-131"></a>                    <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">transaction_receipt</span>
<a id="__codelineno-12-132" name="__codelineno-12-132" href="#__codelineno-12-132"></a>                <span class="p">)</span>
<a id="__codelineno-12-133" name="__codelineno-12-133" href="#__codelineno-12-133"></a>            <span class="p">)</span>
<a id="__codelineno-12-134" name="__codelineno-12-134" href="#__codelineno-12-134"></a>
<a id="__codelineno-12-135" name="__codelineno-12-135" href="#__codelineno-12-135"></a>    <span class="k">def</span> <span class="nf">_handle_error</span><span class="p">(</span>
<a id="__codelineno-12-136" name="__codelineno-12-136" href="#__codelineno-12-136"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span>
<a id="__codelineno-12-137" name="__codelineno-12-137" href="#__codelineno-12-137"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-138" name="__codelineno-12-138" href="#__codelineno-12-138"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-139" name="__codelineno-12-139" href="#__codelineno-12-139"></a><span class="sd">        Handle a message of error performative.</span>
<a id="__codelineno-12-140" name="__codelineno-12-140" href="#__codelineno-12-140"></a>
<a id="__codelineno-12-141" name="__codelineno-12-141" href="#__codelineno-12-141"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-12-142" name="__codelineno-12-142" href="#__codelineno-12-142"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-12-143" name="__codelineno-12-143" href="#__codelineno-12-143"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-144" name="__codelineno-12-144" href="#__codelineno-12-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-12-145" name="__codelineno-12-145" href="#__codelineno-12-145"></a>            <span class="s2">&quot;received ledger_api error message=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-146" name="__codelineno-12-146" href="#__codelineno-12-146"></a>                <span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span>
<a id="__codelineno-12-147" name="__codelineno-12-147" href="#__codelineno-12-147"></a>            <span class="p">)</span>
<a id="__codelineno-12-148" name="__codelineno-12-148" href="#__codelineno-12-148"></a>        <span class="p">)</span>
<a id="__codelineno-12-149" name="__codelineno-12-149" href="#__codelineno-12-149"></a>
<a id="__codelineno-12-150" name="__codelineno-12-150" href="#__codelineno-12-150"></a>    <span class="k">def</span> <span class="nf">_handle_invalid</span><span class="p">(</span>
<a id="__codelineno-12-151" name="__codelineno-12-151" href="#__codelineno-12-151"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span>
<a id="__codelineno-12-152" name="__codelineno-12-152" href="#__codelineno-12-152"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-153" name="__codelineno-12-153" href="#__codelineno-12-153"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-154" name="__codelineno-12-154" href="#__codelineno-12-154"></a><span class="sd">        Handle a message of invalid performative.</span>
<a id="__codelineno-12-155" name="__codelineno-12-155" href="#__codelineno-12-155"></a>
<a id="__codelineno-12-156" name="__codelineno-12-156" href="#__codelineno-12-156"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-12-157" name="__codelineno-12-157" href="#__codelineno-12-157"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-12-158" name="__codelineno-12-158" href="#__codelineno-12-158"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-159" name="__codelineno-12-159" href="#__codelineno-12-159"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-12-160" name="__codelineno-12-160" href="#__codelineno-12-160"></a>            <span class="s2">&quot;cannot handle ledger_api message of performative=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-161" name="__codelineno-12-161" href="#__codelineno-12-161"></a>                <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span><span class="p">,</span>
<a id="__codelineno-12-162" name="__codelineno-12-162" href="#__codelineno-12-162"></a>                <span class="n">ledger_api_dialogue</span><span class="p">,</span>
<a id="__codelineno-12-163" name="__codelineno-12-163" href="#__codelineno-12-163"></a>            <span class="p">)</span>
<a id="__codelineno-12-164" name="__codelineno-12-164" href="#__codelineno-12-164"></a>        <span class="p">)</span>
<a id="__codelineno-12-165" name="__codelineno-12-165" href="#__codelineno-12-165"></a>
<a id="__codelineno-12-166" name="__codelineno-12-166" href="#__codelineno-12-166"></a>
<a id="__codelineno-12-167" name="__codelineno-12-167" href="#__codelineno-12-167"></a><span class="k">class</span> <span class="nc">GenericOefSearchHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
<a id="__codelineno-12-168" name="__codelineno-12-168" href="#__codelineno-12-168"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements an OEF search handler.&quot;&quot;&quot;</span>
<a id="__codelineno-12-169" name="__codelineno-12-169" href="#__codelineno-12-169"></a>
<a id="__codelineno-12-170" name="__codelineno-12-170" href="#__codelineno-12-170"></a>    <span class="n">SUPPORTED_PROTOCOL</span> <span class="o">=</span> <span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">protocol_id</span>  <span class="c1"># type: Optional[PublicId]</span>
<a id="__codelineno-12-171" name="__codelineno-12-171" href="#__codelineno-12-171"></a>
<a id="__codelineno-12-172" name="__codelineno-12-172" href="#__codelineno-12-172"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-173" name="__codelineno-12-173" href="#__codelineno-12-173"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Call to setup the handler.&quot;&quot;&quot;</span>
<a id="__codelineno-12-174" name="__codelineno-12-174" href="#__codelineno-12-174"></a>
<a id="__codelineno-12-175" name="__codelineno-12-175" href="#__codelineno-12-175"></a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-176" name="__codelineno-12-176" href="#__codelineno-12-176"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-177" name="__codelineno-12-177" href="#__codelineno-12-177"></a><span class="sd">        Implement the reaction to a message.</span>
<a id="__codelineno-12-178" name="__codelineno-12-178" href="#__codelineno-12-178"></a>
<a id="__codelineno-12-179" name="__codelineno-12-179" href="#__codelineno-12-179"></a><span class="sd">        :param message: the message</span>
<a id="__codelineno-12-180" name="__codelineno-12-180" href="#__codelineno-12-180"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-181" name="__codelineno-12-181" href="#__codelineno-12-181"></a>        <span class="n">oef_search_msg</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">OefSearchMessage</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a id="__codelineno-12-182" name="__codelineno-12-182" href="#__codelineno-12-182"></a>
<a id="__codelineno-12-183" name="__codelineno-12-183" href="#__codelineno-12-183"></a>        <span class="c1"># recover dialogue</span>
<a id="__codelineno-12-184" name="__codelineno-12-184" href="#__codelineno-12-184"></a>        <span class="n">oef_search_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-12-185" name="__codelineno-12-185" href="#__codelineno-12-185"></a>            <span class="n">OefSearchDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">oef_search_dialogues</span>
<a id="__codelineno-12-186" name="__codelineno-12-186" href="#__codelineno-12-186"></a>        <span class="p">)</span>
<a id="__codelineno-12-187" name="__codelineno-12-187" href="#__codelineno-12-187"></a>        <span class="n">oef_search_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-12-188" name="__codelineno-12-188" href="#__codelineno-12-188"></a>            <span class="n">Optional</span><span class="p">[</span><span class="n">OefSearchDialogue</span><span class="p">],</span> <span class="n">oef_search_dialogues</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">)</span>
<a id="__codelineno-12-189" name="__codelineno-12-189" href="#__codelineno-12-189"></a>        <span class="p">)</span>
<a id="__codelineno-12-190" name="__codelineno-12-190" href="#__codelineno-12-190"></a>        <span class="k">if</span> <span class="n">oef_search_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-191" name="__codelineno-12-191" href="#__codelineno-12-191"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_unidentified_dialogue</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">)</span>
<a id="__codelineno-12-192" name="__codelineno-12-192" href="#__codelineno-12-192"></a>            <span class="k">return</span>
<a id="__codelineno-12-193" name="__codelineno-12-193" href="#__codelineno-12-193"></a>
<a id="__codelineno-12-194" name="__codelineno-12-194" href="#__codelineno-12-194"></a>        <span class="c1"># handle message</span>
<a id="__codelineno-12-195" name="__codelineno-12-195" href="#__codelineno-12-195"></a>        <span class="k">if</span> <span class="n">oef_search_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
<a id="__codelineno-12-196" name="__codelineno-12-196" href="#__codelineno-12-196"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_success</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">)</span>
<a id="__codelineno-12-197" name="__codelineno-12-197" href="#__codelineno-12-197"></a>        <span class="k">elif</span> <span class="n">oef_search_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">OEF_ERROR</span><span class="p">:</span>
<a id="__codelineno-12-198" name="__codelineno-12-198" href="#__codelineno-12-198"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_error</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">)</span>
<a id="__codelineno-12-199" name="__codelineno-12-199" href="#__codelineno-12-199"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-200" name="__codelineno-12-200" href="#__codelineno-12-200"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_invalid</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">)</span>
<a id="__codelineno-12-201" name="__codelineno-12-201" href="#__codelineno-12-201"></a>
<a id="__codelineno-12-202" name="__codelineno-12-202" href="#__codelineno-12-202"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-203" name="__codelineno-12-203" href="#__codelineno-12-203"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the handler teardown.&quot;&quot;&quot;</span>
<a id="__codelineno-12-204" name="__codelineno-12-204" href="#__codelineno-12-204"></a>
<a id="__codelineno-12-205" name="__codelineno-12-205" href="#__codelineno-12-205"></a>    <span class="k">def</span> <span class="nf">_handle_unidentified_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oef_search_msg</span><span class="p">:</span> <span class="n">OefSearchMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-206" name="__codelineno-12-206" href="#__codelineno-12-206"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-207" name="__codelineno-12-207" href="#__codelineno-12-207"></a><span class="sd">        Handle an unidentified dialogue.</span>
<a id="__codelineno-12-208" name="__codelineno-12-208" href="#__codelineno-12-208"></a>
<a id="__codelineno-12-209" name="__codelineno-12-209" href="#__codelineno-12-209"></a><span class="sd">        :param oef_search_msg: the message</span>
<a id="__codelineno-12-210" name="__codelineno-12-210" href="#__codelineno-12-210"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-211" name="__codelineno-12-211" href="#__codelineno-12-211"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-12-212" name="__codelineno-12-212" href="#__codelineno-12-212"></a>            <span class="s2">&quot;received invalid oef_search message=</span><span class="si">{}</span><span class="s2">, unidentified dialogue.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-213" name="__codelineno-12-213" href="#__codelineno-12-213"></a>                <span class="n">oef_search_msg</span>
<a id="__codelineno-12-214" name="__codelineno-12-214" href="#__codelineno-12-214"></a>            <span class="p">)</span>
<a id="__codelineno-12-215" name="__codelineno-12-215" href="#__codelineno-12-215"></a>        <span class="p">)</span>
<a id="__codelineno-12-216" name="__codelineno-12-216" href="#__codelineno-12-216"></a>
<a id="__codelineno-12-217" name="__codelineno-12-217" href="#__codelineno-12-217"></a>    <span class="k">def</span> <span class="nf">_handle_success</span><span class="p">(</span>
<a id="__codelineno-12-218" name="__codelineno-12-218" href="#__codelineno-12-218"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-12-219" name="__codelineno-12-219" href="#__codelineno-12-219"></a>        <span class="n">oef_search_success_msg</span><span class="p">:</span> <span class="n">OefSearchMessage</span><span class="p">,</span>
<a id="__codelineno-12-220" name="__codelineno-12-220" href="#__codelineno-12-220"></a>        <span class="n">oef_search_dialogue</span><span class="p">:</span> <span class="n">OefSearchDialogue</span><span class="p">,</span>
<a id="__codelineno-12-221" name="__codelineno-12-221" href="#__codelineno-12-221"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-222" name="__codelineno-12-222" href="#__codelineno-12-222"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-223" name="__codelineno-12-223" href="#__codelineno-12-223"></a><span class="sd">        Handle an oef search message.</span>
<a id="__codelineno-12-224" name="__codelineno-12-224" href="#__codelineno-12-224"></a>
<a id="__codelineno-12-225" name="__codelineno-12-225" href="#__codelineno-12-225"></a><span class="sd">        :param oef_search_success_msg: the oef search message</span>
<a id="__codelineno-12-226" name="__codelineno-12-226" href="#__codelineno-12-226"></a><span class="sd">        :param oef_search_dialogue: the dialogue</span>
<a id="__codelineno-12-227" name="__codelineno-12-227" href="#__codelineno-12-227"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-228" name="__codelineno-12-228" href="#__codelineno-12-228"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-12-229" name="__codelineno-12-229" href="#__codelineno-12-229"></a>            <span class="s2">&quot;received oef_search success message=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-230" name="__codelineno-12-230" href="#__codelineno-12-230"></a>                <span class="n">oef_search_success_msg</span><span class="p">,</span> <span class="n">oef_search_dialogue</span>
<a id="__codelineno-12-231" name="__codelineno-12-231" href="#__codelineno-12-231"></a>            <span class="p">)</span>
<a id="__codelineno-12-232" name="__codelineno-12-232" href="#__codelineno-12-232"></a>        <span class="p">)</span>
<a id="__codelineno-12-233" name="__codelineno-12-233" href="#__codelineno-12-233"></a>        <span class="n">target_message</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-12-234" name="__codelineno-12-234" href="#__codelineno-12-234"></a>            <span class="n">OefSearchMessage</span><span class="p">,</span>
<a id="__codelineno-12-235" name="__codelineno-12-235" href="#__codelineno-12-235"></a>            <span class="n">oef_search_dialogue</span><span class="o">.</span><span class="n">get_message_by_id</span><span class="p">(</span><span class="n">oef_search_success_msg</span><span class="o">.</span><span class="n">target</span><span class="p">),</span>
<a id="__codelineno-12-236" name="__codelineno-12-236" href="#__codelineno-12-236"></a>        <span class="p">)</span>
<a id="__codelineno-12-237" name="__codelineno-12-237" href="#__codelineno-12-237"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-12-238" name="__codelineno-12-238" href="#__codelineno-12-238"></a>            <span class="n">target_message</span><span class="o">.</span><span class="n">performative</span>
<a id="__codelineno-12-239" name="__codelineno-12-239" href="#__codelineno-12-239"></a>            <span class="o">==</span> <span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">REGISTER_SERVICE</span>
<a id="__codelineno-12-240" name="__codelineno-12-240" href="#__codelineno-12-240"></a>        <span class="p">):</span>
<a id="__codelineno-12-241" name="__codelineno-12-241" href="#__codelineno-12-241"></a>            <span class="n">description</span> <span class="o">=</span> <span class="n">target_message</span><span class="o">.</span><span class="n">service_description</span>
<a id="__codelineno-12-242" name="__codelineno-12-242" href="#__codelineno-12-242"></a>            <span class="n">data_model_name</span> <span class="o">=</span> <span class="n">description</span><span class="o">.</span><span class="n">data_model</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-12-243" name="__codelineno-12-243" href="#__codelineno-12-243"></a>            <span class="n">registration_behaviour</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-12-244" name="__codelineno-12-244" href="#__codelineno-12-244"></a>                <span class="n">GenericServiceRegistrationBehaviour</span><span class="p">,</span>
<a id="__codelineno-12-245" name="__codelineno-12-245" href="#__codelineno-12-245"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">service_registration</span><span class="p">,</span>
<a id="__codelineno-12-246" name="__codelineno-12-246" href="#__codelineno-12-246"></a>            <span class="p">)</span>
<a id="__codelineno-12-247" name="__codelineno-12-247" href="#__codelineno-12-247"></a>            <span class="k">if</span> <span class="s2">&quot;location_agent&quot;</span> <span class="ow">in</span> <span class="n">data_model_name</span><span class="p">:</span>
<a id="__codelineno-12-248" name="__codelineno-12-248" href="#__codelineno-12-248"></a>                <span class="n">registration_behaviour</span><span class="o">.</span><span class="n">register_service</span><span class="p">()</span>
<a id="__codelineno-12-249" name="__codelineno-12-249" href="#__codelineno-12-249"></a>            <span class="k">elif</span> <span class="s2">&quot;set_service_key&quot;</span> <span class="ow">in</span> <span class="n">data_model_name</span><span class="p">:</span>
<a id="__codelineno-12-250" name="__codelineno-12-250" href="#__codelineno-12-250"></a>                <span class="n">registration_behaviour</span><span class="o">.</span><span class="n">register_genus</span><span class="p">()</span>
<a id="__codelineno-12-251" name="__codelineno-12-251" href="#__codelineno-12-251"></a>            <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-12-252" name="__codelineno-12-252" href="#__codelineno-12-252"></a>                <span class="s2">&quot;personality_agent&quot;</span> <span class="ow">in</span> <span class="n">data_model_name</span>
<a id="__codelineno-12-253" name="__codelineno-12-253" href="#__codelineno-12-253"></a>                <span class="ow">and</span> <span class="n">description</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;piece&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;genus&quot;</span>
<a id="__codelineno-12-254" name="__codelineno-12-254" href="#__codelineno-12-254"></a>            <span class="p">):</span>
<a id="__codelineno-12-255" name="__codelineno-12-255" href="#__codelineno-12-255"></a>                <span class="n">registration_behaviour</span><span class="o">.</span><span class="n">register_classification</span><span class="p">()</span>
<a id="__codelineno-12-256" name="__codelineno-12-256" href="#__codelineno-12-256"></a>            <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-12-257" name="__codelineno-12-257" href="#__codelineno-12-257"></a>                <span class="s2">&quot;personality_agent&quot;</span> <span class="ow">in</span> <span class="n">data_model_name</span>
<a id="__codelineno-12-258" name="__codelineno-12-258" href="#__codelineno-12-258"></a>                <span class="ow">and</span> <span class="n">description</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;piece&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span>
<a id="__codelineno-12-259" name="__codelineno-12-259" href="#__codelineno-12-259"></a>            <span class="p">):</span>
<a id="__codelineno-12-260" name="__codelineno-12-260" href="#__codelineno-12-260"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-12-261" name="__codelineno-12-261" href="#__codelineno-12-261"></a>                    <span class="s2">&quot;the agent, with its genus and classification, and its service are successfully registered on the SOEF.&quot;</span>
<a id="__codelineno-12-262" name="__codelineno-12-262" href="#__codelineno-12-262"></a>                <span class="p">)</span>
<a id="__codelineno-12-263" name="__codelineno-12-263" href="#__codelineno-12-263"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-264" name="__codelineno-12-264" href="#__codelineno-12-264"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-12-265" name="__codelineno-12-265" href="#__codelineno-12-265"></a>                    <span class="sa">f</span><span class="s2">&quot;received soef SUCCESS message as a reply to the following unexpected message: </span><span class="si">{</span><span class="n">target_message</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-12-266" name="__codelineno-12-266" href="#__codelineno-12-266"></a>                <span class="p">)</span>
<a id="__codelineno-12-267" name="__codelineno-12-267" href="#__codelineno-12-267"></a>
<a id="__codelineno-12-268" name="__codelineno-12-268" href="#__codelineno-12-268"></a>    <span class="k">def</span> <span class="nf">_handle_error</span><span class="p">(</span>
<a id="__codelineno-12-269" name="__codelineno-12-269" href="#__codelineno-12-269"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-12-270" name="__codelineno-12-270" href="#__codelineno-12-270"></a>        <span class="n">oef_search_error_msg</span><span class="p">:</span> <span class="n">OefSearchMessage</span><span class="p">,</span>
<a id="__codelineno-12-271" name="__codelineno-12-271" href="#__codelineno-12-271"></a>        <span class="n">oef_search_dialogue</span><span class="p">:</span> <span class="n">OefSearchDialogue</span><span class="p">,</span>
<a id="__codelineno-12-272" name="__codelineno-12-272" href="#__codelineno-12-272"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-273" name="__codelineno-12-273" href="#__codelineno-12-273"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-274" name="__codelineno-12-274" href="#__codelineno-12-274"></a><span class="sd">        Handle an oef search message.</span>
<a id="__codelineno-12-275" name="__codelineno-12-275" href="#__codelineno-12-275"></a>
<a id="__codelineno-12-276" name="__codelineno-12-276" href="#__codelineno-12-276"></a><span class="sd">        :param oef_search_error_msg: the oef search message</span>
<a id="__codelineno-12-277" name="__codelineno-12-277" href="#__codelineno-12-277"></a><span class="sd">        :param oef_search_dialogue: the dialogue</span>
<a id="__codelineno-12-278" name="__codelineno-12-278" href="#__codelineno-12-278"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-279" name="__codelineno-12-279" href="#__codelineno-12-279"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-12-280" name="__codelineno-12-280" href="#__codelineno-12-280"></a>            <span class="s2">&quot;received oef_search error message=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-281" name="__codelineno-12-281" href="#__codelineno-12-281"></a>                <span class="n">oef_search_error_msg</span><span class="p">,</span> <span class="n">oef_search_dialogue</span>
<a id="__codelineno-12-282" name="__codelineno-12-282" href="#__codelineno-12-282"></a>            <span class="p">)</span>
<a id="__codelineno-12-283" name="__codelineno-12-283" href="#__codelineno-12-283"></a>        <span class="p">)</span>
<a id="__codelineno-12-284" name="__codelineno-12-284" href="#__codelineno-12-284"></a>        <span class="n">target_message</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-12-285" name="__codelineno-12-285" href="#__codelineno-12-285"></a>            <span class="n">OefSearchMessage</span><span class="p">,</span>
<a id="__codelineno-12-286" name="__codelineno-12-286" href="#__codelineno-12-286"></a>            <span class="n">oef_search_dialogue</span><span class="o">.</span><span class="n">get_message_by_id</span><span class="p">(</span><span class="n">oef_search_error_msg</span><span class="o">.</span><span class="n">target</span><span class="p">),</span>
<a id="__codelineno-12-287" name="__codelineno-12-287" href="#__codelineno-12-287"></a>        <span class="p">)</span>
<a id="__codelineno-12-288" name="__codelineno-12-288" href="#__codelineno-12-288"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-12-289" name="__codelineno-12-289" href="#__codelineno-12-289"></a>            <span class="n">target_message</span><span class="o">.</span><span class="n">performative</span>
<a id="__codelineno-12-290" name="__codelineno-12-290" href="#__codelineno-12-290"></a>            <span class="o">==</span> <span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">REGISTER_SERVICE</span>
<a id="__codelineno-12-291" name="__codelineno-12-291" href="#__codelineno-12-291"></a>        <span class="p">):</span>
<a id="__codelineno-12-292" name="__codelineno-12-292" href="#__codelineno-12-292"></a>            <span class="n">registration_behaviour</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-12-293" name="__codelineno-12-293" href="#__codelineno-12-293"></a>                <span class="n">GenericServiceRegistrationBehaviour</span><span class="p">,</span>
<a id="__codelineno-12-294" name="__codelineno-12-294" href="#__codelineno-12-294"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">service_registration</span><span class="p">,</span>
<a id="__codelineno-12-295" name="__codelineno-12-295" href="#__codelineno-12-295"></a>            <span class="p">)</span>
<a id="__codelineno-12-296" name="__codelineno-12-296" href="#__codelineno-12-296"></a>            <span class="n">registration_behaviour</span><span class="o">.</span><span class="n">failed_registration_msg</span> <span class="o">=</span> <span class="n">target_message</span>
<a id="__codelineno-12-297" name="__codelineno-12-297" href="#__codelineno-12-297"></a>
<a id="__codelineno-12-298" name="__codelineno-12-298" href="#__codelineno-12-298"></a>    <span class="k">def</span> <span class="nf">_handle_invalid</span><span class="p">(</span>
<a id="__codelineno-12-299" name="__codelineno-12-299" href="#__codelineno-12-299"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">oef_search_msg</span><span class="p">:</span> <span class="n">OefSearchMessage</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">:</span> <span class="n">OefSearchDialogue</span>
<a id="__codelineno-12-300" name="__codelineno-12-300" href="#__codelineno-12-300"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-301" name="__codelineno-12-301" href="#__codelineno-12-301"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-302" name="__codelineno-12-302" href="#__codelineno-12-302"></a><span class="sd">        Handle an oef search message.</span>
<a id="__codelineno-12-303" name="__codelineno-12-303" href="#__codelineno-12-303"></a>
<a id="__codelineno-12-304" name="__codelineno-12-304" href="#__codelineno-12-304"></a><span class="sd">        :param oef_search_msg: the oef search message</span>
<a id="__codelineno-12-305" name="__codelineno-12-305" href="#__codelineno-12-305"></a><span class="sd">        :param oef_search_dialogue: the dialogue</span>
<a id="__codelineno-12-306" name="__codelineno-12-306" href="#__codelineno-12-306"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-12-307" name="__codelineno-12-307" href="#__codelineno-12-307"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-12-308" name="__codelineno-12-308" href="#__codelineno-12-308"></a>            <span class="s2">&quot;cannot handle oef_search message of performative=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-12-309" name="__codelineno-12-309" href="#__codelineno-12-309"></a>                <span class="n">oef_search_msg</span><span class="o">.</span><span class="n">performative</span><span class="p">,</span>
<a id="__codelineno-12-310" name="__codelineno-12-310" href="#__codelineno-12-310"></a>                <span class="n">oef_search_dialogue</span><span class="p">,</span>
<a id="__codelineno-12-311" name="__codelineno-12-311" href="#__codelineno-12-311"></a>            <span class="p">)</span>
<a id="__codelineno-12-312" name="__codelineno-12-312" href="#__codelineno-12-312"></a>        <span class="p">)</span>
</code></pre></div>
<p>The <code>GenericLedgerApiHandler</code> deals with <code>LedgerApiMessages</code> from the ledger connection and the <code>GenericOefSearchHandler</code> handles <code>OefSearchMessages</code> from the SOEF connection.</p>
<h3 id="step-4-create-the-strategy">Step 4: Create the Strategy<a class="headerlink" href="#step-4-create-the-strategy" title="Permanent link">&para;</a></h3>
<p>Next, we are going to create the strategy that we want our <code>my_generic_seller</code> AEA to follow. Rename the <code>my_model.py</code> file (<code>my_generic_seller/skills/generic_seller/my_model.py</code>) to <code>strategy.py</code> and replace the stub code with the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">import</span> <span class="nn">uuid</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kn">from</span> <span class="nn">aea.common</span> <span class="kn">import</span> <span class="n">Address</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="kn">from</span> <span class="nn">aea.crypto.ledger_apis</span> <span class="kn">import</span> <span class="n">LedgerApis</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="kn">from</span> <span class="nn">aea.exceptions</span> <span class="kn">import</span> <span class="n">enforce</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="kn">from</span> <span class="nn">aea.helpers.search.generic</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="n">AGENT_LOCATION_MODEL</span><span class="p">,</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>    <span class="n">AGENT_PERSONALITY_MODEL</span><span class="p">,</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>    <span class="n">AGENT_REMOVE_SERVICE_MODEL</span><span class="p">,</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>    <span class="n">AGENT_SET_SERVICE_MODEL</span><span class="p">,</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>    <span class="n">SIMPLE_SERVICE_MODEL</span><span class="p">,</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="p">)</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="kn">from</span> <span class="nn">aea.helpers.search.models</span> <span class="kn">import</span> <span class="n">Description</span><span class="p">,</span> <span class="n">Location</span><span class="p">,</span> <span class="n">Query</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="kn">from</span> <span class="nn">aea.helpers.transaction.base</span> <span class="kn">import</span> <span class="n">Terms</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="kn">from</span> <span class="nn">aea.skills.base</span> <span class="kn">import</span> <span class="n">Model</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="n">DEFAULT_IS_LEDGER_TX</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="n">DEFAULT_UNIT_PRICE</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="n">DEFAULT_SERVICE_ID</span> <span class="o">=</span> <span class="s2">&quot;generic_service&quot;</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="n">DEFAULT_LOCATION</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="mf">0.1270</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="mf">51.5194</span><span class="p">}</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="n">DEFAULT_SERVICE_DATA</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;seller_service&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;generic_service&quot;</span><span class="p">}</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="n">DEFAULT_PERSONALITY_DATA</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;piece&quot;</span><span class="p">:</span> <span class="s2">&quot;genus&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">}</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="n">DEFAULT_CLASSIFICATION</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;piece&quot;</span><span class="p">:</span> <span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;seller&quot;</span><span class="p">}</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="n">DEFAULT_HAS_DATA_SOURCE</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="n">DEFAULT_DATA_FOR_SALE</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>    <span class="s2">&quot;some_generic_data_key&quot;</span><span class="p">:</span> <span class="s2">&quot;some_generic_data_value&quot;</span>
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="p">}</span>  <span class="c1"># type: Optional[Dict[str, Any]]</span>
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="k">class</span> <span class="nc">GenericStrategy</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class defines a strategy for the agent.&quot;&quot;&quot;</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a><span class="sd">        Initialize the strategy of the agent.</span>
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a>        <span class="n">ledger_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ledger_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a>        <span class="n">currency_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;currency_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-13-46" name="__codelineno-13-46" href="#__codelineno-13-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_ledger_tx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;is_ledger_tx&quot;</span><span class="p">,</span> <span class="n">DEFAULT_IS_LEDGER_TX</span><span class="p">)</span>
<a id="__codelineno-13-47" name="__codelineno-13-47" href="#__codelineno-13-47"></a>
<a id="__codelineno-13-48" name="__codelineno-13-48" href="#__codelineno-13-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_unit_price</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;unit_price&quot;</span><span class="p">,</span> <span class="n">DEFAULT_UNIT_PRICE</span><span class="p">)</span>
<a id="__codelineno-13-49" name="__codelineno-13-49" href="#__codelineno-13-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_service_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;service_id&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVICE_ID</span><span class="p">)</span>
<a id="__codelineno-13-50" name="__codelineno-13-50" href="#__codelineno-13-50"></a>
<a id="__codelineno-13-51" name="__codelineno-13-51" href="#__codelineno-13-51"></a>        <span class="n">location</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">DEFAULT_LOCATION</span><span class="p">)</span>
<a id="__codelineno-13-52" name="__codelineno-13-52" href="#__codelineno-13-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_location</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-13-53" name="__codelineno-13-53" href="#__codelineno-13-53"></a>            <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">Location</span><span class="p">(</span>
<a id="__codelineno-13-54" name="__codelineno-13-54" href="#__codelineno-13-54"></a>                <span class="n">latitude</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="n">longitude</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span>
<a id="__codelineno-13-55" name="__codelineno-13-55" href="#__codelineno-13-55"></a>            <span class="p">)</span>
<a id="__codelineno-13-56" name="__codelineno-13-56" href="#__codelineno-13-56"></a>        <span class="p">}</span>
<a id="__codelineno-13-57" name="__codelineno-13-57" href="#__codelineno-13-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_personality_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
<a id="__codelineno-13-58" name="__codelineno-13-58" href="#__codelineno-13-58"></a>            <span class="s2">&quot;personality_data&quot;</span><span class="p">,</span> <span class="n">DEFAULT_PERSONALITY_DATA</span>
<a id="__codelineno-13-59" name="__codelineno-13-59" href="#__codelineno-13-59"></a>        <span class="p">)</span>
<a id="__codelineno-13-60" name="__codelineno-13-60" href="#__codelineno-13-60"></a>        <span class="n">enforce</span><span class="p">(</span>
<a id="__codelineno-13-61" name="__codelineno-13-61" href="#__codelineno-13-61"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_personality_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-13-62" name="__codelineno-13-62" href="#__codelineno-13-62"></a>            <span class="ow">and</span> <span class="s2">&quot;piece&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_personality_data</span>
<a id="__codelineno-13-63" name="__codelineno-13-63" href="#__codelineno-13-63"></a>            <span class="ow">and</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_personality_data</span><span class="p">,</span>
<a id="__codelineno-13-64" name="__codelineno-13-64" href="#__codelineno-13-64"></a>            <span class="s2">&quot;personality_data must contain keys `key` and `value`&quot;</span><span class="p">,</span>
<a id="__codelineno-13-65" name="__codelineno-13-65" href="#__codelineno-13-65"></a>        <span class="p">)</span>
<a id="__codelineno-13-66" name="__codelineno-13-66" href="#__codelineno-13-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_classification</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="n">DEFAULT_CLASSIFICATION</span><span class="p">)</span>
<a id="__codelineno-13-67" name="__codelineno-13-67" href="#__codelineno-13-67"></a>        <span class="n">enforce</span><span class="p">(</span>
<a id="__codelineno-13-68" name="__codelineno-13-68" href="#__codelineno-13-68"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_classification</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-13-69" name="__codelineno-13-69" href="#__codelineno-13-69"></a>            <span class="ow">and</span> <span class="s2">&quot;piece&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_classification</span>
<a id="__codelineno-13-70" name="__codelineno-13-70" href="#__codelineno-13-70"></a>            <span class="ow">and</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_classification</span><span class="p">,</span>
<a id="__codelineno-13-71" name="__codelineno-13-71" href="#__codelineno-13-71"></a>            <span class="s2">&quot;classification must contain keys `key` and `value`&quot;</span><span class="p">,</span>
<a id="__codelineno-13-72" name="__codelineno-13-72" href="#__codelineno-13-72"></a>        <span class="p">)</span>
<a id="__codelineno-13-73" name="__codelineno-13-73" href="#__codelineno-13-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_service_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;service_data&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVICE_DATA</span><span class="p">)</span>
<a id="__codelineno-13-74" name="__codelineno-13-74" href="#__codelineno-13-74"></a>        <span class="n">enforce</span><span class="p">(</span>
<a id="__codelineno-13-75" name="__codelineno-13-75" href="#__codelineno-13-75"></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_service_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<a id="__codelineno-13-76" name="__codelineno-13-76" href="#__codelineno-13-76"></a>            <span class="ow">and</span> <span class="s2">&quot;key&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_service_data</span>
<a id="__codelineno-13-77" name="__codelineno-13-77" href="#__codelineno-13-77"></a>            <span class="ow">and</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_service_data</span><span class="p">,</span>
<a id="__codelineno-13-78" name="__codelineno-13-78" href="#__codelineno-13-78"></a>            <span class="s2">&quot;service_data must contain keys `key` and `value`&quot;</span><span class="p">,</span>
<a id="__codelineno-13-79" name="__codelineno-13-79" href="#__codelineno-13-79"></a>        <span class="p">)</span>
<a id="__codelineno-13-80" name="__codelineno-13-80" href="#__codelineno-13-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_service_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_service_data</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]}</span>
<a id="__codelineno-13-81" name="__codelineno-13-81" href="#__codelineno-13-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_simple_service_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-13-82" name="__codelineno-13-82" href="#__codelineno-13-82"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_service_data</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_service_data</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
<a id="__codelineno-13-83" name="__codelineno-13-83" href="#__codelineno-13-83"></a>        <span class="p">}</span>
<a id="__codelineno-13-84" name="__codelineno-13-84" href="#__codelineno-13-84"></a>
<a id="__codelineno-13-85" name="__codelineno-13-85" href="#__codelineno-13-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_has_data_source</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;has_data_source&quot;</span><span class="p">,</span> <span class="n">DEFAULT_HAS_DATA_SOURCE</span><span class="p">)</span>
<a id="__codelineno-13-86" name="__codelineno-13-86" href="#__codelineno-13-86"></a>        <span class="n">data_for_sale_ordered</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;data_for_sale&quot;</span><span class="p">,</span> <span class="n">DEFAULT_DATA_FOR_SALE</span><span class="p">)</span>
<a id="__codelineno-13-87" name="__codelineno-13-87" href="#__codelineno-13-87"></a>        <span class="n">data_for_sale</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-13-88" name="__codelineno-13-88" href="#__codelineno-13-88"></a>            <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data_for_sale_ordered</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-13-89" name="__codelineno-13-89" href="#__codelineno-13-89"></a>        <span class="p">}</span>
<a id="__codelineno-13-90" name="__codelineno-13-90" href="#__codelineno-13-90"></a>
<a id="__codelineno-13-91" name="__codelineno-13-91" href="#__codelineno-13-91"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-13-92" name="__codelineno-13-92" href="#__codelineno-13-92"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ledger_id</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-13-93" name="__codelineno-13-93" href="#__codelineno-13-93"></a>            <span class="n">ledger_id</span> <span class="k">if</span> <span class="n">ledger_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">default_ledger_id</span>
<a id="__codelineno-13-94" name="__codelineno-13-94" href="#__codelineno-13-94"></a>        <span class="p">)</span>
<a id="__codelineno-13-95" name="__codelineno-13-95" href="#__codelineno-13-95"></a>        <span class="k">if</span> <span class="n">currency_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-13-96" name="__codelineno-13-96" href="#__codelineno-13-96"></a>            <span class="n">currency_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currency_denominations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ledger_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-13-97" name="__codelineno-13-97" href="#__codelineno-13-97"></a>            <span class="n">enforce</span><span class="p">(</span>
<a id="__codelineno-13-98" name="__codelineno-13-98" href="#__codelineno-13-98"></a>                <span class="n">currency_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-13-99" name="__codelineno-13-99" href="#__codelineno-13-99"></a>                <span class="sa">f</span><span class="s2">&quot;Currency denomination for ledger_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ledger_id</span><span class="si">}</span><span class="s2"> not specified.&quot;</span><span class="p">,</span>
<a id="__codelineno-13-100" name="__codelineno-13-100" href="#__codelineno-13-100"></a>            <span class="p">)</span>
<a id="__codelineno-13-101" name="__codelineno-13-101" href="#__codelineno-13-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_currency_id</span> <span class="o">=</span> <span class="n">currency_id</span>
<a id="__codelineno-13-102" name="__codelineno-13-102" href="#__codelineno-13-102"></a>        <span class="n">enforce</span><span class="p">(</span>
<a id="__codelineno-13-103" name="__codelineno-13-103" href="#__codelineno-13-103"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_addresses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ledger_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-13-104" name="__codelineno-13-104" href="#__codelineno-13-104"></a>            <span class="s2">&quot;Wallet does not contain cryptos for provided ledger id.&quot;</span><span class="p">,</span>
<a id="__codelineno-13-105" name="__codelineno-13-105" href="#__codelineno-13-105"></a>        <span class="p">)</span>
<a id="__codelineno-13-106" name="__codelineno-13-106" href="#__codelineno-13-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data_for_sale</span> <span class="o">=</span> <span class="n">data_for_sale</span>
</code></pre></div>
<p>In the above code snippet, we initialise the strategy class by trying to read the variables specific to the strategy from a YAML configuration file. If any variable is not provided, some default values will be used.</p>
<p>The following properties and methods deal with different aspects of the strategy. They should be relatively self-descriptive. Add them under the initialization of the strategy class:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>    <span class="nd">@property</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="k">def</span> <span class="nf">data_for_sale</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the data for sale.&quot;&quot;&quot;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_data_source</span><span class="p">:</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_from_data_source</span><span class="p">()</span>  <span class="c1"># pragma: nocover</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_for_sale</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="nd">@property</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="k">def</span> <span class="nf">ledger_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ledger id.&quot;&quot;&quot;</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ledger_id</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    <span class="nd">@property</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>    <span class="k">def</span> <span class="nf">is_ledger_tx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether or not tx are settled on a ledger.&quot;&quot;&quot;</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_ledger_tx</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>    <span class="k">def</span> <span class="nf">get_location_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Description</span><span class="p">:</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="sd">        Get the location description.</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="sd">        :return: a description of the agent&#39;s location</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">Description</span><span class="p">(</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_agent_location</span><span class="p">,</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>            <span class="n">data_model</span><span class="o">=</span><span class="n">AGENT_LOCATION_MODEL</span><span class="p">,</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>        <span class="p">)</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>        <span class="k">return</span> <span class="n">description</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>    <span class="k">def</span> <span class="nf">get_register_service_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Description</span><span class="p">:</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="sd">        Get the register service description.</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="sd">        :return: a description of the offered services</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">Description</span><span class="p">(</span>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_service_data</span><span class="p">,</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>            <span class="n">data_model</span><span class="o">=</span><span class="n">AGENT_SET_SERVICE_MODEL</span><span class="p">,</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>        <span class="p">)</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>        <span class="k">return</span> <span class="n">description</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>    <span class="k">def</span> <span class="nf">get_register_personality_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Description</span><span class="p">:</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="sd">        Get the register personality description.</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a><span class="sd">        :return: a description of the personality</span>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">Description</span><span class="p">(</span>
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_personality_data</span><span class="p">,</span>
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>            <span class="n">data_model</span><span class="o">=</span><span class="n">AGENT_PERSONALITY_MODEL</span><span class="p">,</span>
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>        <span class="p">)</span>
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>        <span class="k">return</span> <span class="n">description</span>
<a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>
<a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a>    <span class="k">def</span> <span class="nf">get_register_classification_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Description</span><span class="p">:</span>
<a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="sd">        Get the register classification description.</span>
<a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a>
<a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a><span class="sd">        :return: a description of the classification</span>
<a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">Description</span><span class="p">(</span>
<a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_classification</span><span class="p">,</span>
<a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a>            <span class="n">data_model</span><span class="o">=</span><span class="n">AGENT_PERSONALITY_MODEL</span><span class="p">,</span>
<a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a>        <span class="p">)</span>
<a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a>        <span class="k">return</span> <span class="n">description</span>
<a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a>
<a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a>    <span class="k">def</span> <span class="nf">get_service_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Description</span><span class="p">:</span>
<a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a><span class="sd">        Get the simple service description.</span>
<a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a>
<a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a><span class="sd">        :return: a description of the offered services</span>
<a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">Description</span><span class="p">(</span>
<a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_simple_service_data</span><span class="p">,</span>
<a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a>            <span class="n">data_model</span><span class="o">=</span><span class="n">SIMPLE_SERVICE_MODEL</span><span class="p">,</span>
<a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a>        <span class="p">)</span>
<a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a>        <span class="k">return</span> <span class="n">description</span>
<a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a>
<a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a>    <span class="k">def</span> <span class="nf">get_unregister_service_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Description</span><span class="p">:</span>
<a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a><span class="sd">        Get the unregister service description.</span>
<a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a>
<a id="__codelineno-14-82" name="__codelineno-14-82" href="#__codelineno-14-82"></a><span class="sd">        :return: a description of the to be removed service</span>
<a id="__codelineno-14-83" name="__codelineno-14-83" href="#__codelineno-14-83"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-84" name="__codelineno-14-84" href="#__codelineno-14-84"></a>        <span class="n">description</span> <span class="o">=</span> <span class="n">Description</span><span class="p">(</span>
<a id="__codelineno-14-85" name="__codelineno-14-85" href="#__codelineno-14-85"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_service_data</span><span class="p">,</span>
<a id="__codelineno-14-86" name="__codelineno-14-86" href="#__codelineno-14-86"></a>            <span class="n">data_model</span><span class="o">=</span><span class="n">AGENT_REMOVE_SERVICE_MODEL</span><span class="p">,</span>
<a id="__codelineno-14-87" name="__codelineno-14-87" href="#__codelineno-14-87"></a>        <span class="p">)</span>
<a id="__codelineno-14-88" name="__codelineno-14-88" href="#__codelineno-14-88"></a>        <span class="k">return</span> <span class="n">description</span>
<a id="__codelineno-14-89" name="__codelineno-14-89" href="#__codelineno-14-89"></a>
<a id="__codelineno-14-90" name="__codelineno-14-90" href="#__codelineno-14-90"></a>    <span class="k">def</span> <span class="nf">is_matching_supply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">Query</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-14-91" name="__codelineno-14-91" href="#__codelineno-14-91"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-92" name="__codelineno-14-92" href="#__codelineno-14-92"></a><span class="sd">        Check if the query matches the supply.</span>
<a id="__codelineno-14-93" name="__codelineno-14-93" href="#__codelineno-14-93"></a>
<a id="__codelineno-14-94" name="__codelineno-14-94" href="#__codelineno-14-94"></a><span class="sd">        :param query: the query</span>
<a id="__codelineno-14-95" name="__codelineno-14-95" href="#__codelineno-14-95"></a><span class="sd">        :return: bool indicating whether matches or not</span>
<a id="__codelineno-14-96" name="__codelineno-14-96" href="#__codelineno-14-96"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-97" name="__codelineno-14-97" href="#__codelineno-14-97"></a>        <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_service_description</span><span class="p">())</span>
<a id="__codelineno-14-98" name="__codelineno-14-98" href="#__codelineno-14-98"></a>
<a id="__codelineno-14-99" name="__codelineno-14-99" href="#__codelineno-14-99"></a>    <span class="k">def</span> <span class="nf">generate_proposal_terms_and_data</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-14-100" name="__codelineno-14-100" href="#__codelineno-14-100"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">Query</span><span class="p">,</span> <span class="n">counterparty_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-14-101" name="__codelineno-14-101" href="#__codelineno-14-101"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Description</span><span class="p">,</span> <span class="n">Terms</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<a id="__codelineno-14-102" name="__codelineno-14-102" href="#__codelineno-14-102"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-103" name="__codelineno-14-103" href="#__codelineno-14-103"></a><span class="sd">        Generate a proposal matching the query.</span>
<a id="__codelineno-14-104" name="__codelineno-14-104" href="#__codelineno-14-104"></a>
<a id="__codelineno-14-105" name="__codelineno-14-105" href="#__codelineno-14-105"></a><span class="sd">        :param query: the query</span>
<a id="__codelineno-14-106" name="__codelineno-14-106" href="#__codelineno-14-106"></a><span class="sd">        :param counterparty_address: the counterparty of the proposal.</span>
<a id="__codelineno-14-107" name="__codelineno-14-107" href="#__codelineno-14-107"></a><span class="sd">        :return: a tuple of proposal, terms and the weather data</span>
<a id="__codelineno-14-108" name="__codelineno-14-108" href="#__codelineno-14-108"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-109" name="__codelineno-14-109" href="#__codelineno-14-109"></a>        <span class="n">data_for_sale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_for_sale</span>
<a id="__codelineno-14-110" name="__codelineno-14-110" href="#__codelineno-14-110"></a>        <span class="n">sale_quantity</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_for_sale</span><span class="p">)</span>
<a id="__codelineno-14-111" name="__codelineno-14-111" href="#__codelineno-14-111"></a>        <span class="n">seller_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_addresses</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">]</span>
<a id="__codelineno-14-112" name="__codelineno-14-112" href="#__codelineno-14-112"></a>        <span class="n">total_price</span> <span class="o">=</span> <span class="n">sale_quantity</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit_price</span>
<a id="__codelineno-14-113" name="__codelineno-14-113" href="#__codelineno-14-113"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ledger_tx</span><span class="p">:</span>
<a id="__codelineno-14-114" name="__codelineno-14-114" href="#__codelineno-14-114"></a>            <span class="n">tx_nonce</span> <span class="o">=</span> <span class="n">LedgerApis</span><span class="o">.</span><span class="n">generate_tx_nonce</span><span class="p">(</span>
<a id="__codelineno-14-115" name="__codelineno-14-115" href="#__codelineno-14-115"></a>                <span class="n">identifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span>
<a id="__codelineno-14-116" name="__codelineno-14-116" href="#__codelineno-14-116"></a>                <span class="n">seller</span><span class="o">=</span><span class="n">seller_address</span><span class="p">,</span>
<a id="__codelineno-14-117" name="__codelineno-14-117" href="#__codelineno-14-117"></a>                <span class="n">client</span><span class="o">=</span><span class="n">counterparty_address</span><span class="p">,</span>
<a id="__codelineno-14-118" name="__codelineno-14-118" href="#__codelineno-14-118"></a>            <span class="p">)</span>
<a id="__codelineno-14-119" name="__codelineno-14-119" href="#__codelineno-14-119"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-14-120" name="__codelineno-14-120" href="#__codelineno-14-120"></a>            <span class="n">tx_nonce</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>  <span class="c1"># pragma: nocover</span>
<a id="__codelineno-14-121" name="__codelineno-14-121" href="#__codelineno-14-121"></a>        <span class="n">proposal</span> <span class="o">=</span> <span class="n">Description</span><span class="p">(</span>
<a id="__codelineno-14-122" name="__codelineno-14-122" href="#__codelineno-14-122"></a>            <span class="p">{</span>
<a id="__codelineno-14-123" name="__codelineno-14-123" href="#__codelineno-14-123"></a>                <span class="s2">&quot;ledger_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span>
<a id="__codelineno-14-124" name="__codelineno-14-124" href="#__codelineno-14-124"></a>                <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="n">total_price</span><span class="p">,</span>
<a id="__codelineno-14-125" name="__codelineno-14-125" href="#__codelineno-14-125"></a>                <span class="s2">&quot;currency_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currency_id</span><span class="p">,</span>
<a id="__codelineno-14-126" name="__codelineno-14-126" href="#__codelineno-14-126"></a>                <span class="s2">&quot;service_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_service_id</span><span class="p">,</span>
<a id="__codelineno-14-127" name="__codelineno-14-127" href="#__codelineno-14-127"></a>                <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="n">sale_quantity</span><span class="p">,</span>
<a id="__codelineno-14-128" name="__codelineno-14-128" href="#__codelineno-14-128"></a>                <span class="s2">&quot;tx_nonce&quot;</span><span class="p">:</span> <span class="n">tx_nonce</span><span class="p">,</span>
<a id="__codelineno-14-129" name="__codelineno-14-129" href="#__codelineno-14-129"></a>            <span class="p">}</span>
<a id="__codelineno-14-130" name="__codelineno-14-130" href="#__codelineno-14-130"></a>        <span class="p">)</span>
<a id="__codelineno-14-131" name="__codelineno-14-131" href="#__codelineno-14-131"></a>        <span class="n">terms</span> <span class="o">=</span> <span class="n">Terms</span><span class="p">(</span>
<a id="__codelineno-14-132" name="__codelineno-14-132" href="#__codelineno-14-132"></a>            <span class="n">ledger_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span>
<a id="__codelineno-14-133" name="__codelineno-14-133" href="#__codelineno-14-133"></a>            <span class="n">sender_address</span><span class="o">=</span><span class="n">seller_address</span><span class="p">,</span>
<a id="__codelineno-14-134" name="__codelineno-14-134" href="#__codelineno-14-134"></a>            <span class="n">counterparty_address</span><span class="o">=</span><span class="n">counterparty_address</span><span class="p">,</span>
<a id="__codelineno-14-135" name="__codelineno-14-135" href="#__codelineno-14-135"></a>            <span class="n">amount_by_currency_id</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_currency_id</span><span class="p">:</span> <span class="n">total_price</span><span class="p">},</span>
<a id="__codelineno-14-136" name="__codelineno-14-136" href="#__codelineno-14-136"></a>            <span class="n">quantities_by_good_id</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_service_id</span><span class="p">:</span> <span class="o">-</span><span class="n">sale_quantity</span><span class="p">},</span>
<a id="__codelineno-14-137" name="__codelineno-14-137" href="#__codelineno-14-137"></a>            <span class="n">is_sender_payable_tx_fee</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-14-138" name="__codelineno-14-138" href="#__codelineno-14-138"></a>            <span class="n">nonce</span><span class="o">=</span><span class="n">tx_nonce</span><span class="p">,</span>
<a id="__codelineno-14-139" name="__codelineno-14-139" href="#__codelineno-14-139"></a>            <span class="n">fee_by_currency_id</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_currency_id</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-14-140" name="__codelineno-14-140" href="#__codelineno-14-140"></a>        <span class="p">)</span>
<a id="__codelineno-14-141" name="__codelineno-14-141" href="#__codelineno-14-141"></a>        <span class="k">return</span> <span class="n">proposal</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="n">data_for_sale</span>
<a id="__codelineno-14-142" name="__codelineno-14-142" href="#__codelineno-14-142"></a>
<a id="__codelineno-14-143" name="__codelineno-14-143" href="#__codelineno-14-143"></a>    <span class="k">def</span> <span class="nf">collect_from_data_source</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-14-144" name="__codelineno-14-144" href="#__codelineno-14-144"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the logic to communicate with the sensor.&quot;&quot;&quot;</span>
<a id="__codelineno-14-145" name="__codelineno-14-145" href="#__codelineno-14-145"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div>
<p>The helper private function <code>collect_from_data_source</code> is where we read data from a sensor or if there are no sensor we use some default data provided (see the <code>data_for_sale</code> property).</p>
<h3 id="step-5-create-the-dialogues">Step 5: Create the Dialogues<a class="headerlink" href="#step-5-create-the-dialogues" title="Permanent link">&para;</a></h3>
<p>To keep track of the structure and progress of interactions, including negotiations with a buyer AEA and interactions with search nodes and ledgers, we use dialogues. Create a new file in the skill folder (<code>my_generic_seller/skills/generic_seller/</code>) and name it <code>dialogues.py</code>. Inside this file add the following code:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kn">from</span> <span class="nn">aea.common</span> <span class="kn">import</span> <span class="n">Address</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="kn">from</span> <span class="nn">aea.exceptions</span> <span class="kn">import</span> <span class="n">AEAEnforceError</span><span class="p">,</span> <span class="n">enforce</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="kn">from</span> <span class="nn">aea.helpers.transaction.base</span> <span class="kn">import</span> <span class="n">Terms</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="kn">from</span> <span class="nn">aea.protocols.base</span> <span class="kn">import</span> <span class="n">Message</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="kn">from</span> <span class="nn">aea.protocols.dialogue.base</span> <span class="kn">import</span> <span class="n">Dialogue</span> <span class="k">as</span> <span class="n">BaseDialogue</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="kn">from</span> <span class="nn">aea.protocols.dialogue.base</span> <span class="kn">import</span> <span class="n">DialogueLabel</span> <span class="k">as</span> <span class="n">BaseDialogueLabel</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="kn">from</span> <span class="nn">aea.skills.base</span> <span class="kn">import</span> <span class="n">Model</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.default.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>    <span class="n">DefaultDialogue</span> <span class="k">as</span> <span class="n">BaseDefaultDialogue</span><span class="p">,</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="p">)</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.default.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>    <span class="n">DefaultDialogues</span> <span class="k">as</span> <span class="n">BaseDefaultDialogues</span><span class="p">,</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="p">)</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.fipa.dialogues</span> <span class="kn">import</span> <span class="n">FipaDialogue</span> <span class="k">as</span> <span class="n">BaseFipaDialogue</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.fipa.dialogues</span> <span class="kn">import</span> <span class="n">FipaDialogues</span> <span class="k">as</span> <span class="n">BaseFipaDialogues</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.fipa.message</span> <span class="kn">import</span> <span class="n">FipaMessage</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>    <span class="n">LedgerApiDialogue</span> <span class="k">as</span> <span class="n">BaseLedgerApiDialogue</span><span class="p">,</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="p">)</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>    <span class="n">LedgerApiDialogues</span> <span class="k">as</span> <span class="n">BaseLedgerApiDialogues</span><span class="p">,</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="p">)</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.message</span> <span class="kn">import</span> <span class="n">LedgerApiMessage</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.oef_search.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>    <span class="n">OefSearchDialogue</span> <span class="k">as</span> <span class="n">BaseOefSearchDialogue</span><span class="p">,</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="p">)</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.oef_search.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>    <span class="n">OefSearchDialogues</span> <span class="k">as</span> <span class="n">BaseOefSearchDialogues</span><span class="p">,</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="p">)</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="n">DefaultDialogue</span> <span class="o">=</span> <span class="n">BaseDefaultDialogue</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="k">class</span> <span class="nc">DefaultDialogues</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">BaseDefaultDialogues</span><span class="p">):</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogues class keeps track of all dialogues.&quot;&quot;&quot;</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="sd">        Initialize dialogues.</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a>        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a>        <span class="k">def</span> <span class="nf">role_from_first_message</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a>            <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">receiver_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">:</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Infer the role of the agent from an incoming/outgoing first message</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="sd">            :param message: an incoming/outgoing first message</span>
<a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a><span class="sd">            :param receiver_address: the address of the receiving agent</span>
<a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a><span class="sd">            :return: The role of the agent</span>
<a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a>            <span class="k">return</span> <span class="n">DefaultDialogue</span><span class="o">.</span><span class="n">Role</span><span class="o">.</span><span class="n">AGENT</span>
<a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a>
<a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a>        <span class="n">BaseDefaultDialogues</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a>            <span class="n">self_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_address</span><span class="p">,</span>
<a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a>            <span class="n">role_from_first_message</span><span class="o">=</span><span class="n">role_from_first_message</span><span class="p">,</span>
<a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a>        <span class="p">)</span>
<a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a>
<a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a>
<a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a><span class="k">class</span> <span class="nc">FipaDialogue</span><span class="p">(</span><span class="n">BaseFipaDialogue</span><span class="p">):</span>
<a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogue class maintains state of a dialogue and manages it.&quot;&quot;&quot;</span>
<a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a>
<a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;data_for_sale&quot;</span><span class="p">,</span> <span class="s2">&quot;_terms&quot;</span><span class="p">)</span>
<a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a>
<a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a>        <span class="n">dialogue_label</span><span class="p">:</span> <span class="n">BaseDialogueLabel</span><span class="p">,</span>
<a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a>        <span class="n">self_address</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
<a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a>        <span class="n">role</span><span class="p">:</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">,</span>
<a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a>        <span class="n">message_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">FipaMessage</span><span class="p">]</span> <span class="o">=</span> <span class="n">FipaMessage</span><span class="p">,</span>
<a id="__codelineno-15-78" name="__codelineno-15-78" href="#__codelineno-15-78"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-79" name="__codelineno-15-79" href="#__codelineno-15-79"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-80" name="__codelineno-15-80" href="#__codelineno-15-80"></a><span class="sd">        Initialize a dialogue.</span>
<a id="__codelineno-15-81" name="__codelineno-15-81" href="#__codelineno-15-81"></a>
<a id="__codelineno-15-82" name="__codelineno-15-82" href="#__codelineno-15-82"></a><span class="sd">        :param dialogue_label: the identifier of the dialogue</span>
<a id="__codelineno-15-83" name="__codelineno-15-83" href="#__codelineno-15-83"></a><span class="sd">        :param self_address: the address of the entity for whom this dialogue is maintained</span>
<a id="__codelineno-15-84" name="__codelineno-15-84" href="#__codelineno-15-84"></a><span class="sd">        :param role: the role of the agent this dialogue is maintained for</span>
<a id="__codelineno-15-85" name="__codelineno-15-85" href="#__codelineno-15-85"></a><span class="sd">        :param message_class: the message class</span>
<a id="__codelineno-15-86" name="__codelineno-15-86" href="#__codelineno-15-86"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-15-87" name="__codelineno-15-87" href="#__codelineno-15-87"></a>        <span class="n">BaseFipaDialogue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-15-88" name="__codelineno-15-88" href="#__codelineno-15-88"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-15-89" name="__codelineno-15-89" href="#__codelineno-15-89"></a>            <span class="n">dialogue_label</span><span class="o">=</span><span class="n">dialogue_label</span><span class="p">,</span>
<a id="__codelineno-15-90" name="__codelineno-15-90" href="#__codelineno-15-90"></a>            <span class="n">self_address</span><span class="o">=</span><span class="n">self_address</span><span class="p">,</span>
<a id="__codelineno-15-91" name="__codelineno-15-91" href="#__codelineno-15-91"></a>            <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
<a id="__codelineno-15-92" name="__codelineno-15-92" href="#__codelineno-15-92"></a>            <span class="n">message_class</span><span class="o">=</span><span class="n">message_class</span><span class="p">,</span>
<a id="__codelineno-15-93" name="__codelineno-15-93" href="#__codelineno-15-93"></a>        <span class="p">)</span>
<a id="__codelineno-15-94" name="__codelineno-15-94" href="#__codelineno-15-94"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_for_sale</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Dict[str, str]]</span>
<a id="__codelineno-15-95" name="__codelineno-15-95" href="#__codelineno-15-95"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Terms]</span>
<a id="__codelineno-15-96" name="__codelineno-15-96" href="#__codelineno-15-96"></a>
<a id="__codelineno-15-97" name="__codelineno-15-97" href="#__codelineno-15-97"></a>    <span class="nd">@property</span>
<a id="__codelineno-15-98" name="__codelineno-15-98" href="#__codelineno-15-98"></a>    <span class="k">def</span> <span class="nf">terms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Terms</span><span class="p">:</span>
<a id="__codelineno-15-99" name="__codelineno-15-99" href="#__codelineno-15-99"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get terms.&quot;&quot;&quot;</span>
<a id="__codelineno-15-100" name="__codelineno-15-100" href="#__codelineno-15-100"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-101" name="__codelineno-15-101" href="#__codelineno-15-101"></a>            <span class="k">raise</span> <span class="n">AEAEnforceError</span><span class="p">(</span><span class="s2">&quot;Terms not set!&quot;</span><span class="p">)</span>
<a id="__codelineno-15-102" name="__codelineno-15-102" href="#__codelineno-15-102"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span>
<a id="__codelineno-15-103" name="__codelineno-15-103" href="#__codelineno-15-103"></a>
<a id="__codelineno-15-104" name="__codelineno-15-104" href="#__codelineno-15-104"></a>    <span class="nd">@terms</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-15-105" name="__codelineno-15-105" href="#__codelineno-15-105"></a>    <span class="k">def</span> <span class="nf">terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="n">Terms</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-106" name="__codelineno-15-106" href="#__codelineno-15-106"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set terms.&quot;&quot;&quot;</span>
<a id="__codelineno-15-107" name="__codelineno-15-107" href="#__codelineno-15-107"></a>        <span class="n">enforce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Terms already set!&quot;</span><span class="p">)</span>
<a id="__codelineno-15-108" name="__codelineno-15-108" href="#__codelineno-15-108"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="o">=</span> <span class="n">terms</span>
<a id="__codelineno-15-109" name="__codelineno-15-109" href="#__codelineno-15-109"></a>
<a id="__codelineno-15-110" name="__codelineno-15-110" href="#__codelineno-15-110"></a>
<a id="__codelineno-15-111" name="__codelineno-15-111" href="#__codelineno-15-111"></a><span class="k">class</span> <span class="nc">FipaDialogues</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">BaseFipaDialogues</span><span class="p">):</span>
<a id="__codelineno-15-112" name="__codelineno-15-112" href="#__codelineno-15-112"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogues class keeps track of all dialogues.&quot;&quot;&quot;</span>
<a id="__codelineno-15-113" name="__codelineno-15-113" href="#__codelineno-15-113"></a>
<a id="__codelineno-15-114" name="__codelineno-15-114" href="#__codelineno-15-114"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-115" name="__codelineno-15-115" href="#__codelineno-15-115"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-116" name="__codelineno-15-116" href="#__codelineno-15-116"></a><span class="sd">        Initialize dialogues.</span>
<a id="__codelineno-15-117" name="__codelineno-15-117" href="#__codelineno-15-117"></a>
<a id="__codelineno-15-118" name="__codelineno-15-118" href="#__codelineno-15-118"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-15-119" name="__codelineno-15-119" href="#__codelineno-15-119"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-15-120" name="__codelineno-15-120" href="#__codelineno-15-120"></a>        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-15-121" name="__codelineno-15-121" href="#__codelineno-15-121"></a>
<a id="__codelineno-15-122" name="__codelineno-15-122" href="#__codelineno-15-122"></a>        <span class="k">def</span> <span class="nf">role_from_first_message</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-15-123" name="__codelineno-15-123" href="#__codelineno-15-123"></a>            <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">receiver_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-15-124" name="__codelineno-15-124" href="#__codelineno-15-124"></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">:</span>
<a id="__codelineno-15-125" name="__codelineno-15-125" href="#__codelineno-15-125"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Infer the role of the agent from an incoming/outgoing first message</span>
<a id="__codelineno-15-126" name="__codelineno-15-126" href="#__codelineno-15-126"></a>
<a id="__codelineno-15-127" name="__codelineno-15-127" href="#__codelineno-15-127"></a><span class="sd">            :param message: an incoming/outgoing first message</span>
<a id="__codelineno-15-128" name="__codelineno-15-128" href="#__codelineno-15-128"></a><span class="sd">            :param receiver_address: the address of the receiving agent</span>
<a id="__codelineno-15-129" name="__codelineno-15-129" href="#__codelineno-15-129"></a><span class="sd">            :return: The role of the agent</span>
<a id="__codelineno-15-130" name="__codelineno-15-130" href="#__codelineno-15-130"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-15-131" name="__codelineno-15-131" href="#__codelineno-15-131"></a>            <span class="k">return</span> <span class="n">FipaDialogue</span><span class="o">.</span><span class="n">Role</span><span class="o">.</span><span class="n">SELLER</span>
<a id="__codelineno-15-132" name="__codelineno-15-132" href="#__codelineno-15-132"></a>
<a id="__codelineno-15-133" name="__codelineno-15-133" href="#__codelineno-15-133"></a>        <span class="n">BaseFipaDialogues</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-15-134" name="__codelineno-15-134" href="#__codelineno-15-134"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-15-135" name="__codelineno-15-135" href="#__codelineno-15-135"></a>            <span class="n">self_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_address</span><span class="p">,</span>
<a id="__codelineno-15-136" name="__codelineno-15-136" href="#__codelineno-15-136"></a>            <span class="n">role_from_first_message</span><span class="o">=</span><span class="n">role_from_first_message</span><span class="p">,</span>
<a id="__codelineno-15-137" name="__codelineno-15-137" href="#__codelineno-15-137"></a>            <span class="n">dialogue_class</span><span class="o">=</span><span class="n">FipaDialogue</span><span class="p">,</span>
<a id="__codelineno-15-138" name="__codelineno-15-138" href="#__codelineno-15-138"></a>        <span class="p">)</span>
<a id="__codelineno-15-139" name="__codelineno-15-139" href="#__codelineno-15-139"></a>
<a id="__codelineno-15-140" name="__codelineno-15-140" href="#__codelineno-15-140"></a>
<a id="__codelineno-15-141" name="__codelineno-15-141" href="#__codelineno-15-141"></a><span class="k">class</span> <span class="nc">LedgerApiDialogue</span><span class="p">(</span><span class="n">BaseLedgerApiDialogue</span><span class="p">):</span>
<a id="__codelineno-15-142" name="__codelineno-15-142" href="#__codelineno-15-142"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogue class maintains state of a dialogue and manages it.&quot;&quot;&quot;</span>
<a id="__codelineno-15-143" name="__codelineno-15-143" href="#__codelineno-15-143"></a>
<a id="__codelineno-15-144" name="__codelineno-15-144" href="#__codelineno-15-144"></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_associated_fipa_dialogue&quot;</span><span class="p">,)</span>
<a id="__codelineno-15-145" name="__codelineno-15-145" href="#__codelineno-15-145"></a>
<a id="__codelineno-15-146" name="__codelineno-15-146" href="#__codelineno-15-146"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-15-147" name="__codelineno-15-147" href="#__codelineno-15-147"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-15-148" name="__codelineno-15-148" href="#__codelineno-15-148"></a>        <span class="n">dialogue_label</span><span class="p">:</span> <span class="n">BaseDialogueLabel</span><span class="p">,</span>
<a id="__codelineno-15-149" name="__codelineno-15-149" href="#__codelineno-15-149"></a>        <span class="n">self_address</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
<a id="__codelineno-15-150" name="__codelineno-15-150" href="#__codelineno-15-150"></a>        <span class="n">role</span><span class="p">:</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">,</span>
<a id="__codelineno-15-151" name="__codelineno-15-151" href="#__codelineno-15-151"></a>        <span class="n">message_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">LedgerApiMessage</span><span class="p">]</span> <span class="o">=</span> <span class="n">LedgerApiMessage</span><span class="p">,</span>
<a id="__codelineno-15-152" name="__codelineno-15-152" href="#__codelineno-15-152"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-153" name="__codelineno-15-153" href="#__codelineno-15-153"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-154" name="__codelineno-15-154" href="#__codelineno-15-154"></a><span class="sd">        Initialize a dialogue.</span>
<a id="__codelineno-15-155" name="__codelineno-15-155" href="#__codelineno-15-155"></a>
<a id="__codelineno-15-156" name="__codelineno-15-156" href="#__codelineno-15-156"></a><span class="sd">        :param dialogue_label: the identifier of the dialogue</span>
<a id="__codelineno-15-157" name="__codelineno-15-157" href="#__codelineno-15-157"></a><span class="sd">        :param self_address: the address of the entity for whom this dialogue is maintained</span>
<a id="__codelineno-15-158" name="__codelineno-15-158" href="#__codelineno-15-158"></a><span class="sd">        :param role: the role of the agent this dialogue is maintained for</span>
<a id="__codelineno-15-159" name="__codelineno-15-159" href="#__codelineno-15-159"></a><span class="sd">        :param message_class: the message class</span>
<a id="__codelineno-15-160" name="__codelineno-15-160" href="#__codelineno-15-160"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-15-161" name="__codelineno-15-161" href="#__codelineno-15-161"></a>        <span class="n">BaseLedgerApiDialogue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-15-162" name="__codelineno-15-162" href="#__codelineno-15-162"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-15-163" name="__codelineno-15-163" href="#__codelineno-15-163"></a>            <span class="n">dialogue_label</span><span class="o">=</span><span class="n">dialogue_label</span><span class="p">,</span>
<a id="__codelineno-15-164" name="__codelineno-15-164" href="#__codelineno-15-164"></a>            <span class="n">self_address</span><span class="o">=</span><span class="n">self_address</span><span class="p">,</span>
<a id="__codelineno-15-165" name="__codelineno-15-165" href="#__codelineno-15-165"></a>            <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
<a id="__codelineno-15-166" name="__codelineno-15-166" href="#__codelineno-15-166"></a>            <span class="n">message_class</span><span class="o">=</span><span class="n">message_class</span><span class="p">,</span>
<a id="__codelineno-15-167" name="__codelineno-15-167" href="#__codelineno-15-167"></a>        <span class="p">)</span>
<a id="__codelineno-15-168" name="__codelineno-15-168" href="#__codelineno-15-168"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[FipaDialogue]</span>
<a id="__codelineno-15-169" name="__codelineno-15-169" href="#__codelineno-15-169"></a>
<a id="__codelineno-15-170" name="__codelineno-15-170" href="#__codelineno-15-170"></a>    <span class="nd">@property</span>
<a id="__codelineno-15-171" name="__codelineno-15-171" href="#__codelineno-15-171"></a>    <span class="k">def</span> <span class="nf">associated_fipa_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FipaDialogue</span><span class="p">:</span>
<a id="__codelineno-15-172" name="__codelineno-15-172" href="#__codelineno-15-172"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get associated_fipa_dialogue.&quot;&quot;&quot;</span>
<a id="__codelineno-15-173" name="__codelineno-15-173" href="#__codelineno-15-173"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-174" name="__codelineno-15-174" href="#__codelineno-15-174"></a>            <span class="k">raise</span> <span class="n">AEAEnforceError</span><span class="p">(</span><span class="s2">&quot;FipaDialogue not set!&quot;</span><span class="p">)</span>
<a id="__codelineno-15-175" name="__codelineno-15-175" href="#__codelineno-15-175"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span>
<a id="__codelineno-15-176" name="__codelineno-15-176" href="#__codelineno-15-176"></a>
<a id="__codelineno-15-177" name="__codelineno-15-177" href="#__codelineno-15-177"></a>    <span class="nd">@associated_fipa_dialogue</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-15-178" name="__codelineno-15-178" href="#__codelineno-15-178"></a>    <span class="k">def</span> <span class="nf">associated_fipa_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-179" name="__codelineno-15-179" href="#__codelineno-15-179"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set associated_fipa_dialogue&quot;&quot;&quot;</span>
<a id="__codelineno-15-180" name="__codelineno-15-180" href="#__codelineno-15-180"></a>        <span class="n">enforce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;FipaDialogue already set!&quot;</span><span class="p">)</span>
<a id="__codelineno-15-181" name="__codelineno-15-181" href="#__codelineno-15-181"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span> <span class="o">=</span> <span class="n">fipa_dialogue</span>
<a id="__codelineno-15-182" name="__codelineno-15-182" href="#__codelineno-15-182"></a>
<a id="__codelineno-15-183" name="__codelineno-15-183" href="#__codelineno-15-183"></a>
<a id="__codelineno-15-184" name="__codelineno-15-184" href="#__codelineno-15-184"></a><span class="k">class</span> <span class="nc">LedgerApiDialogues</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">BaseLedgerApiDialogues</span><span class="p">):</span>
<a id="__codelineno-15-185" name="__codelineno-15-185" href="#__codelineno-15-185"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogues class keeps track of all dialogues.&quot;&quot;&quot;</span>
<a id="__codelineno-15-186" name="__codelineno-15-186" href="#__codelineno-15-186"></a>
<a id="__codelineno-15-187" name="__codelineno-15-187" href="#__codelineno-15-187"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-188" name="__codelineno-15-188" href="#__codelineno-15-188"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-189" name="__codelineno-15-189" href="#__codelineno-15-189"></a><span class="sd">        Initialize dialogues.</span>
<a id="__codelineno-15-190" name="__codelineno-15-190" href="#__codelineno-15-190"></a>
<a id="__codelineno-15-191" name="__codelineno-15-191" href="#__codelineno-15-191"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-15-192" name="__codelineno-15-192" href="#__codelineno-15-192"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-15-193" name="__codelineno-15-193" href="#__codelineno-15-193"></a>        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-15-194" name="__codelineno-15-194" href="#__codelineno-15-194"></a>
<a id="__codelineno-15-195" name="__codelineno-15-195" href="#__codelineno-15-195"></a>        <span class="k">def</span> <span class="nf">role_from_first_message</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-15-196" name="__codelineno-15-196" href="#__codelineno-15-196"></a>            <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">receiver_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-15-197" name="__codelineno-15-197" href="#__codelineno-15-197"></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">:</span>
<a id="__codelineno-15-198" name="__codelineno-15-198" href="#__codelineno-15-198"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Infer the role of the agent from an incoming/outgoing first message</span>
<a id="__codelineno-15-199" name="__codelineno-15-199" href="#__codelineno-15-199"></a>
<a id="__codelineno-15-200" name="__codelineno-15-200" href="#__codelineno-15-200"></a><span class="sd">            :param message: an incoming/outgoing first message</span>
<a id="__codelineno-15-201" name="__codelineno-15-201" href="#__codelineno-15-201"></a><span class="sd">            :param receiver_address: the address of the receiving agent</span>
<a id="__codelineno-15-202" name="__codelineno-15-202" href="#__codelineno-15-202"></a><span class="sd">            :return: The role of the agent</span>
<a id="__codelineno-15-203" name="__codelineno-15-203" href="#__codelineno-15-203"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-15-204" name="__codelineno-15-204" href="#__codelineno-15-204"></a>            <span class="k">return</span> <span class="n">BaseLedgerApiDialogue</span><span class="o">.</span><span class="n">Role</span><span class="o">.</span><span class="n">AGENT</span>
<a id="__codelineno-15-205" name="__codelineno-15-205" href="#__codelineno-15-205"></a>
<a id="__codelineno-15-206" name="__codelineno-15-206" href="#__codelineno-15-206"></a>        <span class="n">BaseLedgerApiDialogues</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-15-207" name="__codelineno-15-207" href="#__codelineno-15-207"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-15-208" name="__codelineno-15-208" href="#__codelineno-15-208"></a>            <span class="n">self_address</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill_id</span><span class="p">),</span>
<a id="__codelineno-15-209" name="__codelineno-15-209" href="#__codelineno-15-209"></a>            <span class="n">role_from_first_message</span><span class="o">=</span><span class="n">role_from_first_message</span><span class="p">,</span>
<a id="__codelineno-15-210" name="__codelineno-15-210" href="#__codelineno-15-210"></a>            <span class="n">dialogue_class</span><span class="o">=</span><span class="n">LedgerApiDialogue</span><span class="p">,</span>
<a id="__codelineno-15-211" name="__codelineno-15-211" href="#__codelineno-15-211"></a>        <span class="p">)</span>
<a id="__codelineno-15-212" name="__codelineno-15-212" href="#__codelineno-15-212"></a>
<a id="__codelineno-15-213" name="__codelineno-15-213" href="#__codelineno-15-213"></a>
<a id="__codelineno-15-214" name="__codelineno-15-214" href="#__codelineno-15-214"></a><span class="n">OefSearchDialogue</span> <span class="o">=</span> <span class="n">BaseOefSearchDialogue</span>
<a id="__codelineno-15-215" name="__codelineno-15-215" href="#__codelineno-15-215"></a>
<a id="__codelineno-15-216" name="__codelineno-15-216" href="#__codelineno-15-216"></a>
<a id="__codelineno-15-217" name="__codelineno-15-217" href="#__codelineno-15-217"></a><span class="k">class</span> <span class="nc">OefSearchDialogues</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">BaseOefSearchDialogues</span><span class="p">):</span>
<a id="__codelineno-15-218" name="__codelineno-15-218" href="#__codelineno-15-218"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class keeps track of all oef_search dialogues.&quot;&quot;&quot;</span>
<a id="__codelineno-15-219" name="__codelineno-15-219" href="#__codelineno-15-219"></a>
<a id="__codelineno-15-220" name="__codelineno-15-220" href="#__codelineno-15-220"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-221" name="__codelineno-15-221" href="#__codelineno-15-221"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-222" name="__codelineno-15-222" href="#__codelineno-15-222"></a><span class="sd">        Initialize dialogues.</span>
<a id="__codelineno-15-223" name="__codelineno-15-223" href="#__codelineno-15-223"></a>
<a id="__codelineno-15-224" name="__codelineno-15-224" href="#__codelineno-15-224"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-15-225" name="__codelineno-15-225" href="#__codelineno-15-225"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-15-226" name="__codelineno-15-226" href="#__codelineno-15-226"></a>        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-15-227" name="__codelineno-15-227" href="#__codelineno-15-227"></a>
<a id="__codelineno-15-228" name="__codelineno-15-228" href="#__codelineno-15-228"></a>        <span class="k">def</span> <span class="nf">role_from_first_message</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-15-229" name="__codelineno-15-229" href="#__codelineno-15-229"></a>            <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">receiver_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-15-230" name="__codelineno-15-230" href="#__codelineno-15-230"></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">:</span>
<a id="__codelineno-15-231" name="__codelineno-15-231" href="#__codelineno-15-231"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Infer the role of the agent from an incoming/outgoing first message</span>
<a id="__codelineno-15-232" name="__codelineno-15-232" href="#__codelineno-15-232"></a>
<a id="__codelineno-15-233" name="__codelineno-15-233" href="#__codelineno-15-233"></a><span class="sd">            :param message: an incoming/outgoing first message</span>
<a id="__codelineno-15-234" name="__codelineno-15-234" href="#__codelineno-15-234"></a><span class="sd">            :param receiver_address: the address of the receiving agent</span>
<a id="__codelineno-15-235" name="__codelineno-15-235" href="#__codelineno-15-235"></a><span class="sd">            :return: The role of the agent</span>
<a id="__codelineno-15-236" name="__codelineno-15-236" href="#__codelineno-15-236"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-15-237" name="__codelineno-15-237" href="#__codelineno-15-237"></a>            <span class="k">return</span> <span class="n">BaseOefSearchDialogue</span><span class="o">.</span><span class="n">Role</span><span class="o">.</span><span class="n">AGENT</span>
<a id="__codelineno-15-238" name="__codelineno-15-238" href="#__codelineno-15-238"></a>
<a id="__codelineno-15-239" name="__codelineno-15-239" href="#__codelineno-15-239"></a>        <span class="n">BaseOefSearchDialogues</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-15-240" name="__codelineno-15-240" href="#__codelineno-15-240"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-15-241" name="__codelineno-15-241" href="#__codelineno-15-241"></a>            <span class="n">self_address</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill_id</span><span class="p">),</span>
<a id="__codelineno-15-242" name="__codelineno-15-242" href="#__codelineno-15-242"></a>            <span class="n">role_from_first_message</span><span class="o">=</span><span class="n">role_from_first_message</span><span class="p">,</span>
<a id="__codelineno-15-243" name="__codelineno-15-243" href="#__codelineno-15-243"></a>        <span class="p">)</span>
</code></pre></div>
<p>The <code>FipaDialogues</code> class contains negotiation dialogues with each <code>my_generic_buyer</code> AEA (and other AEAs) and exposes a number of helpful methods to manage them. This helps us match messages to the dialogues they belong to, access previous messages and enable us to identify possible communications problems between the <code>my_generic_seller</code> AEA and the <code>my_generic_buyer</code> AEA. It also keeps track of the data that we offer for sale during the proposal phase.</p>
<p>The <code>FipaDialogues</code> class extends <code>BaseFipaDialogues</code>, which itself derives from the base <a href="../api/protocols/dialogue/base#dialogues-objects"><code>Dialogues</code></a> class. Similarly, the <code>FipaDialogue</code> class extends <code>BaseFipaDialogue</code> which itself derives from the base <a href="../api/protocols/dialogue/base#dialogue-objects"><code>Dialogue</code></a> class. To learn more about dialogues have a look <a href="../protocol">here</a>.</p>
<h3 id="step-6-update-the-yaml-files">Step 6: Update the YAML Files<a class="headerlink" href="#step-6-update-the-yaml-files" title="Permanent link">&para;</a></h3>
<p>Since we made so many changes to our AEA we have to update the <code>skill.yaml</code> (at <code>my_generic_seller/skills/generic_seller/skill.yaml</code>). Make sure you update your <code>skill.yaml</code> with the following configuration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generic_seller</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1.0</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">skill</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The weather station skill implements the functionality to sell weather</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">data.</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="nt">license</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache-2.0</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="nt">aea_version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&gt;=1.0.0,</span><span class="nv"> </span><span class="s">&lt;2.0.0&#39;</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="nt">fingerprint</span><span class="p">:</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">  </span><span class="nt">README.md</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmPb5kHYZyhUN87EKmuahyGqDGgqVdGPyfC1KpGC3xfmcP</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">  </span><span class="nt">__init__.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmTSEedzQySy2nzRCY3F66CBSX52f8s3pWHZTejX4hKC9h</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">  </span><span class="nt">behaviours.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmS9sPCv2yBnhWsmHeaCptpApMtYZipbR39TXixeGK64Ks</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">  </span><span class="nt">dialogues.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmdTW8q1xQ7ajFVsWmuV62ypoT5J2b6Hkyz52LFaWuMEtd</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">  </span><span class="nt">handlers.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmQnQhSaHPUYaJut8bMe2LHEqiZqokMSVfCthVaqrvPbdi</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">  </span><span class="nt">strategy.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmYTUsfv64eRQDevCfMUDQPx2GCtiMLFdacN4sS1E4Fdfx</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="nt">fingerprint_ignore_patterns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/ledger:0.21.5</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="nt">contracts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="nt">protocols</span><span class="p">:</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/default:1.1.7</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/fipa:1.1.7</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/ledger_api:1.1.7</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/oef_search:1.1.7</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="nt">skills</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="nt">behaviours</span><span class="p">:</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">  </span><span class="nt">service_registration</span><span class="p">:</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">      </span><span class="nt">services_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericServiceRegistrationBehaviour</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="nt">handlers</span><span class="p">:</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="w">  </span><span class="nt">fipa</span><span class="p">:</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericFipaHandler</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="w">  </span><span class="nt">ledger_api</span><span class="p">:</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericLedgerApiHandler</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="w">  </span><span class="nt">oef_search</span><span class="p">:</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericOefSearchHandler</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="nt">models</span><span class="p">:</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a><span class="w">  </span><span class="nt">default_dialogues</span><span class="p">:</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DefaultDialogues</span>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a><span class="w">  </span><span class="nt">fipa_dialogues</span><span class="p">:</span>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FipaDialogues</span>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a><span class="w">  </span><span class="nt">ledger_api_dialogues</span><span class="p">:</span>
<a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LedgerApiDialogues</span>
<a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a><span class="w">  </span><span class="nt">oef_search_dialogues</span><span class="p">:</span>
<a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OefSearchDialogues</span>
<a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a><span class="w">      </span><span class="nt">data_for_sale</span><span class="p">:</span>
<a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a><span class="w">        </span><span class="nt">generic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data</span>
<a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a><span class="w">      </span><span class="nt">has_data_source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a><span class="w">      </span><span class="nt">is_ledger_tx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a><span class="w">      </span><span class="nt">location</span><span class="p">:</span>
<a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a><span class="w">        </span><span class="nt">latitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">51.5194</span>
<a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a><span class="w">        </span><span class="nt">longitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.127</span>
<a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a><span class="w">      </span><span class="nt">service_data</span><span class="p">:</span>
<a id="__codelineno-16-64" name="__codelineno-16-64" href="#__codelineno-16-64"></a><span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">seller_service</span>
<a id="__codelineno-16-65" name="__codelineno-16-65" href="#__codelineno-16-65"></a><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generic_service</span>
<a id="__codelineno-16-66" name="__codelineno-16-66" href="#__codelineno-16-66"></a><span class="w">      </span><span class="nt">service_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generic_service</span>
<a id="__codelineno-16-67" name="__codelineno-16-67" href="#__codelineno-16-67"></a><span class="w">      </span><span class="nt">unit_price</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-16-68" name="__codelineno-16-68" href="#__codelineno-16-68"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericStrategy</span>
<a id="__codelineno-16-69" name="__codelineno-16-69" href="#__codelineno-16-69"></a><span class="nt">is_abstract</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-16-70" name="__codelineno-16-70" href="#__codelineno-16-70"></a><span class="nt">dependencies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>
<p>We must pay attention to the models and in particular the strategy’s variables. Here we can change the price we would like to sell each data reading for, or the currency we would like to transact with. Lastly, the dependencies are the third party packages we need to install in order to get readings from the sensor.</p>
<p>Finally, we fingerprint our new skill:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>aea<span class="w"> </span>fingerprint<span class="w"> </span>skill<span class="w"> </span>fetchai/generic_seller:0.1.0
</code></pre></div>
<p>This will hash each file and save the hash in the fingerprint. This way, in the future we can easily track if any of the files have changed.</p>
<h2 id="generic-buyer-aea">Generic Buyer AEA<a class="headerlink" href="#generic-buyer-aea" title="Permanent link">&para;</a></h2>
<h3 id="step-1-create-the-aea_1">Step 1: Create the AEA<a class="headerlink" href="#step-1-create-the-aea_1" title="Permanent link">&para;</a></h3>
<p>In a new terminal, create a new AEA by typing the following command in the terminal:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>aea<span class="w"> </span>create<span class="w"> </span>my_generic_buyer
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nb">cd</span><span class="w"> </span>my_generic_buyer
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>aea<span class="w"> </span>install
</code></pre></div>
<p>Our newly created AEA is inside the current working directory. Let’s create a new skill for purchasing data. Type the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>aea<span class="w"> </span>scaffold<span class="w"> </span>skill<span class="w"> </span>generic_buyer
</code></pre></div>
<p>This command creates the correct structure for a new skill inside our AEA project. You can locate the newly created skill under the skills folder (<code>my_generic_buyer/skills/generic_buyer/</code>) and it must contain the following files:</p>
<ul>
<li><code>__init__.py</code></li>
<li><code>behaviours.py</code></li>
<li><code>handlers.py</code></li>
<li><code>my_model.py</code></li>
<li><code>skills.yaml</code></li>
</ul>
<h3 id="step-2-create-the-behaviour_1">Step 2: Create the Behaviour<a class="headerlink" href="#step-2-create-the-behaviour_1" title="Permanent link">&para;</a></h3>
<p>Open the <code>behaviours.py</code> file (<code>my_generic_buyer/skills/generic_buyer/behaviours.py</code>) and replace the stub code with the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">cast</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="kn">from</span> <span class="nn">aea.protocols.dialogue.base</span> <span class="kn">import</span> <span class="n">DialogueLabel</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="kn">from</span> <span class="nn">aea.skills.behaviours</span> <span class="kn">import</span> <span class="n">TickerBehaviour</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="kn">from</span> <span class="nn">packages.fetchai.connections.ledger.base</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="n">CONNECTION_ID</span> <span class="k">as</span> <span class="n">LEDGER_CONNECTION_PUBLIC_ID</span><span class="p">,</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="p">)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.message</span> <span class="kn">import</span> <span class="n">LedgerApiMessage</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.oef_search.message</span> <span class="kn">import</span> <span class="n">OefSearchMessage</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_buyer.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>    <span class="n">FipaDialogue</span><span class="p">,</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>    <span class="n">LedgerApiDialogue</span><span class="p">,</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>    <span class="n">LedgerApiDialogues</span><span class="p">,</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>    <span class="n">OefSearchDialogues</span><span class="p">,</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="p">)</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_buyer.strategy</span> <span class="kn">import</span> <span class="n">GenericStrategy</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="n">DEFAULT_MAX_PROCESSING</span> <span class="o">=</span> <span class="mi">120</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="n">DEFAULT_TX_INTERVAL</span> <span class="o">=</span> <span class="mf">2.0</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="n">DEFAULT_SEARCH_INTERVAL</span> <span class="o">=</span> <span class="mf">5.0</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="n">LEDGER_API_ADDRESS</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">LEDGER_CONNECTION_PUBLIC_ID</span><span class="p">)</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="k">class</span> <span class="nc">GenericSearchBehaviour</span><span class="p">(</span><span class="n">TickerBehaviour</span><span class="p">):</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements a search behaviour.&quot;&quot;&quot;</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the search behaviour.&quot;&quot;&quot;</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>        <span class="n">search_interval</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>            <span class="nb">float</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;search_interval&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SEARCH_INTERVAL</span><span class="p">)</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>        <span class="p">)</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">tick_interval</span><span class="o">=</span><span class="n">search_interval</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the setup for the behaviour.&quot;&quot;&quot;</span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>        <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_ledger_tx</span><span class="p">:</span>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>            <span class="n">ledger_api_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>                <span class="n">LedgerApiDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">ledger_api_dialogues</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>            <span class="p">)</span>
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a>            <span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ledger_api_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>                <span class="n">counterparty</span><span class="o">=</span><span class="n">LEDGER_API_ADDRESS</span><span class="p">,</span>
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">GET_BALANCE</span><span class="p">,</span>
<a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a>                <span class="n">ledger_id</span><span class="o">=</span><span class="n">strategy</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span>
<a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a>                <span class="n">address</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_addresses</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">)),</span>
<a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a>            <span class="p">)</span>
<a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a>            <span class="n">strategy</span><span class="o">.</span><span class="n">is_searching</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a>
<a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a>    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the act.&quot;&quot;&quot;</span>
<a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_searching</span><span class="p">:</span>
<a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a>            <span class="k">return</span>
<a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a>        <span class="n">transaction_behaviour</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a>            <span class="n">GenericTransactionBehaviour</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">transaction</span>
<a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a>        <span class="p">)</span>
<a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a>        <span class="n">remaining_transactions_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">transaction_behaviour</span><span class="o">.</span><span class="n">waiting</span><span class="p">)</span>
<a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a>        <span class="k">if</span> <span class="n">remaining_transactions_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a>                <span class="sa">f</span><span class="s2">&quot;Transaction behaviour has </span><span class="si">{</span><span class="n">remaining_transactions_count</span><span class="si">}</span><span class="s2"> transactions remaining. Skipping search!&quot;</span>
<a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a>            <span class="p">)</span>
<a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a>            <span class="k">return</span>
<a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a>        <span class="n">strategy</span><span class="o">.</span><span class="n">update_search_query_params</span><span class="p">()</span>
<a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_location_and_service_query</span><span class="p">()</span>
<a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a>        <span class="n">oef_search_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a>            <span class="n">OefSearchDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">oef_search_dialogues</span>
<a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a>        <span class="p">)</span>
<a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a>        <span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">oef_search_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a>            <span class="n">counterparty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">search_service_address</span><span class="p">,</span>
<a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">SEARCH_SERVICES</span><span class="p">,</span>
<a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a>            <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
<a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a>        <span class="p">)</span>
<a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">oef_search_msg</span><span class="p">)</span>
<a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a>
<a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the task teardown.&quot;&quot;&quot;</span>
<a id="__codelineno-20-81" name="__codelineno-20-81" href="#__codelineno-20-81"></a>
<a id="__codelineno-20-82" name="__codelineno-20-82" href="#__codelineno-20-82"></a>
<a id="__codelineno-20-83" name="__codelineno-20-83" href="#__codelineno-20-83"></a><span class="k">class</span> <span class="nc">GenericTransactionBehaviour</span><span class="p">(</span><span class="n">TickerBehaviour</span><span class="p">):</span>
<a id="__codelineno-20-84" name="__codelineno-20-84" href="#__codelineno-20-84"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A behaviour to sequentially submit transactions to the blockchain.&quot;&quot;&quot;</span>
<a id="__codelineno-20-85" name="__codelineno-20-85" href="#__codelineno-20-85"></a>
<a id="__codelineno-20-86" name="__codelineno-20-86" href="#__codelineno-20-86"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<a id="__codelineno-20-87" name="__codelineno-20-87" href="#__codelineno-20-87"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the transaction behaviour.&quot;&quot;&quot;</span>
<a id="__codelineno-20-88" name="__codelineno-20-88" href="#__codelineno-20-88"></a>        <span class="n">tx_interval</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-20-89" name="__codelineno-20-89" href="#__codelineno-20-89"></a>            <span class="nb">float</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;transaction_interval&quot;</span><span class="p">,</span> <span class="n">DEFAULT_TX_INTERVAL</span><span class="p">)</span>
<a id="__codelineno-20-90" name="__codelineno-20-90" href="#__codelineno-20-90"></a>        <span class="p">)</span>
<a id="__codelineno-20-91" name="__codelineno-20-91" href="#__codelineno-20-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_processing</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-20-92" name="__codelineno-20-92" href="#__codelineno-20-92"></a>            <span class="nb">float</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;max_processing&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MAX_PROCESSING</span><span class="p">)</span>
<a id="__codelineno-20-93" name="__codelineno-20-93" href="#__codelineno-20-93"></a>        <span class="p">)</span>
<a id="__codelineno-20-94" name="__codelineno-20-94" href="#__codelineno-20-94"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processing_time</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-20-95" name="__codelineno-20-95" href="#__codelineno-20-95"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">waiting</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FipaDialogue</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-20-96" name="__codelineno-20-96" href="#__codelineno-20-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LedgerApiDialogue</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-20-97" name="__codelineno-20-97" href="#__codelineno-20-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timedout</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">DialogueLabel</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-20-98" name="__codelineno-20-98" href="#__codelineno-20-98"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">tick_interval</span><span class="o">=</span><span class="n">tx_interval</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-20-99" name="__codelineno-20-99" href="#__codelineno-20-99"></a>
<a id="__codelineno-20-100" name="__codelineno-20-100" href="#__codelineno-20-100"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-101" name="__codelineno-20-101" href="#__codelineno-20-101"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup behaviour.&quot;&quot;&quot;</span>
<a id="__codelineno-20-102" name="__codelineno-20-102" href="#__codelineno-20-102"></a>
<a id="__codelineno-20-103" name="__codelineno-20-103" href="#__codelineno-20-103"></a>    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-104" name="__codelineno-20-104" href="#__codelineno-20-104"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the act.&quot;&quot;&quot;</span>
<a id="__codelineno-20-105" name="__codelineno-20-105" href="#__codelineno-20-105"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-106" name="__codelineno-20-106" href="#__codelineno-20-106"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing_time</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_processing</span><span class="p">:</span>
<a id="__codelineno-20-107" name="__codelineno-20-107" href="#__codelineno-20-107"></a>                <span class="c1"># already processing</span>
<a id="__codelineno-20-108" name="__codelineno-20-108" href="#__codelineno-20-108"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">processing_time</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tick_interval</span>
<a id="__codelineno-20-109" name="__codelineno-20-109" href="#__codelineno-20-109"></a>                <span class="k">return</span>
<a id="__codelineno-20-110" name="__codelineno-20-110" href="#__codelineno-20-110"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_timeout_processing</span><span class="p">()</span>
<a id="__codelineno-20-111" name="__codelineno-20-111" href="#__codelineno-20-111"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waiting</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-20-112" name="__codelineno-20-112" href="#__codelineno-20-112"></a>            <span class="c1"># nothing to process</span>
<a id="__codelineno-20-113" name="__codelineno-20-113" href="#__codelineno-20-113"></a>            <span class="k">return</span>
<a id="__codelineno-20-114" name="__codelineno-20-114" href="#__codelineno-20-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_start_processing</span><span class="p">()</span>
<a id="__codelineno-20-115" name="__codelineno-20-115" href="#__codelineno-20-115"></a>
<a id="__codelineno-20-116" name="__codelineno-20-116" href="#__codelineno-20-116"></a>    <span class="k">def</span> <span class="nf">_start_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-117" name="__codelineno-20-117" href="#__codelineno-20-117"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the next transaction.&quot;&quot;&quot;</span>
<a id="__codelineno-20-118" name="__codelineno-20-118" href="#__codelineno-20-118"></a>        <span class="n">fipa_dialogue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waiting</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-20-119" name="__codelineno-20-119" href="#__codelineno-20-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-20-120" name="__codelineno-20-120" href="#__codelineno-20-120"></a>            <span class="sa">f</span><span class="s2">&quot;Processing transaction, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">waiting</span><span class="p">)</span><span class="si">}</span><span class="s2"> transactions remaining&quot;</span>
<a id="__codelineno-20-121" name="__codelineno-20-121" href="#__codelineno-20-121"></a>        <span class="p">)</span>
<a id="__codelineno-20-122" name="__codelineno-20-122" href="#__codelineno-20-122"></a>        <span class="n">ledger_api_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-20-123" name="__codelineno-20-123" href="#__codelineno-20-123"></a>            <span class="n">LedgerApiDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">ledger_api_dialogues</span>
<a id="__codelineno-20-124" name="__codelineno-20-124" href="#__codelineno-20-124"></a>        <span class="p">)</span>
<a id="__codelineno-20-125" name="__codelineno-20-125" href="#__codelineno-20-125"></a>        <span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span> <span class="o">=</span> <span class="n">ledger_api_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-20-126" name="__codelineno-20-126" href="#__codelineno-20-126"></a>            <span class="n">counterparty</span><span class="o">=</span><span class="n">LEDGER_API_ADDRESS</span><span class="p">,</span>
<a id="__codelineno-20-127" name="__codelineno-20-127" href="#__codelineno-20-127"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">GET_RAW_TRANSACTION</span><span class="p">,</span>
<a id="__codelineno-20-128" name="__codelineno-20-128" href="#__codelineno-20-128"></a>            <span class="n">terms</span><span class="o">=</span><span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
<a id="__codelineno-20-129" name="__codelineno-20-129" href="#__codelineno-20-129"></a>        <span class="p">)</span>
<a id="__codelineno-20-130" name="__codelineno-20-130" href="#__codelineno-20-130"></a>        <span class="n">ledger_api_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">LedgerApiDialogue</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-20-131" name="__codelineno-20-131" href="#__codelineno-20-131"></a>        <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">associated_fipa_dialogue</span> <span class="o">=</span> <span class="n">fipa_dialogue</span>
<a id="__codelineno-20-132" name="__codelineno-20-132" href="#__codelineno-20-132"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processing_time</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-20-133" name="__codelineno-20-133" href="#__codelineno-20-133"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processing</span> <span class="o">=</span> <span class="n">ledger_api_dialogue</span>
<a id="__codelineno-20-134" name="__codelineno-20-134" href="#__codelineno-20-134"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-20-135" name="__codelineno-20-135" href="#__codelineno-20-135"></a>            <span class="sa">f</span><span class="s2">&quot;requesting transfer transaction from ledger api for message=</span><span class="si">{</span><span class="n">ledger_api_msg</span><span class="si">}</span><span class="s2">...&quot;</span>
<a id="__codelineno-20-136" name="__codelineno-20-136" href="#__codelineno-20-136"></a>        <span class="p">)</span>
<a id="__codelineno-20-137" name="__codelineno-20-137" href="#__codelineno-20-137"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-20-138" name="__codelineno-20-138" href="#__codelineno-20-138"></a>
<a id="__codelineno-20-139" name="__codelineno-20-139" href="#__codelineno-20-139"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-140" name="__codelineno-20-140" href="#__codelineno-20-140"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Teardown behaviour.&quot;&quot;&quot;</span>
<a id="__codelineno-20-141" name="__codelineno-20-141" href="#__codelineno-20-141"></a>
<a id="__codelineno-20-142" name="__codelineno-20-142" href="#__codelineno-20-142"></a>    <span class="k">def</span> <span class="nf">_timeout_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-143" name="__codelineno-20-143" href="#__codelineno-20-143"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Timeout processing.&quot;&quot;&quot;</span>
<a id="__codelineno-20-144" name="__codelineno-20-144" href="#__codelineno-20-144"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-145" name="__codelineno-20-145" href="#__codelineno-20-145"></a>            <span class="k">return</span>
<a id="__codelineno-20-146" name="__codelineno-20-146" href="#__codelineno-20-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timedout</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">dialogue_label</span><span class="p">)</span>
<a id="__codelineno-20-147" name="__codelineno-20-147" href="#__codelineno-20-147"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">waiting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">associated_fipa_dialogue</span><span class="p">)</span>
<a id="__codelineno-20-148" name="__codelineno-20-148" href="#__codelineno-20-148"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processing_time</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-20-149" name="__codelineno-20-149" href="#__codelineno-20-149"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processing</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-20-150" name="__codelineno-20-150" href="#__codelineno-20-150"></a>
<a id="__codelineno-20-151" name="__codelineno-20-151" href="#__codelineno-20-151"></a>    <span class="k">def</span> <span class="nf">finish_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-152" name="__codelineno-20-152" href="#__codelineno-20-152"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-20-153" name="__codelineno-20-153" href="#__codelineno-20-153"></a><span class="sd">        Finish processing.</span>
<a id="__codelineno-20-154" name="__codelineno-20-154" href="#__codelineno-20-154"></a>
<a id="__codelineno-20-155" name="__codelineno-20-155" href="#__codelineno-20-155"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-20-156" name="__codelineno-20-156" href="#__codelineno-20-156"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-20-157" name="__codelineno-20-157" href="#__codelineno-20-157"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span> <span class="o">==</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span>
<a id="__codelineno-20-158" name="__codelineno-20-158" href="#__codelineno-20-158"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">processing_time</span> <span class="o">=</span> <span class="mf">0.0</span>
<a id="__codelineno-20-159" name="__codelineno-20-159" href="#__codelineno-20-159"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">processing</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-20-160" name="__codelineno-20-160" href="#__codelineno-20-160"></a>            <span class="k">return</span>
<a id="__codelineno-20-161" name="__codelineno-20-161" href="#__codelineno-20-161"></a>        <span class="k">if</span> <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">dialogue_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedout</span><span class="p">:</span>
<a id="__codelineno-20-162" name="__codelineno-20-162" href="#__codelineno-20-162"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-20-163" name="__codelineno-20-163" href="#__codelineno-20-163"></a>                <span class="sa">f</span><span class="s2">&quot;Non-matching dialogues in transaction behaviour: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ledger_api_dialogue</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-20-164" name="__codelineno-20-164" href="#__codelineno-20-164"></a>            <span class="p">)</span>
<a id="__codelineno-20-165" name="__codelineno-20-165" href="#__codelineno-20-165"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">timedout</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">dialogue_label</span><span class="p">)</span>
<a id="__codelineno-20-166" name="__codelineno-20-166" href="#__codelineno-20-166"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-20-167" name="__codelineno-20-167" href="#__codelineno-20-167"></a>            <span class="sa">f</span><span class="s2">&quot;Timeout dialogue in transaction processing: </span><span class="si">{</span><span class="n">ledger_api_dialogue</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-20-168" name="__codelineno-20-168" href="#__codelineno-20-168"></a>        <span class="p">)</span>
<a id="__codelineno-20-169" name="__codelineno-20-169" href="#__codelineno-20-169"></a>        <span class="c1"># don&#39;t reset, as another might be processing</span>
<a id="__codelineno-20-170" name="__codelineno-20-170" href="#__codelineno-20-170"></a>
<a id="__codelineno-20-171" name="__codelineno-20-171" href="#__codelineno-20-171"></a>    <span class="k">def</span> <span class="nf">failed_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-20-172" name="__codelineno-20-172" href="#__codelineno-20-172"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-20-173" name="__codelineno-20-173" href="#__codelineno-20-173"></a><span class="sd">        Failed processing.</span>
<a id="__codelineno-20-174" name="__codelineno-20-174" href="#__codelineno-20-174"></a>
<a id="__codelineno-20-175" name="__codelineno-20-175" href="#__codelineno-20-175"></a><span class="sd">        Currently, we retry processing indefinitely.</span>
<a id="__codelineno-20-176" name="__codelineno-20-176" href="#__codelineno-20-176"></a>
<a id="__codelineno-20-177" name="__codelineno-20-177" href="#__codelineno-20-177"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-20-178" name="__codelineno-20-178" href="#__codelineno-20-178"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-20-179" name="__codelineno-20-179" href="#__codelineno-20-179"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finish_processing</span><span class="p">(</span><span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-20-180" name="__codelineno-20-180" href="#__codelineno-20-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">waiting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">associated_fipa_dialogue</span><span class="p">)</span>
</code></pre></div>
<p>This <a href="../api/skills/behaviours#tickerbehaviour-objects"><code>TickerBehaviour</code></a> will send a search query to the <a href="../simple-oef">SOEF search node</a> at regular tick intervals.</p>
<h3 id="step-3-create-the-handler_1">Step 3: Create the Handler<a class="headerlink" href="#step-3-create-the-handler_1" title="Permanent link">&para;</a></h3>
<p>So far, the AEA is tasked with sending search queries to the <a href="../simple-oef">SOEF search node</a>. However, currently the AEA has no way of handling the responses it receives from the SOEF or messages from other agents.</p>
<p>Let us now implement <a href="../api/skills/base#handler-objects"><code>Handlers</code></a> to deal with the expected incoming messages. Open the <code>handlers.py</code> file (<code>my_generic_buyer/skills/generic_buyer/handlers.py</code>) and add the following code (replacing the stub code already present in the file):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kn">import</span> <span class="nn">pprint</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">cast</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="kn">from</span> <span class="nn">aea.configurations.base</span> <span class="kn">import</span> <span class="n">PublicId</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="kn">from</span> <span class="nn">aea.crypto.ledger_apis</span> <span class="kn">import</span> <span class="n">LedgerApis</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="kn">from</span> <span class="nn">aea.protocols.base</span> <span class="kn">import</span> <span class="n">Message</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="kn">from</span> <span class="nn">aea.skills.base</span> <span class="kn">import</span> <span class="n">Handler</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="kn">from</span> <span class="nn">packages.fetchai.connections.ledger.base</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>    <span class="n">CONNECTION_ID</span> <span class="k">as</span> <span class="n">LEDGER_CONNECTION_PUBLIC_ID</span><span class="p">,</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="p">)</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.default.message</span> <span class="kn">import</span> <span class="n">DefaultMessage</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.fipa.message</span> <span class="kn">import</span> <span class="n">FipaMessage</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.message</span> <span class="kn">import</span> <span class="n">LedgerApiMessage</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.oef_search.message</span> <span class="kn">import</span> <span class="n">OefSearchMessage</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.signing.message</span> <span class="kn">import</span> <span class="n">SigningMessage</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_buyer.behaviours</span> <span class="kn">import</span> <span class="n">GenericTransactionBehaviour</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_buyer.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>    <span class="n">DefaultDialogues</span><span class="p">,</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>    <span class="n">FipaDialogue</span><span class="p">,</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>    <span class="n">FipaDialogues</span><span class="p">,</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>    <span class="n">LedgerApiDialogue</span><span class="p">,</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>    <span class="n">LedgerApiDialogues</span><span class="p">,</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>    <span class="n">OefSearchDialogue</span><span class="p">,</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>    <span class="n">OefSearchDialogues</span><span class="p">,</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>    <span class="n">SigningDialogue</span><span class="p">,</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>    <span class="n">SigningDialogues</span><span class="p">,</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="p">)</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="kn">from</span> <span class="nn">packages.fetchai.skills.generic_buyer.strategy</span> <span class="kn">import</span> <span class="n">GenericStrategy</span>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="n">LEDGER_API_ADDRESS</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">LEDGER_CONNECTION_PUBLIC_ID</span><span class="p">)</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="k">class</span> <span class="nc">GenericFipaHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements a FIPA handler.&quot;&quot;&quot;</span>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a>    <span class="n">SUPPORTED_PROTOCOL</span> <span class="o">=</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">protocol_id</span>  <span class="c1"># type: Optional[PublicId]</span>
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the setup.&quot;&quot;&quot;</span>
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a>
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="sd">        Implement the reaction to a message.</span>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a>
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a><span class="sd">        :param message: the message</span>
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a>        <span class="n">fipa_msg</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">FipaMessage</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a>
<a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a>        <span class="c1"># recover dialogue</span>
<a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a>        <span class="n">fipa_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">FipaDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">fipa_dialogues</span><span class="p">)</span>
<a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a>        <span class="n">fipa_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">FipaDialogue</span><span class="p">,</span> <span class="n">fipa_dialogues</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">))</span>
<a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a>        <span class="k">if</span> <span class="n">fipa_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_unidentified_dialogue</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">)</span>
<a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a>            <span class="k">return</span>
<a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a>
<a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a>        <span class="c1"># handle message</span>
<a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a>        <span class="k">if</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">PROPOSE</span><span class="p">:</span>
<a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_propose</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">)</span>
<a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a>        <span class="k">elif</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">DECLINE</span><span class="p">:</span>
<a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_decline</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">,</span> <span class="n">fipa_dialogues</span><span class="p">)</span>
<a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a>        <span class="k">elif</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">MATCH_ACCEPT_W_INFORM</span><span class="p">:</span>
<a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_match_accept</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">)</span>
<a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a>        <span class="k">elif</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">INFORM</span><span class="p">:</span>
<a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_inform</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">,</span> <span class="n">fipa_dialogues</span><span class="p">)</span>
<a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_invalid</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">)</span>
<a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a>
<a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the handler teardown.&quot;&quot;&quot;</span>
</code></pre></div>
<p>You will see that we are following similar logic to the <code>generic_seller</code> when we develop the <code>generic_buyer</code>’s side of the negotiation. First, we create a new dialogue and store it in the dialogues class. Then we are checking what kind of message we received by checking its performative. So lets start creating our handlers:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>    <span class="k">def</span> <span class="nf">_handle_unidentified_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="sd">        Handle an unidentified dialogue.</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>            <span class="s2">&quot;received invalid fipa message=</span><span class="si">{}</span><span class="s2">, unidentified dialogue.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="p">)</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>        <span class="p">)</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>        <span class="n">default_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">DefaultDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">default_dialogues</span><span class="p">)</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>        <span class="n">default_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">default_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>            <span class="n">counterparty</span><span class="o">=</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">DefaultMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>            <span class="n">error_code</span><span class="o">=</span><span class="n">DefaultMessage</span><span class="o">.</span><span class="n">ErrorCode</span><span class="o">.</span><span class="n">INVALID_DIALOGUE</span><span class="p">,</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>            <span class="n">error_msg</span><span class="o">=</span><span class="s2">&quot;Invalid dialogue.&quot;</span><span class="p">,</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>            <span class="n">error_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fipa_message&quot;</span><span class="p">:</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">encode</span><span class="p">()},</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>        <span class="p">)</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">default_msg</span><span class="p">)</span>
</code></pre></div>
<p>The above code handles messages referencing unidentified dialogues and responds with an error message to the sender. Next we will handle the <code>PROPOSE</code> message received from the <code>my_generic_seller</code> AEA:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>    <span class="k">def</span> <span class="nf">_handle_propose</span><span class="p">(</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="sd">        Handle the propose.</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="sd">        :param fipa_dialogue: the dialogue object</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>            <span class="s2">&quot;received proposal=</span><span class="si">{}</span><span class="s2"> from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>                <span class="n">fipa_msg</span><span class="o">.</span><span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>                <span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>            <span class="p">)</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>        <span class="p">)</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>        <span class="n">acceptable</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_acceptable_proposal</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">proposal</span><span class="p">)</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>        <span class="n">affordable</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_affordable_proposal</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">proposal</span><span class="p">)</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>        <span class="k">if</span> <span class="n">acceptable</span> <span class="ow">and</span> <span class="n">affordable</span><span class="p">:</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>                <span class="s2">&quot;accepting the proposal from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>            <span class="p">)</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>            <span class="n">terms</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">terms_from_proposal</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">proposal</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span> <span class="o">=</span> <span class="n">terms</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>            <span class="n">accept_msg</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">ACCEPT</span><span class="p">,</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>                <span class="n">target_message</span><span class="o">=</span><span class="n">fipa_msg</span><span class="p">,</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>            <span class="p">)</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">accept_msg</span><span class="p">)</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>                <span class="s2">&quot;declining the proposal from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>            <span class="p">)</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>            <span class="n">decline_msg</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">DECLINE</span><span class="p">,</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>                <span class="n">target_message</span><span class="o">=</span><span class="n">fipa_msg</span><span class="p">,</span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>            <span class="p">)</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">decline_msg</span><span class="p">)</span>
</code></pre></div>
<p>When we receive a proposal, we have to check if we have the funds to complete the transaction and if the proposal is acceptable based on our strategy. If the proposal is not affordable or acceptable, we respond with a <code>DECLINE</code> message. Otherwise, we send an <code>ACCEPT</code> message to the seller.</p>
<p>The next code-block handles the <code>DECLINE</code> message that we may receive from the seller as a response to our <code>CFP</code> or <code>ACCEPT</code> messages:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>    <span class="k">def</span> <span class="nf">_handle_decline</span><span class="p">(</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>        <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>        <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span><span class="p">,</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>        <span class="n">fipa_dialogues</span><span class="p">:</span> <span class="n">FipaDialogues</span><span class="p">,</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="sd">        Handle the decline.</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="sd">        :param fipa_dialogue: the fipa dialogue</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="sd">        :param fipa_dialogues: the fipa dialogues</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>            <span class="s2">&quot;received DECLINE from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>        <span class="p">)</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>        <span class="n">target_message</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">get_message_by_id</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_message</span><span class="p">:</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can not find target message!&quot;</span><span class="p">)</span>  <span class="c1"># pragma: nocover</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>        <span class="n">declined_performative</span> <span class="o">=</span> <span class="n">target_message</span><span class="o">.</span><span class="n">performative</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>        <span class="k">if</span> <span class="n">declined_performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">CFP</span><span class="p">:</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>            <span class="n">fipa_dialogues</span><span class="o">.</span><span class="n">dialogue_stats</span><span class="o">.</span><span class="n">add_dialogue_endstate</span><span class="p">(</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>                <span class="n">FipaDialogue</span><span class="o">.</span><span class="n">EndState</span><span class="o">.</span><span class="n">DECLINED_CFP</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">is_self_initiated</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>            <span class="p">)</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>        <span class="k">if</span> <span class="n">declined_performative</span> <span class="o">==</span> <span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">ACCEPT</span><span class="p">:</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>            <span class="n">fipa_dialogues</span><span class="o">.</span><span class="n">dialogue_stats</span><span class="o">.</span><span class="n">add_dialogue_endstate</span><span class="p">(</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>                <span class="n">FipaDialogue</span><span class="o">.</span><span class="n">EndState</span><span class="o">.</span><span class="n">DECLINED_ACCEPT</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">is_self_initiated</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>            <span class="p">)</span>
</code></pre></div>
<p>The above code terminates each dialogue with the specific AEA and stores the state of the terminated dialogue (whether it was terminated after a <code>CFP</code> or an <code>ACCEPT</code>).</p>
<p>If <code>my_generic_seller</code> AEA wants to move on with the sale, it will send a <code>MATCH_ACCEPT</code> message. In order to handle this we add the following code:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">def</span> <span class="nf">_handle_match_accept</span><span class="p">(</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="sd">        Handle the match accept.</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="sd">        :param fipa_dialogue: the dialogue object</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>            <span class="s2">&quot;received MATCH_ACCEPT_W_INFORM from sender=</span><span class="si">{}</span><span class="s2"> with info=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>                <span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">info</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>            <span class="p">)</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>        <span class="p">)</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>        <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_ledger_tx</span><span class="p">:</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>            <span class="n">transfer_address</span> <span class="o">=</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>            <span class="k">if</span> <span class="n">transfer_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transfer_address</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>                <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">counterparty_address</span> <span class="o">=</span> <span class="p">(</span>  <span class="c1"># pragma: nocover</span>
<a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>                    <span class="n">transfer_address</span>
<a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>                <span class="p">)</span>
<a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>
<a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>            <span class="n">tx_behaviour</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>                <span class="n">GenericTransactionBehaviour</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">transaction</span>
<a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a>            <span class="p">)</span>
<a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a>            <span class="n">tx_behaviour</span><span class="o">.</span><span class="n">waiting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fipa_dialogue</span><span class="p">)</span>
<a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>            <span class="n">inform_msg</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">INFORM</span><span class="p">,</span>
<a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a>                <span class="n">target_message</span><span class="o">=</span><span class="n">fipa_msg</span><span class="p">,</span>
<a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a>                <span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Done&quot;</span><span class="p">:</span> <span class="s2">&quot;Sending payment via bank transfer&quot;</span><span class="p">},</span>
<a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a>            <span class="p">)</span>
<a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">inform_msg</span><span class="p">)</span>
<a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a>                <span class="s2">&quot;informing counterparty=</span><span class="si">{}</span><span class="s2"> of payment.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a>            <span class="p">)</span>
</code></pre></div>
<p>The first thing we are checking is if we enabled our AEA to transact with a ledger. If so, we add this negotiation to the queue of transactions to be processed. If not, we simulate non-ledger payment by sending an <code>inform</code> to the seller that the payment is done (say via bank transfer).</p>
<p>Lastly, we need to handle <code>INFORM</code> messages. This is the message that will have our data:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>    <span class="k">def</span> <span class="nf">_handle_inform</span><span class="p">(</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>        <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>        <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span><span class="p">,</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>        <span class="n">fipa_dialogues</span><span class="p">:</span> <span class="n">FipaDialogues</span><span class="p">,</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="sd">        Handle the match inform.</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="sd">        :param fipa_dialogue: the fipa dialogue</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="sd">        :param fipa_dialogues: the fipa dialogues</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>            <span class="s2">&quot;received INFORM from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>        <span class="p">)</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">fipa_msg</span><span class="o">.</span><span class="n">info</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>            <span class="n">data_string</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">data</span><span class="p">)[:</span><span class="mi">1000</span><span class="p">]</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;received the following data=</span><span class="si">{</span><span class="n">data_string</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>            <span class="n">fipa_dialogues</span><span class="o">.</span><span class="n">dialogue_stats</span><span class="o">.</span><span class="n">add_dialogue_endstate</span><span class="p">(</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>                <span class="n">FipaDialogue</span><span class="o">.</span><span class="n">EndState</span><span class="o">.</span><span class="n">SUCCESSFUL</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">is_self_initiated</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>            <span class="p">)</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>            <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>            <span class="n">strategy</span><span class="o">.</span><span class="n">successful_trade_with_counterparty</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>                <span class="s2">&quot;received no data from sender=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fipa_msg</span><span class="o">.</span><span class="n">sender</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>            <span class="p">)</span>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>    <span class="k">def</span> <span class="nf">_handle_invalid</span><span class="p">(</span>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">fipa_msg</span><span class="p">:</span> <span class="n">FipaMessage</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="sd">        Handle a fipa message of invalid performative.</span>
<a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>
<a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="sd">        :param fipa_msg: the message</span>
<a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="sd">        :param fipa_dialogue: the fipa dialogue</span>
<a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>            <span class="s2">&quot;cannot handle fipa message of performative=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a>                <span class="n">fipa_msg</span><span class="o">.</span><span class="n">performative</span><span class="p">,</span> <span class="n">fipa_dialogue</span>
<a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a>            <span class="p">)</span>
<a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a>        <span class="p">)</span>
</code></pre></div>
<p>We now need to add handlers for messages received from the <code>DecisionMaker</code> and the <a href="../simple-oef">SOEF search node</a>. We need one handler for each type of protocol we use.</p>
<p>To handle the messages in the <code>oef_search</code> protocol used by the <a href="../simple-oef">SOEF search node</a> we add the following code in the same file (<code>my_generic_buyer/skills/generic_buyer/handlers.py</code>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">class</span> <span class="nc">GenericOefSearchHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements an OEF search handler.&quot;&quot;&quot;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="n">SUPPORTED_PROTOCOL</span> <span class="o">=</span> <span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">protocol_id</span>  <span class="c1"># type: Optional[PublicId]</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Call to setup the handler.&quot;&quot;&quot;</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="sd">        Implement the reaction to a message.</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="sd">        :param message: the message</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>        <span class="n">oef_search_msg</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">OefSearchMessage</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>        <span class="c1"># recover dialogue</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>        <span class="n">oef_search_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>            <span class="n">OefSearchDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">oef_search_dialogues</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>        <span class="p">)</span>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>        <span class="n">oef_search_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>            <span class="n">Optional</span><span class="p">[</span><span class="n">OefSearchDialogue</span><span class="p">],</span> <span class="n">oef_search_dialogues</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">)</span>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>        <span class="p">)</span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>        <span class="k">if</span> <span class="n">oef_search_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_unidentified_dialogue</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">)</span>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>            <span class="k">return</span>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a>        <span class="c1"># handle message</span>
<a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a>        <span class="k">if</span> <span class="n">oef_search_msg</span><span class="o">.</span><span class="n">performative</span> <span class="ow">is</span> <span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">OEF_ERROR</span><span class="p">:</span>
<a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_error</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">)</span>
<a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a>        <span class="k">elif</span> <span class="n">oef_search_msg</span><span class="o">.</span><span class="n">performative</span> <span class="ow">is</span> <span class="n">OefSearchMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">SEARCH_RESULT</span><span class="p">:</span>
<a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_search</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">)</span>
<a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_invalid</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">)</span>
<a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a>
<a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the handler teardown.&quot;&quot;&quot;</span>
<a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a>
<a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a>    <span class="k">def</span> <span class="nf">_handle_unidentified_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oef_search_msg</span><span class="p">:</span> <span class="n">OefSearchMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-27-40" name="__codelineno-27-40" href="#__codelineno-27-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-27-41" name="__codelineno-27-41" href="#__codelineno-27-41"></a><span class="sd">        Handle an unidentified dialogue.</span>
<a id="__codelineno-27-42" name="__codelineno-27-42" href="#__codelineno-27-42"></a>
<a id="__codelineno-27-43" name="__codelineno-27-43" href="#__codelineno-27-43"></a><span class="sd">        :param oef_search_msg: the message</span>
<a id="__codelineno-27-44" name="__codelineno-27-44" href="#__codelineno-27-44"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-27-45" name="__codelineno-27-45" href="#__codelineno-27-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-27-46" name="__codelineno-27-46" href="#__codelineno-27-46"></a>            <span class="s2">&quot;received invalid oef_search message=</span><span class="si">{}</span><span class="s2">, unidentified dialogue.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-27-47" name="__codelineno-27-47" href="#__codelineno-27-47"></a>                <span class="n">oef_search_msg</span>
<a id="__codelineno-27-48" name="__codelineno-27-48" href="#__codelineno-27-48"></a>            <span class="p">)</span>
<a id="__codelineno-27-49" name="__codelineno-27-49" href="#__codelineno-27-49"></a>        <span class="p">)</span>
<a id="__codelineno-27-50" name="__codelineno-27-50" href="#__codelineno-27-50"></a>
<a id="__codelineno-27-51" name="__codelineno-27-51" href="#__codelineno-27-51"></a>    <span class="k">def</span> <span class="nf">_handle_error</span><span class="p">(</span>
<a id="__codelineno-27-52" name="__codelineno-27-52" href="#__codelineno-27-52"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">oef_search_msg</span><span class="p">:</span> <span class="n">OefSearchMessage</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">:</span> <span class="n">OefSearchDialogue</span>
<a id="__codelineno-27-53" name="__codelineno-27-53" href="#__codelineno-27-53"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-27-54" name="__codelineno-27-54" href="#__codelineno-27-54"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-27-55" name="__codelineno-27-55" href="#__codelineno-27-55"></a><span class="sd">        Handle an oef search message.</span>
<a id="__codelineno-27-56" name="__codelineno-27-56" href="#__codelineno-27-56"></a>
<a id="__codelineno-27-57" name="__codelineno-27-57" href="#__codelineno-27-57"></a><span class="sd">        :param oef_search_msg: the oef search message</span>
<a id="__codelineno-27-58" name="__codelineno-27-58" href="#__codelineno-27-58"></a><span class="sd">        :param oef_search_dialogue: the dialogue</span>
<a id="__codelineno-27-59" name="__codelineno-27-59" href="#__codelineno-27-59"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-27-60" name="__codelineno-27-60" href="#__codelineno-27-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-27-61" name="__codelineno-27-61" href="#__codelineno-27-61"></a>            <span class="s2">&quot;received oef_search error message=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-27-62" name="__codelineno-27-62" href="#__codelineno-27-62"></a>                <span class="n">oef_search_msg</span><span class="p">,</span> <span class="n">oef_search_dialogue</span>
<a id="__codelineno-27-63" name="__codelineno-27-63" href="#__codelineno-27-63"></a>            <span class="p">)</span>
<a id="__codelineno-27-64" name="__codelineno-27-64" href="#__codelineno-27-64"></a>        <span class="p">)</span>
<a id="__codelineno-27-65" name="__codelineno-27-65" href="#__codelineno-27-65"></a>
<a id="__codelineno-27-66" name="__codelineno-27-66" href="#__codelineno-27-66"></a>    <span class="k">def</span> <span class="nf">_handle_search</span><span class="p">(</span>
<a id="__codelineno-27-67" name="__codelineno-27-67" href="#__codelineno-27-67"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">oef_search_msg</span><span class="p">:</span> <span class="n">OefSearchMessage</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">:</span> <span class="n">OefSearchDialogue</span>
<a id="__codelineno-27-68" name="__codelineno-27-68" href="#__codelineno-27-68"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-27-69" name="__codelineno-27-69" href="#__codelineno-27-69"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-27-70" name="__codelineno-27-70" href="#__codelineno-27-70"></a><span class="sd">        Handle the search response.</span>
<a id="__codelineno-27-71" name="__codelineno-27-71" href="#__codelineno-27-71"></a>
<a id="__codelineno-27-72" name="__codelineno-27-72" href="#__codelineno-27-72"></a><span class="sd">        :param oef_search_msg: the oef search message</span>
<a id="__codelineno-27-73" name="__codelineno-27-73" href="#__codelineno-27-73"></a><span class="sd">        :param oef_search_dialogue: the dialogue</span>
<a id="__codelineno-27-74" name="__codelineno-27-74" href="#__codelineno-27-74"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-27-75" name="__codelineno-27-75" href="#__codelineno-27-75"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-27-76" name="__codelineno-27-76" href="#__codelineno-27-76"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-27-77" name="__codelineno-27-77" href="#__codelineno-27-77"></a>                <span class="sa">f</span><span class="s2">&quot;found no agents in dialogue=</span><span class="si">{</span><span class="n">oef_search_dialogue</span><span class="si">}</span><span class="s2">, continue searching.&quot;</span>
<a id="__codelineno-27-78" name="__codelineno-27-78" href="#__codelineno-27-78"></a>            <span class="p">)</span>
<a id="__codelineno-27-79" name="__codelineno-27-79" href="#__codelineno-27-79"></a>            <span class="k">return</span>
<a id="__codelineno-27-80" name="__codelineno-27-80" href="#__codelineno-27-80"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-27-81" name="__codelineno-27-81" href="#__codelineno-27-81"></a>        <span class="k">if</span> <span class="n">strategy</span><span class="o">.</span><span class="n">is_stop_searching_on_result</span><span class="p">:</span>
<a id="__codelineno-27-82" name="__codelineno-27-82" href="#__codelineno-27-82"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-27-83" name="__codelineno-27-83" href="#__codelineno-27-83"></a>                <span class="s2">&quot;found agents=</span><span class="si">{}</span><span class="s2">, stopping search.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-27-84" name="__codelineno-27-84" href="#__codelineno-27-84"></a>                    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">oef_search_msg</span><span class="o">.</span><span class="n">agents</span><span class="p">)),</span>
<a id="__codelineno-27-85" name="__codelineno-27-85" href="#__codelineno-27-85"></a>                <span class="p">)</span>
<a id="__codelineno-27-86" name="__codelineno-27-86" href="#__codelineno-27-86"></a>            <span class="p">)</span>
<a id="__codelineno-27-87" name="__codelineno-27-87" href="#__codelineno-27-87"></a>            <span class="n">strategy</span><span class="o">.</span><span class="n">is_searching</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># stopping search</span>
<a id="__codelineno-27-88" name="__codelineno-27-88" href="#__codelineno-27-88"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-27-89" name="__codelineno-27-89" href="#__codelineno-27-89"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-27-90" name="__codelineno-27-90" href="#__codelineno-27-90"></a>                <span class="s2">&quot;found agents=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-27-91" name="__codelineno-27-91" href="#__codelineno-27-91"></a>                    <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">oef_search_msg</span><span class="o">.</span><span class="n">agents</span><span class="p">)),</span>
<a id="__codelineno-27-92" name="__codelineno-27-92" href="#__codelineno-27-92"></a>                <span class="p">)</span>
<a id="__codelineno-27-93" name="__codelineno-27-93" href="#__codelineno-27-93"></a>            <span class="p">)</span>
<a id="__codelineno-27-94" name="__codelineno-27-94" href="#__codelineno-27-94"></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_service_query</span><span class="p">()</span>
<a id="__codelineno-27-95" name="__codelineno-27-95" href="#__codelineno-27-95"></a>        <span class="n">fipa_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">FipaDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">fipa_dialogues</span><span class="p">)</span>
<a id="__codelineno-27-96" name="__codelineno-27-96" href="#__codelineno-27-96"></a>        <span class="n">counterparties</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">get_acceptable_counterparties</span><span class="p">(</span><span class="n">oef_search_msg</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span>
<a id="__codelineno-27-97" name="__codelineno-27-97" href="#__codelineno-27-97"></a>        <span class="k">for</span> <span class="n">counterparty</span> <span class="ow">in</span> <span class="n">counterparties</span><span class="p">:</span>
<a id="__codelineno-27-98" name="__codelineno-27-98" href="#__codelineno-27-98"></a>            <span class="n">cfp_msg</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">fipa_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-27-99" name="__codelineno-27-99" href="#__codelineno-27-99"></a>                <span class="n">counterparty</span><span class="o">=</span><span class="n">counterparty</span><span class="p">,</span>
<a id="__codelineno-27-100" name="__codelineno-27-100" href="#__codelineno-27-100"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">CFP</span><span class="p">,</span>
<a id="__codelineno-27-101" name="__codelineno-27-101" href="#__codelineno-27-101"></a>                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
<a id="__codelineno-27-102" name="__codelineno-27-102" href="#__codelineno-27-102"></a>            <span class="p">)</span>
<a id="__codelineno-27-103" name="__codelineno-27-103" href="#__codelineno-27-103"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">cfp_msg</span><span class="p">)</span>
<a id="__codelineno-27-104" name="__codelineno-27-104" href="#__codelineno-27-104"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-27-105" name="__codelineno-27-105" href="#__codelineno-27-105"></a>                <span class="s2">&quot;sending CFP to agent=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counterparty</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-27-106" name="__codelineno-27-106" href="#__codelineno-27-106"></a>            <span class="p">)</span>
<a id="__codelineno-27-107" name="__codelineno-27-107" href="#__codelineno-27-107"></a>
<a id="__codelineno-27-108" name="__codelineno-27-108" href="#__codelineno-27-108"></a>    <span class="k">def</span> <span class="nf">_handle_invalid</span><span class="p">(</span>
<a id="__codelineno-27-109" name="__codelineno-27-109" href="#__codelineno-27-109"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">oef_search_msg</span><span class="p">:</span> <span class="n">OefSearchMessage</span><span class="p">,</span> <span class="n">oef_search_dialogue</span><span class="p">:</span> <span class="n">OefSearchDialogue</span>
<a id="__codelineno-27-110" name="__codelineno-27-110" href="#__codelineno-27-110"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-27-111" name="__codelineno-27-111" href="#__codelineno-27-111"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-27-112" name="__codelineno-27-112" href="#__codelineno-27-112"></a><span class="sd">        Handle an oef search message.</span>
<a id="__codelineno-27-113" name="__codelineno-27-113" href="#__codelineno-27-113"></a>
<a id="__codelineno-27-114" name="__codelineno-27-114" href="#__codelineno-27-114"></a><span class="sd">        :param oef_search_msg: the oef search message</span>
<a id="__codelineno-27-115" name="__codelineno-27-115" href="#__codelineno-27-115"></a><span class="sd">        :param oef_search_dialogue: the dialogue</span>
<a id="__codelineno-27-116" name="__codelineno-27-116" href="#__codelineno-27-116"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-27-117" name="__codelineno-27-117" href="#__codelineno-27-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-27-118" name="__codelineno-27-118" href="#__codelineno-27-118"></a>            <span class="s2">&quot;cannot handle oef_search message of performative=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-27-119" name="__codelineno-27-119" href="#__codelineno-27-119"></a>                <span class="n">oef_search_msg</span><span class="o">.</span><span class="n">performative</span><span class="p">,</span>
<a id="__codelineno-27-120" name="__codelineno-27-120" href="#__codelineno-27-120"></a>                <span class="n">oef_search_dialogue</span><span class="p">,</span>
<a id="__codelineno-27-121" name="__codelineno-27-121" href="#__codelineno-27-121"></a>            <span class="p">)</span>
<a id="__codelineno-27-122" name="__codelineno-27-122" href="#__codelineno-27-122"></a>        <span class="p">)</span>
</code></pre></div>
<p>When we receive a message from the <a href="../simple-oef">SOEF search node</a> of a type <code>OefSearchMessage.Performative.SEARCH_RESULT</code>, we are passing the details to the relevant handler method. In the <code>_handle_search</code> function, we are checking that the response contains some agents, and we stop the search if it does. We pick our first agent and send a <code>CFP</code> message.</p>
<p>The last handlers we need are the <code>GenericSigningHandler</code> and the <code>GenericLedgerApiHandler</code>. These handlers are responsible for <code>SigningMessages</code> that we receive from the <code>DecisionMaker</code>, and <code>LedgerApiMessages</code> that we receive from the ledger connection, respectively.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">class</span> <span class="nc">GenericSigningHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement the signing handler.&quot;&quot;&quot;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    <span class="n">SUPPORTED_PROTOCOL</span> <span class="o">=</span> <span class="n">SigningMessage</span><span class="o">.</span><span class="n">protocol_id</span>  <span class="c1"># type: Optional[PublicId]</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the setup for the handler.&quot;&quot;&quot;</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="sd">        Implement the reaction to a message.</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="sd">        :param message: the message</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>        <span class="n">signing_msg</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">SigningMessage</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>        <span class="c1"># recover dialogue</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>        <span class="n">signing_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">SigningDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">signing_dialogues</span><span class="p">)</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>        <span class="n">signing_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>            <span class="n">Optional</span><span class="p">[</span><span class="n">SigningDialogue</span><span class="p">],</span> <span class="n">signing_dialogues</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">signing_msg</span><span class="p">)</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>        <span class="p">)</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>        <span class="k">if</span> <span class="n">signing_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_unidentified_dialogue</span><span class="p">(</span><span class="n">signing_msg</span><span class="p">)</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>            <span class="k">return</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>        <span class="c1"># handle message</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>        <span class="k">if</span> <span class="n">signing_msg</span><span class="o">.</span><span class="n">performative</span> <span class="ow">is</span> <span class="n">SigningMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">SIGNED_TRANSACTION</span><span class="p">:</span>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_signed_transaction</span><span class="p">(</span><span class="n">signing_msg</span><span class="p">,</span> <span class="n">signing_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>        <span class="k">elif</span> <span class="n">signing_msg</span><span class="o">.</span><span class="n">performative</span> <span class="ow">is</span> <span class="n">SigningMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_error</span><span class="p">(</span><span class="n">signing_msg</span><span class="p">,</span> <span class="n">signing_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_invalid</span><span class="p">(</span><span class="n">signing_msg</span><span class="p">,</span> <span class="n">signing_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the handler teardown.&quot;&quot;&quot;</span>
<a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a>
<a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a>    <span class="k">def</span> <span class="nf">_handle_unidentified_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signing_msg</span><span class="p">:</span> <span class="n">SigningMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a><span class="sd">        Handle an unidentified dialogue.</span>
<a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a>
<a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a><span class="sd">        :param signing_msg: the message</span>
<a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a>            <span class="s2">&quot;received invalid signing message=</span><span class="si">{}</span><span class="s2">, unidentified dialogue.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-45" name="__codelineno-28-45" href="#__codelineno-28-45"></a>                <span class="n">signing_msg</span>
<a id="__codelineno-28-46" name="__codelineno-28-46" href="#__codelineno-28-46"></a>            <span class="p">)</span>
<a id="__codelineno-28-47" name="__codelineno-28-47" href="#__codelineno-28-47"></a>        <span class="p">)</span>
<a id="__codelineno-28-48" name="__codelineno-28-48" href="#__codelineno-28-48"></a>
<a id="__codelineno-28-49" name="__codelineno-28-49" href="#__codelineno-28-49"></a>    <span class="k">def</span> <span class="nf">_handle_signed_transaction</span><span class="p">(</span>
<a id="__codelineno-28-50" name="__codelineno-28-50" href="#__codelineno-28-50"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">signing_msg</span><span class="p">:</span> <span class="n">SigningMessage</span><span class="p">,</span> <span class="n">signing_dialogue</span><span class="p">:</span> <span class="n">SigningDialogue</span>
<a id="__codelineno-28-51" name="__codelineno-28-51" href="#__codelineno-28-51"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-52" name="__codelineno-28-52" href="#__codelineno-28-52"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-53" name="__codelineno-28-53" href="#__codelineno-28-53"></a><span class="sd">        Handle an oef search message.</span>
<a id="__codelineno-28-54" name="__codelineno-28-54" href="#__codelineno-28-54"></a>
<a id="__codelineno-28-55" name="__codelineno-28-55" href="#__codelineno-28-55"></a><span class="sd">        :param signing_msg: the signing message</span>
<a id="__codelineno-28-56" name="__codelineno-28-56" href="#__codelineno-28-56"></a><span class="sd">        :param signing_dialogue: the dialogue</span>
<a id="__codelineno-28-57" name="__codelineno-28-57" href="#__codelineno-28-57"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-58" name="__codelineno-28-58" href="#__codelineno-28-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;transaction signing was successful.&quot;</span><span class="p">)</span>
<a id="__codelineno-28-59" name="__codelineno-28-59" href="#__codelineno-28-59"></a>        <span class="n">ledger_api_dialogue</span> <span class="o">=</span> <span class="n">signing_dialogue</span><span class="o">.</span><span class="n">associated_ledger_api_dialogue</span>
<a id="__codelineno-28-60" name="__codelineno-28-60" href="#__codelineno-28-60"></a>        <span class="n">last_ledger_api_msg</span> <span class="o">=</span> <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">last_incoming_message</span>
<a id="__codelineno-28-61" name="__codelineno-28-61" href="#__codelineno-28-61"></a>        <span class="k">if</span> <span class="n">last_ledger_api_msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-62" name="__codelineno-28-62" href="#__codelineno-28-62"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not retrieve last message in ledger api dialogue&quot;</span><span class="p">)</span>
<a id="__codelineno-28-63" name="__codelineno-28-63" href="#__codelineno-28-63"></a>        <span class="n">ledger_api_msg</span> <span class="o">=</span> <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-28-64" name="__codelineno-28-64" href="#__codelineno-28-64"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">SEND_SIGNED_TRANSACTION</span><span class="p">,</span>
<a id="__codelineno-28-65" name="__codelineno-28-65" href="#__codelineno-28-65"></a>            <span class="n">target_message</span><span class="o">=</span><span class="n">last_ledger_api_msg</span><span class="p">,</span>
<a id="__codelineno-28-66" name="__codelineno-28-66" href="#__codelineno-28-66"></a>            <span class="n">signed_transaction</span><span class="o">=</span><span class="n">signing_msg</span><span class="o">.</span><span class="n">signed_transaction</span><span class="p">,</span>
<a id="__codelineno-28-67" name="__codelineno-28-67" href="#__codelineno-28-67"></a>        <span class="p">)</span>
<a id="__codelineno-28-68" name="__codelineno-28-68" href="#__codelineno-28-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-28-69" name="__codelineno-28-69" href="#__codelineno-28-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;sending transaction to ledger.&quot;</span><span class="p">)</span>
<a id="__codelineno-28-70" name="__codelineno-28-70" href="#__codelineno-28-70"></a>
<a id="__codelineno-28-71" name="__codelineno-28-71" href="#__codelineno-28-71"></a>    <span class="k">def</span> <span class="nf">_handle_error</span><span class="p">(</span>
<a id="__codelineno-28-72" name="__codelineno-28-72" href="#__codelineno-28-72"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">signing_msg</span><span class="p">:</span> <span class="n">SigningMessage</span><span class="p">,</span> <span class="n">signing_dialogue</span><span class="p">:</span> <span class="n">SigningDialogue</span>
<a id="__codelineno-28-73" name="__codelineno-28-73" href="#__codelineno-28-73"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-74" name="__codelineno-28-74" href="#__codelineno-28-74"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-75" name="__codelineno-28-75" href="#__codelineno-28-75"></a><span class="sd">        Handle an oef search message.</span>
<a id="__codelineno-28-76" name="__codelineno-28-76" href="#__codelineno-28-76"></a>
<a id="__codelineno-28-77" name="__codelineno-28-77" href="#__codelineno-28-77"></a><span class="sd">        :param signing_msg: the signing message</span>
<a id="__codelineno-28-78" name="__codelineno-28-78" href="#__codelineno-28-78"></a><span class="sd">        :param signing_dialogue: the dialogue</span>
<a id="__codelineno-28-79" name="__codelineno-28-79" href="#__codelineno-28-79"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-80" name="__codelineno-28-80" href="#__codelineno-28-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-28-81" name="__codelineno-28-81" href="#__codelineno-28-81"></a>            <span class="s2">&quot;transaction signing was not successful. Error_code=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-82" name="__codelineno-28-82" href="#__codelineno-28-82"></a>                <span class="n">signing_msg</span><span class="o">.</span><span class="n">error_code</span><span class="p">,</span> <span class="n">signing_dialogue</span>
<a id="__codelineno-28-83" name="__codelineno-28-83" href="#__codelineno-28-83"></a>            <span class="p">)</span>
<a id="__codelineno-28-84" name="__codelineno-28-84" href="#__codelineno-28-84"></a>        <span class="p">)</span>
<a id="__codelineno-28-85" name="__codelineno-28-85" href="#__codelineno-28-85"></a>        <span class="n">signing_msg_</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-28-86" name="__codelineno-28-86" href="#__codelineno-28-86"></a>            <span class="n">Optional</span><span class="p">[</span><span class="n">SigningMessage</span><span class="p">],</span> <span class="n">signing_dialogue</span><span class="o">.</span><span class="n">last_outgoing_message</span>
<a id="__codelineno-28-87" name="__codelineno-28-87" href="#__codelineno-28-87"></a>        <span class="p">)</span>
<a id="__codelineno-28-88" name="__codelineno-28-88" href="#__codelineno-28-88"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-28-89" name="__codelineno-28-89" href="#__codelineno-28-89"></a>            <span class="n">signing_msg_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-28-90" name="__codelineno-28-90" href="#__codelineno-28-90"></a>            <span class="ow">and</span> <span class="n">signing_msg_</span><span class="o">.</span><span class="n">performative</span>
<a id="__codelineno-28-91" name="__codelineno-28-91" href="#__codelineno-28-91"></a>            <span class="o">==</span> <span class="n">SigningMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">SIGN_TRANSACTION</span>
<a id="__codelineno-28-92" name="__codelineno-28-92" href="#__codelineno-28-92"></a>        <span class="p">):</span>
<a id="__codelineno-28-93" name="__codelineno-28-93" href="#__codelineno-28-93"></a>            <span class="n">tx_behaviour</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-28-94" name="__codelineno-28-94" href="#__codelineno-28-94"></a>                <span class="n">GenericTransactionBehaviour</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">transaction</span>
<a id="__codelineno-28-95" name="__codelineno-28-95" href="#__codelineno-28-95"></a>            <span class="p">)</span>
<a id="__codelineno-28-96" name="__codelineno-28-96" href="#__codelineno-28-96"></a>            <span class="n">ledger_api_dialogue</span> <span class="o">=</span> <span class="n">signing_dialogue</span><span class="o">.</span><span class="n">associated_ledger_api_dialogue</span>
<a id="__codelineno-28-97" name="__codelineno-28-97" href="#__codelineno-28-97"></a>            <span class="n">tx_behaviour</span><span class="o">.</span><span class="n">failed_processing</span><span class="p">(</span><span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-98" name="__codelineno-28-98" href="#__codelineno-28-98"></a>
<a id="__codelineno-28-99" name="__codelineno-28-99" href="#__codelineno-28-99"></a>    <span class="k">def</span> <span class="nf">_handle_invalid</span><span class="p">(</span>
<a id="__codelineno-28-100" name="__codelineno-28-100" href="#__codelineno-28-100"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">signing_msg</span><span class="p">:</span> <span class="n">SigningMessage</span><span class="p">,</span> <span class="n">signing_dialogue</span><span class="p">:</span> <span class="n">SigningDialogue</span>
<a id="__codelineno-28-101" name="__codelineno-28-101" href="#__codelineno-28-101"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-102" name="__codelineno-28-102" href="#__codelineno-28-102"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-103" name="__codelineno-28-103" href="#__codelineno-28-103"></a><span class="sd">        Handle an oef search message.</span>
<a id="__codelineno-28-104" name="__codelineno-28-104" href="#__codelineno-28-104"></a>
<a id="__codelineno-28-105" name="__codelineno-28-105" href="#__codelineno-28-105"></a><span class="sd">        :param signing_msg: the signing message</span>
<a id="__codelineno-28-106" name="__codelineno-28-106" href="#__codelineno-28-106"></a><span class="sd">        :param signing_dialogue: the dialogue</span>
<a id="__codelineno-28-107" name="__codelineno-28-107" href="#__codelineno-28-107"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-108" name="__codelineno-28-108" href="#__codelineno-28-108"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-28-109" name="__codelineno-28-109" href="#__codelineno-28-109"></a>            <span class="s2">&quot;cannot handle signing message of performative=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-110" name="__codelineno-28-110" href="#__codelineno-28-110"></a>                <span class="n">signing_msg</span><span class="o">.</span><span class="n">performative</span><span class="p">,</span> <span class="n">signing_dialogue</span>
<a id="__codelineno-28-111" name="__codelineno-28-111" href="#__codelineno-28-111"></a>            <span class="p">)</span>
<a id="__codelineno-28-112" name="__codelineno-28-112" href="#__codelineno-28-112"></a>        <span class="p">)</span>
<a id="__codelineno-28-113" name="__codelineno-28-113" href="#__codelineno-28-113"></a>
<a id="__codelineno-28-114" name="__codelineno-28-114" href="#__codelineno-28-114"></a>
<a id="__codelineno-28-115" name="__codelineno-28-115" href="#__codelineno-28-115"></a><span class="k">class</span> <span class="nc">GenericLedgerApiHandler</span><span class="p">(</span><span class="n">Handler</span><span class="p">):</span>
<a id="__codelineno-28-116" name="__codelineno-28-116" href="#__codelineno-28-116"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement the ledger handler.&quot;&quot;&quot;</span>
<a id="__codelineno-28-117" name="__codelineno-28-117" href="#__codelineno-28-117"></a>
<a id="__codelineno-28-118" name="__codelineno-28-118" href="#__codelineno-28-118"></a>    <span class="n">SUPPORTED_PROTOCOL</span> <span class="o">=</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">protocol_id</span>  <span class="c1"># type: Optional[PublicId]</span>
<a id="__codelineno-28-119" name="__codelineno-28-119" href="#__codelineno-28-119"></a>
<a id="__codelineno-28-120" name="__codelineno-28-120" href="#__codelineno-28-120"></a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-121" name="__codelineno-28-121" href="#__codelineno-28-121"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the setup for the handler.&quot;&quot;&quot;</span>
<a id="__codelineno-28-122" name="__codelineno-28-122" href="#__codelineno-28-122"></a>
<a id="__codelineno-28-123" name="__codelineno-28-123" href="#__codelineno-28-123"></a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-124" name="__codelineno-28-124" href="#__codelineno-28-124"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-125" name="__codelineno-28-125" href="#__codelineno-28-125"></a><span class="sd">        Implement the reaction to a message.</span>
<a id="__codelineno-28-126" name="__codelineno-28-126" href="#__codelineno-28-126"></a>
<a id="__codelineno-28-127" name="__codelineno-28-127" href="#__codelineno-28-127"></a><span class="sd">        :param message: the message</span>
<a id="__codelineno-28-128" name="__codelineno-28-128" href="#__codelineno-28-128"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-129" name="__codelineno-28-129" href="#__codelineno-28-129"></a>        <span class="n">ledger_api_msg</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a id="__codelineno-28-130" name="__codelineno-28-130" href="#__codelineno-28-130"></a>
<a id="__codelineno-28-131" name="__codelineno-28-131" href="#__codelineno-28-131"></a>        <span class="c1"># recover dialogue</span>
<a id="__codelineno-28-132" name="__codelineno-28-132" href="#__codelineno-28-132"></a>        <span class="n">ledger_api_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-28-133" name="__codelineno-28-133" href="#__codelineno-28-133"></a>            <span class="n">LedgerApiDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">ledger_api_dialogues</span>
<a id="__codelineno-28-134" name="__codelineno-28-134" href="#__codelineno-28-134"></a>        <span class="p">)</span>
<a id="__codelineno-28-135" name="__codelineno-28-135" href="#__codelineno-28-135"></a>        <span class="n">ledger_api_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-28-136" name="__codelineno-28-136" href="#__codelineno-28-136"></a>            <span class="n">Optional</span><span class="p">[</span><span class="n">LedgerApiDialogue</span><span class="p">],</span> <span class="n">ledger_api_dialogues</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-28-137" name="__codelineno-28-137" href="#__codelineno-28-137"></a>        <span class="p">)</span>
<a id="__codelineno-28-138" name="__codelineno-28-138" href="#__codelineno-28-138"></a>        <span class="k">if</span> <span class="n">ledger_api_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-139" name="__codelineno-28-139" href="#__codelineno-28-139"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_unidentified_dialogue</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-28-140" name="__codelineno-28-140" href="#__codelineno-28-140"></a>            <span class="k">return</span>
<a id="__codelineno-28-141" name="__codelineno-28-141" href="#__codelineno-28-141"></a>
<a id="__codelineno-28-142" name="__codelineno-28-142" href="#__codelineno-28-142"></a>        <span class="c1"># handle message</span>
<a id="__codelineno-28-143" name="__codelineno-28-143" href="#__codelineno-28-143"></a>        <span class="k">if</span> <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span> <span class="ow">is</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">BALANCE</span><span class="p">:</span>
<a id="__codelineno-28-144" name="__codelineno-28-144" href="#__codelineno-28-144"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_balance</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">)</span>
<a id="__codelineno-28-145" name="__codelineno-28-145" href="#__codelineno-28-145"></a>        <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-28-146" name="__codelineno-28-146" href="#__codelineno-28-146"></a>            <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span> <span class="ow">is</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">RAW_TRANSACTION</span>
<a id="__codelineno-28-147" name="__codelineno-28-147" href="#__codelineno-28-147"></a>        <span class="p">):</span>
<a id="__codelineno-28-148" name="__codelineno-28-148" href="#__codelineno-28-148"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_raw_transaction</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-149" name="__codelineno-28-149" href="#__codelineno-28-149"></a>        <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-28-150" name="__codelineno-28-150" href="#__codelineno-28-150"></a>            <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span>
<a id="__codelineno-28-151" name="__codelineno-28-151" href="#__codelineno-28-151"></a>            <span class="o">==</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">TRANSACTION_DIGEST</span>
<a id="__codelineno-28-152" name="__codelineno-28-152" href="#__codelineno-28-152"></a>        <span class="p">):</span>
<a id="__codelineno-28-153" name="__codelineno-28-153" href="#__codelineno-28-153"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_transaction_digest</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-154" name="__codelineno-28-154" href="#__codelineno-28-154"></a>        <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-28-155" name="__codelineno-28-155" href="#__codelineno-28-155"></a>            <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span>
<a id="__codelineno-28-156" name="__codelineno-28-156" href="#__codelineno-28-156"></a>            <span class="o">==</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">TRANSACTION_RECEIPT</span>
<a id="__codelineno-28-157" name="__codelineno-28-157" href="#__codelineno-28-157"></a>        <span class="p">):</span>
<a id="__codelineno-28-158" name="__codelineno-28-158" href="#__codelineno-28-158"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_transaction_receipt</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-159" name="__codelineno-28-159" href="#__codelineno-28-159"></a>        <span class="k">elif</span> <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span> <span class="o">==</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span>
<a id="__codelineno-28-160" name="__codelineno-28-160" href="#__codelineno-28-160"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_error</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-161" name="__codelineno-28-161" href="#__codelineno-28-161"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-28-162" name="__codelineno-28-162" href="#__codelineno-28-162"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_invalid</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-163" name="__codelineno-28-163" href="#__codelineno-28-163"></a>
<a id="__codelineno-28-164" name="__codelineno-28-164" href="#__codelineno-28-164"></a>    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-165" name="__codelineno-28-165" href="#__codelineno-28-165"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Implement the handler teardown.&quot;&quot;&quot;</span>
<a id="__codelineno-28-166" name="__codelineno-28-166" href="#__codelineno-28-166"></a>
<a id="__codelineno-28-167" name="__codelineno-28-167" href="#__codelineno-28-167"></a>    <span class="k">def</span> <span class="nf">_handle_unidentified_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-168" name="__codelineno-28-168" href="#__codelineno-28-168"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-169" name="__codelineno-28-169" href="#__codelineno-28-169"></a><span class="sd">        Handle an unidentified dialogue.</span>
<a id="__codelineno-28-170" name="__codelineno-28-170" href="#__codelineno-28-170"></a>
<a id="__codelineno-28-171" name="__codelineno-28-171" href="#__codelineno-28-171"></a><span class="sd">        :param ledger_api_msg: the message</span>
<a id="__codelineno-28-172" name="__codelineno-28-172" href="#__codelineno-28-172"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-173" name="__codelineno-28-173" href="#__codelineno-28-173"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-28-174" name="__codelineno-28-174" href="#__codelineno-28-174"></a>            <span class="s2">&quot;received invalid ledger_api message=</span><span class="si">{}</span><span class="s2">, unidentified dialogue.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-175" name="__codelineno-28-175" href="#__codelineno-28-175"></a>                <span class="n">ledger_api_msg</span>
<a id="__codelineno-28-176" name="__codelineno-28-176" href="#__codelineno-28-176"></a>            <span class="p">)</span>
<a id="__codelineno-28-177" name="__codelineno-28-177" href="#__codelineno-28-177"></a>        <span class="p">)</span>
<a id="__codelineno-28-178" name="__codelineno-28-178" href="#__codelineno-28-178"></a>
<a id="__codelineno-28-179" name="__codelineno-28-179" href="#__codelineno-28-179"></a>    <span class="k">def</span> <span class="nf">_handle_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-180" name="__codelineno-28-180" href="#__codelineno-28-180"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-181" name="__codelineno-28-181" href="#__codelineno-28-181"></a><span class="sd">        Handle a message of balance performative.</span>
<a id="__codelineno-28-182" name="__codelineno-28-182" href="#__codelineno-28-182"></a>
<a id="__codelineno-28-183" name="__codelineno-28-183" href="#__codelineno-28-183"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-28-184" name="__codelineno-28-184" href="#__codelineno-28-184"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-185" name="__codelineno-28-185" href="#__codelineno-28-185"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">GenericStrategy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-28-186" name="__codelineno-28-186" href="#__codelineno-28-186"></a>        <span class="k">if</span> <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">balance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-28-187" name="__codelineno-28-187" href="#__codelineno-28-187"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-28-188" name="__codelineno-28-188" href="#__codelineno-28-188"></a>                <span class="s2">&quot;starting balance on </span><span class="si">{}</span><span class="s2"> ledger=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-189" name="__codelineno-28-189" href="#__codelineno-28-189"></a>                    <span class="n">strategy</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span>
<a id="__codelineno-28-190" name="__codelineno-28-190" href="#__codelineno-28-190"></a>                    <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span>
<a id="__codelineno-28-191" name="__codelineno-28-191" href="#__codelineno-28-191"></a>                <span class="p">)</span>
<a id="__codelineno-28-192" name="__codelineno-28-192" href="#__codelineno-28-192"></a>            <span class="p">)</span>
<a id="__codelineno-28-193" name="__codelineno-28-193" href="#__codelineno-28-193"></a>            <span class="n">strategy</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">balance</span>
<a id="__codelineno-28-194" name="__codelineno-28-194" href="#__codelineno-28-194"></a>            <span class="n">strategy</span><span class="o">.</span><span class="n">is_searching</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-28-195" name="__codelineno-28-195" href="#__codelineno-28-195"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-28-196" name="__codelineno-28-196" href="#__codelineno-28-196"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-28-197" name="__codelineno-28-197" href="#__codelineno-28-197"></a>                <span class="sa">f</span><span class="s2">&quot;you have no starting balance on </span><span class="si">{</span><span class="n">strategy</span><span class="o">.</span><span class="n">ledger_id</span><span class="si">}</span><span class="s2"> ledger! Stopping skill </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skill_id</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-28-198" name="__codelineno-28-198" href="#__codelineno-28-198"></a>            <span class="p">)</span>
<a id="__codelineno-28-199" name="__codelineno-28-199" href="#__codelineno-28-199"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-28-200" name="__codelineno-28-200" href="#__codelineno-28-200"></a>
<a id="__codelineno-28-201" name="__codelineno-28-201" href="#__codelineno-28-201"></a>    <span class="k">def</span> <span class="nf">_handle_raw_transaction</span><span class="p">(</span>
<a id="__codelineno-28-202" name="__codelineno-28-202" href="#__codelineno-28-202"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span>
<a id="__codelineno-28-203" name="__codelineno-28-203" href="#__codelineno-28-203"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-204" name="__codelineno-28-204" href="#__codelineno-28-204"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-205" name="__codelineno-28-205" href="#__codelineno-28-205"></a><span class="sd">        Handle a message of raw_transaction performative.</span>
<a id="__codelineno-28-206" name="__codelineno-28-206" href="#__codelineno-28-206"></a>
<a id="__codelineno-28-207" name="__codelineno-28-207" href="#__codelineno-28-207"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-28-208" name="__codelineno-28-208" href="#__codelineno-28-208"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-28-209" name="__codelineno-28-209" href="#__codelineno-28-209"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-210" name="__codelineno-28-210" href="#__codelineno-28-210"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;received raw transaction=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ledger_api_msg</span><span class="p">))</span>
<a id="__codelineno-28-211" name="__codelineno-28-211" href="#__codelineno-28-211"></a>        <span class="n">signing_dialogues</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">SigningDialogues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">signing_dialogues</span><span class="p">)</span>
<a id="__codelineno-28-212" name="__codelineno-28-212" href="#__codelineno-28-212"></a>        <span class="n">signing_msg</span><span class="p">,</span> <span class="n">signing_dialogue</span> <span class="o">=</span> <span class="n">signing_dialogues</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-28-213" name="__codelineno-28-213" href="#__codelineno-28-213"></a>            <span class="n">counterparty</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">decision_maker_address</span><span class="p">,</span>
<a id="__codelineno-28-214" name="__codelineno-28-214" href="#__codelineno-28-214"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">SigningMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">SIGN_TRANSACTION</span><span class="p">,</span>
<a id="__codelineno-28-215" name="__codelineno-28-215" href="#__codelineno-28-215"></a>            <span class="n">raw_transaction</span><span class="o">=</span><span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">raw_transaction</span><span class="p">,</span>
<a id="__codelineno-28-216" name="__codelineno-28-216" href="#__codelineno-28-216"></a>            <span class="n">terms</span><span class="o">=</span><span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">associated_fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="p">,</span>
<a id="__codelineno-28-217" name="__codelineno-28-217" href="#__codelineno-28-217"></a>        <span class="p">)</span>
<a id="__codelineno-28-218" name="__codelineno-28-218" href="#__codelineno-28-218"></a>        <span class="n">signing_dialogue</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">SigningDialogue</span><span class="p">,</span> <span class="n">signing_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-219" name="__codelineno-28-219" href="#__codelineno-28-219"></a>        <span class="n">signing_dialogue</span><span class="o">.</span><span class="n">associated_ledger_api_dialogue</span> <span class="o">=</span> <span class="n">ledger_api_dialogue</span>
<a id="__codelineno-28-220" name="__codelineno-28-220" href="#__codelineno-28-220"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">decision_maker_message_queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="n">signing_msg</span><span class="p">)</span>
<a id="__codelineno-28-221" name="__codelineno-28-221" href="#__codelineno-28-221"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-28-222" name="__codelineno-28-222" href="#__codelineno-28-222"></a>            <span class="s2">&quot;proposing the transaction to the decision maker. Waiting for confirmation ...&quot;</span>
<a id="__codelineno-28-223" name="__codelineno-28-223" href="#__codelineno-28-223"></a>        <span class="p">)</span>
<a id="__codelineno-28-224" name="__codelineno-28-224" href="#__codelineno-28-224"></a>
<a id="__codelineno-28-225" name="__codelineno-28-225" href="#__codelineno-28-225"></a>    <span class="k">def</span> <span class="nf">_handle_transaction_digest</span><span class="p">(</span>
<a id="__codelineno-28-226" name="__codelineno-28-226" href="#__codelineno-28-226"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span>
<a id="__codelineno-28-227" name="__codelineno-28-227" href="#__codelineno-28-227"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-228" name="__codelineno-28-228" href="#__codelineno-28-228"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-229" name="__codelineno-28-229" href="#__codelineno-28-229"></a><span class="sd">        Handle a message of transaction_digest performative.</span>
<a id="__codelineno-28-230" name="__codelineno-28-230" href="#__codelineno-28-230"></a>
<a id="__codelineno-28-231" name="__codelineno-28-231" href="#__codelineno-28-231"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-28-232" name="__codelineno-28-232" href="#__codelineno-28-232"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-28-233" name="__codelineno-28-233" href="#__codelineno-28-233"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-234" name="__codelineno-28-234" href="#__codelineno-28-234"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-28-235" name="__codelineno-28-235" href="#__codelineno-28-235"></a>            <span class="s2">&quot;transaction was successfully submitted. Transaction digest=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-236" name="__codelineno-28-236" href="#__codelineno-28-236"></a>                <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">transaction_digest</span>
<a id="__codelineno-28-237" name="__codelineno-28-237" href="#__codelineno-28-237"></a>            <span class="p">)</span>
<a id="__codelineno-28-238" name="__codelineno-28-238" href="#__codelineno-28-238"></a>        <span class="p">)</span>
<a id="__codelineno-28-239" name="__codelineno-28-239" href="#__codelineno-28-239"></a>        <span class="n">ledger_api_msg_</span> <span class="o">=</span> <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-28-240" name="__codelineno-28-240" href="#__codelineno-28-240"></a>            <span class="n">performative</span><span class="o">=</span><span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">GET_TRANSACTION_RECEIPT</span><span class="p">,</span>
<a id="__codelineno-28-241" name="__codelineno-28-241" href="#__codelineno-28-241"></a>            <span class="n">target_message</span><span class="o">=</span><span class="n">ledger_api_msg</span><span class="p">,</span>
<a id="__codelineno-28-242" name="__codelineno-28-242" href="#__codelineno-28-242"></a>            <span class="n">transaction_digest</span><span class="o">=</span><span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">transaction_digest</span><span class="p">,</span>
<a id="__codelineno-28-243" name="__codelineno-28-243" href="#__codelineno-28-243"></a>        <span class="p">)</span>
<a id="__codelineno-28-244" name="__codelineno-28-244" href="#__codelineno-28-244"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;checking transaction is settled.&quot;</span><span class="p">)</span>
<a id="__codelineno-28-245" name="__codelineno-28-245" href="#__codelineno-28-245"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">ledger_api_msg_</span><span class="p">)</span>
<a id="__codelineno-28-246" name="__codelineno-28-246" href="#__codelineno-28-246"></a>
<a id="__codelineno-28-247" name="__codelineno-28-247" href="#__codelineno-28-247"></a>    <span class="k">def</span> <span class="nf">_handle_transaction_receipt</span><span class="p">(</span>
<a id="__codelineno-28-248" name="__codelineno-28-248" href="#__codelineno-28-248"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span>
<a id="__codelineno-28-249" name="__codelineno-28-249" href="#__codelineno-28-249"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-250" name="__codelineno-28-250" href="#__codelineno-28-250"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-251" name="__codelineno-28-251" href="#__codelineno-28-251"></a><span class="sd">        Handle a message of balance performative.</span>
<a id="__codelineno-28-252" name="__codelineno-28-252" href="#__codelineno-28-252"></a>
<a id="__codelineno-28-253" name="__codelineno-28-253" href="#__codelineno-28-253"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-28-254" name="__codelineno-28-254" href="#__codelineno-28-254"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-28-255" name="__codelineno-28-255" href="#__codelineno-28-255"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-256" name="__codelineno-28-256" href="#__codelineno-28-256"></a>        <span class="n">fipa_dialogue</span> <span class="o">=</span> <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">associated_fipa_dialogue</span>
<a id="__codelineno-28-257" name="__codelineno-28-257" href="#__codelineno-28-257"></a>        <span class="n">is_settled</span> <span class="o">=</span> <span class="n">LedgerApis</span><span class="o">.</span><span class="n">is_transaction_settled</span><span class="p">(</span>
<a id="__codelineno-28-258" name="__codelineno-28-258" href="#__codelineno-28-258"></a>            <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">ledger_id</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">transaction_receipt</span><span class="o">.</span><span class="n">receipt</span>
<a id="__codelineno-28-259" name="__codelineno-28-259" href="#__codelineno-28-259"></a>        <span class="p">)</span>
<a id="__codelineno-28-260" name="__codelineno-28-260" href="#__codelineno-28-260"></a>        <span class="n">tx_behaviour</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-28-261" name="__codelineno-28-261" href="#__codelineno-28-261"></a>            <span class="n">GenericTransactionBehaviour</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">transaction</span>
<a id="__codelineno-28-262" name="__codelineno-28-262" href="#__codelineno-28-262"></a>        <span class="p">)</span>
<a id="__codelineno-28-263" name="__codelineno-28-263" href="#__codelineno-28-263"></a>        <span class="k">if</span> <span class="n">is_settled</span><span class="p">:</span>
<a id="__codelineno-28-264" name="__codelineno-28-264" href="#__codelineno-28-264"></a>            <span class="n">tx_behaviour</span><span class="o">.</span><span class="n">finish_processing</span><span class="p">(</span><span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-265" name="__codelineno-28-265" href="#__codelineno-28-265"></a>            <span class="n">ledger_api_msg_</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-28-266" name="__codelineno-28-266" href="#__codelineno-28-266"></a>                <span class="n">Optional</span><span class="p">[</span><span class="n">LedgerApiMessage</span><span class="p">],</span> <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">last_outgoing_message</span>
<a id="__codelineno-28-267" name="__codelineno-28-267" href="#__codelineno-28-267"></a>            <span class="p">)</span>
<a id="__codelineno-28-268" name="__codelineno-28-268" href="#__codelineno-28-268"></a>            <span class="k">if</span> <span class="n">ledger_api_msg_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-269" name="__codelineno-28-269" href="#__codelineno-28-269"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>  <span class="c1"># pragma: nocover</span>
<a id="__codelineno-28-270" name="__codelineno-28-270" href="#__codelineno-28-270"></a>                    <span class="s2">&quot;Could not retrieve last ledger_api message&quot;</span>
<a id="__codelineno-28-271" name="__codelineno-28-271" href="#__codelineno-28-271"></a>                <span class="p">)</span>
<a id="__codelineno-28-272" name="__codelineno-28-272" href="#__codelineno-28-272"></a>            <span class="n">fipa_msg</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Optional</span><span class="p">[</span><span class="n">FipaMessage</span><span class="p">],</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">last_incoming_message</span><span class="p">)</span>
<a id="__codelineno-28-273" name="__codelineno-28-273" href="#__codelineno-28-273"></a>            <span class="k">if</span> <span class="n">fipa_msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-274" name="__codelineno-28-274" href="#__codelineno-28-274"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not retrieve last fipa message&quot;</span><span class="p">)</span>
<a id="__codelineno-28-275" name="__codelineno-28-275" href="#__codelineno-28-275"></a>            <span class="n">inform_msg</span> <span class="o">=</span> <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span>
<a id="__codelineno-28-276" name="__codelineno-28-276" href="#__codelineno-28-276"></a>                <span class="n">performative</span><span class="o">=</span><span class="n">FipaMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">INFORM</span><span class="p">,</span>
<a id="__codelineno-28-277" name="__codelineno-28-277" href="#__codelineno-28-277"></a>                <span class="n">target_message</span><span class="o">=</span><span class="n">fipa_msg</span><span class="p">,</span>
<a id="__codelineno-28-278" name="__codelineno-28-278" href="#__codelineno-28-278"></a>                <span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;transaction_digest&quot;</span><span class="p">:</span> <span class="n">ledger_api_msg_</span><span class="o">.</span><span class="n">transaction_digest</span><span class="o">.</span><span class="n">body</span><span class="p">},</span>
<a id="__codelineno-28-279" name="__codelineno-28-279" href="#__codelineno-28-279"></a>            <span class="p">)</span>
<a id="__codelineno-28-280" name="__codelineno-28-280" href="#__codelineno-28-280"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put_message</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">inform_msg</span><span class="p">)</span>
<a id="__codelineno-28-281" name="__codelineno-28-281" href="#__codelineno-28-281"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-28-282" name="__codelineno-28-282" href="#__codelineno-28-282"></a>                <span class="s2">&quot;transaction confirmed, informing counterparty=</span><span class="si">{}</span><span class="s2"> of transaction digest.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-283" name="__codelineno-28-283" href="#__codelineno-28-283"></a>                    <span class="n">fipa_dialogue</span><span class="o">.</span><span class="n">dialogue_label</span><span class="o">.</span><span class="n">dialogue_opponent_addr</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span>
<a id="__codelineno-28-284" name="__codelineno-28-284" href="#__codelineno-28-284"></a>                <span class="p">)</span>
<a id="__codelineno-28-285" name="__codelineno-28-285" href="#__codelineno-28-285"></a>            <span class="p">)</span>
<a id="__codelineno-28-286" name="__codelineno-28-286" href="#__codelineno-28-286"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-28-287" name="__codelineno-28-287" href="#__codelineno-28-287"></a>            <span class="n">tx_behaviour</span><span class="o">.</span><span class="n">failed_processing</span><span class="p">(</span><span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-288" name="__codelineno-28-288" href="#__codelineno-28-288"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-28-289" name="__codelineno-28-289" href="#__codelineno-28-289"></a>                <span class="s2">&quot;transaction_receipt=</span><span class="si">{}</span><span class="s2"> not settled or not valid, aborting&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-290" name="__codelineno-28-290" href="#__codelineno-28-290"></a>                    <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">transaction_receipt</span>
<a id="__codelineno-28-291" name="__codelineno-28-291" href="#__codelineno-28-291"></a>                <span class="p">)</span>
<a id="__codelineno-28-292" name="__codelineno-28-292" href="#__codelineno-28-292"></a>            <span class="p">)</span>
<a id="__codelineno-28-293" name="__codelineno-28-293" href="#__codelineno-28-293"></a>
<a id="__codelineno-28-294" name="__codelineno-28-294" href="#__codelineno-28-294"></a>    <span class="k">def</span> <span class="nf">_handle_error</span><span class="p">(</span>
<a id="__codelineno-28-295" name="__codelineno-28-295" href="#__codelineno-28-295"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span>
<a id="__codelineno-28-296" name="__codelineno-28-296" href="#__codelineno-28-296"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-297" name="__codelineno-28-297" href="#__codelineno-28-297"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-298" name="__codelineno-28-298" href="#__codelineno-28-298"></a><span class="sd">        Handle a message of error performative.</span>
<a id="__codelineno-28-299" name="__codelineno-28-299" href="#__codelineno-28-299"></a>
<a id="__codelineno-28-300" name="__codelineno-28-300" href="#__codelineno-28-300"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-28-301" name="__codelineno-28-301" href="#__codelineno-28-301"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-28-302" name="__codelineno-28-302" href="#__codelineno-28-302"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-303" name="__codelineno-28-303" href="#__codelineno-28-303"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-28-304" name="__codelineno-28-304" href="#__codelineno-28-304"></a>            <span class="s2">&quot;received ledger_api error message=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-305" name="__codelineno-28-305" href="#__codelineno-28-305"></a>                <span class="n">ledger_api_msg</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span>
<a id="__codelineno-28-306" name="__codelineno-28-306" href="#__codelineno-28-306"></a>            <span class="p">)</span>
<a id="__codelineno-28-307" name="__codelineno-28-307" href="#__codelineno-28-307"></a>        <span class="p">)</span>
<a id="__codelineno-28-308" name="__codelineno-28-308" href="#__codelineno-28-308"></a>        <span class="n">ledger_api_msg_</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-28-309" name="__codelineno-28-309" href="#__codelineno-28-309"></a>            <span class="n">Optional</span><span class="p">[</span><span class="n">LedgerApiMessage</span><span class="p">],</span> <span class="n">ledger_api_dialogue</span><span class="o">.</span><span class="n">last_outgoing_message</span>
<a id="__codelineno-28-310" name="__codelineno-28-310" href="#__codelineno-28-310"></a>        <span class="p">)</span>
<a id="__codelineno-28-311" name="__codelineno-28-311" href="#__codelineno-28-311"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-28-312" name="__codelineno-28-312" href="#__codelineno-28-312"></a>            <span class="n">ledger_api_msg_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-28-313" name="__codelineno-28-313" href="#__codelineno-28-313"></a>            <span class="ow">and</span> <span class="n">ledger_api_msg_</span><span class="o">.</span><span class="n">performative</span>
<a id="__codelineno-28-314" name="__codelineno-28-314" href="#__codelineno-28-314"></a>            <span class="o">!=</span> <span class="n">LedgerApiMessage</span><span class="o">.</span><span class="n">Performative</span><span class="o">.</span><span class="n">GET_BALANCE</span>
<a id="__codelineno-28-315" name="__codelineno-28-315" href="#__codelineno-28-315"></a>        <span class="p">):</span>
<a id="__codelineno-28-316" name="__codelineno-28-316" href="#__codelineno-28-316"></a>            <span class="n">tx_behaviour</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
<a id="__codelineno-28-317" name="__codelineno-28-317" href="#__codelineno-28-317"></a>                <span class="n">GenericTransactionBehaviour</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">transaction</span>
<a id="__codelineno-28-318" name="__codelineno-28-318" href="#__codelineno-28-318"></a>            <span class="p">)</span>
<a id="__codelineno-28-319" name="__codelineno-28-319" href="#__codelineno-28-319"></a>            <span class="n">tx_behaviour</span><span class="o">.</span><span class="n">failed_processing</span><span class="p">(</span><span class="n">ledger_api_dialogue</span><span class="p">)</span>
<a id="__codelineno-28-320" name="__codelineno-28-320" href="#__codelineno-28-320"></a>
<a id="__codelineno-28-321" name="__codelineno-28-321" href="#__codelineno-28-321"></a>    <span class="k">def</span> <span class="nf">_handle_invalid</span><span class="p">(</span>
<a id="__codelineno-28-322" name="__codelineno-28-322" href="#__codelineno-28-322"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_msg</span><span class="p">:</span> <span class="n">LedgerApiMessage</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span>
<a id="__codelineno-28-323" name="__codelineno-28-323" href="#__codelineno-28-323"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-28-324" name="__codelineno-28-324" href="#__codelineno-28-324"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-325" name="__codelineno-28-325" href="#__codelineno-28-325"></a><span class="sd">        Handle a message of invalid performative.</span>
<a id="__codelineno-28-326" name="__codelineno-28-326" href="#__codelineno-28-326"></a>
<a id="__codelineno-28-327" name="__codelineno-28-327" href="#__codelineno-28-327"></a><span class="sd">        :param ledger_api_msg: the ledger api message</span>
<a id="__codelineno-28-328" name="__codelineno-28-328" href="#__codelineno-28-328"></a><span class="sd">        :param ledger_api_dialogue: the ledger api dialogue</span>
<a id="__codelineno-28-329" name="__codelineno-28-329" href="#__codelineno-28-329"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-28-330" name="__codelineno-28-330" href="#__codelineno-28-330"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-28-331" name="__codelineno-28-331" href="#__codelineno-28-331"></a>            <span class="s2">&quot;cannot handle ledger_api message of performative=</span><span class="si">{}</span><span class="s2"> in dialogue=</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-28-332" name="__codelineno-28-332" href="#__codelineno-28-332"></a>                <span class="n">ledger_api_msg</span><span class="o">.</span><span class="n">performative</span><span class="p">,</span>
<a id="__codelineno-28-333" name="__codelineno-28-333" href="#__codelineno-28-333"></a>                <span class="n">ledger_api_dialogue</span><span class="p">,</span>
<a id="__codelineno-28-334" name="__codelineno-28-334" href="#__codelineno-28-334"></a>            <span class="p">)</span>
<a id="__codelineno-28-335" name="__codelineno-28-335" href="#__codelineno-28-335"></a>        <span class="p">)</span>
</code></pre></div>
<h3 id="step-4-create-the-strategy_1">Step 4: Create the Strategy<a class="headerlink" href="#step-4-create-the-strategy_1" title="Permanent link">&para;</a></h3>
<p>We are going to create the strategy that we want our AEA to follow. Rename the <code>my_model.py</code> file (in <code>my_generic_buyer/skills/generic_buyer/</code>) to <code>strategy.py</code> and replace the stub code with the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="kn">from</span> <span class="nn">aea.common</span> <span class="kn">import</span> <span class="n">Address</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="kn">from</span> <span class="nn">aea.exceptions</span> <span class="kn">import</span> <span class="n">enforce</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="kn">from</span> <span class="nn">aea.helpers.search.generic</span> <span class="kn">import</span> <span class="n">SIMPLE_SERVICE_MODEL</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="kn">from</span> <span class="nn">aea.helpers.search.models</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    <span class="n">Constraint</span><span class="p">,</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>    <span class="n">ConstraintType</span><span class="p">,</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    <span class="n">Description</span><span class="p">,</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    <span class="n">Location</span><span class="p">,</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>    <span class="n">Query</span><span class="p">,</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="p">)</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="kn">from</span> <span class="nn">aea.helpers.transaction.base</span> <span class="kn">import</span> <span class="n">Terms</span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="kn">from</span> <span class="nn">aea.skills.base</span> <span class="kn">import</span> <span class="n">Model</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="n">DEFAULT_IS_LEDGER_TX</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="n">DEFAULT_MAX_UNIT_PRICE</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="n">DEFAULT_MAX_TX_FEE</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="n">DEFAULT_SERVICE_ID</span> <span class="o">=</span> <span class="s2">&quot;generic_service&quot;</span>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="n">DEFAULT_MIN_QUANTITY</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="n">DEFAULT_MAX_QUANTITY</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="n">DEFAULT_LOCATION</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="mf">0.1270</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="mf">51.5194</span><span class="p">}</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="n">DEFAULT_SEARCH_QUERY</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a>    <span class="s2">&quot;search_key&quot;</span><span class="p">:</span> <span class="s2">&quot;seller_service&quot;</span><span class="p">,</span>
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a>    <span class="s2">&quot;search_value&quot;</span><span class="p">:</span> <span class="s2">&quot;generic_service&quot;</span><span class="p">,</span>
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>    <span class="s2">&quot;constraint_type&quot;</span><span class="p">:</span> <span class="s2">&quot;==&quot;</span><span class="p">,</span>
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="p">}</span>
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a><span class="n">DEFAULT_SEARCH_RADIUS</span> <span class="o">=</span> <span class="mf">5.0</span>
<a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a>
<a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a><span class="n">DEFAULT_MAX_NEGOTIATIONS</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a>
<a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a>
<a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a><span class="k">class</span> <span class="nc">GenericStrategy</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class defines a strategy for the agent.&quot;&quot;&quot;</span>
<a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a>
<a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a><span class="sd">        Initialize the strategy of the agent.</span>
<a id="__codelineno-29-42" name="__codelineno-29-42" href="#__codelineno-29-42"></a>
<a id="__codelineno-29-43" name="__codelineno-29-43" href="#__codelineno-29-43"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-29-44" name="__codelineno-29-44" href="#__codelineno-29-44"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-29-45" name="__codelineno-29-45" href="#__codelineno-29-45"></a>        <span class="n">ledger_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ledger_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-29-46" name="__codelineno-29-46" href="#__codelineno-29-46"></a>        <span class="n">currency_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;currency_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-29-47" name="__codelineno-29-47" href="#__codelineno-29-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_ledger_tx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;is_ledger_tx&quot;</span><span class="p">,</span> <span class="n">DEFAULT_IS_LEDGER_TX</span><span class="p">)</span>
<a id="__codelineno-29-48" name="__codelineno-29-48" href="#__codelineno-29-48"></a>
<a id="__codelineno-29-49" name="__codelineno-29-49" href="#__codelineno-29-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_unit_price</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;max_unit_price&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MAX_UNIT_PRICE</span><span class="p">)</span>
<a id="__codelineno-29-50" name="__codelineno-29-50" href="#__codelineno-29-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_min_quantity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;min_quantity&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MIN_QUANTITY</span><span class="p">)</span>
<a id="__codelineno-29-51" name="__codelineno-29-51" href="#__codelineno-29-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_quantity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;max_quantity&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MAX_QUANTITY</span><span class="p">)</span>
<a id="__codelineno-29-52" name="__codelineno-29-52" href="#__codelineno-29-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_tx_fee</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;max_tx_fee&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MAX_TX_FEE</span><span class="p">)</span>
<a id="__codelineno-29-53" name="__codelineno-29-53" href="#__codelineno-29-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_service_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;service_id&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVICE_ID</span><span class="p">)</span>
<a id="__codelineno-29-54" name="__codelineno-29-54" href="#__codelineno-29-54"></a>
<a id="__codelineno-29-55" name="__codelineno-29-55" href="#__codelineno-29-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_search_query</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;search_query&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SEARCH_QUERY</span><span class="p">)</span>
<a id="__codelineno-29-56" name="__codelineno-29-56" href="#__codelineno-29-56"></a>        <span class="n">location</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">DEFAULT_LOCATION</span><span class="p">)</span>
<a id="__codelineno-29-57" name="__codelineno-29-57" href="#__codelineno-29-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_location</span> <span class="o">=</span> <span class="n">Location</span><span class="p">(</span>
<a id="__codelineno-29-58" name="__codelineno-29-58" href="#__codelineno-29-58"></a>            <span class="n">latitude</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="n">longitude</span><span class="o">=</span><span class="n">location</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span>
<a id="__codelineno-29-59" name="__codelineno-29-59" href="#__codelineno-29-59"></a>        <span class="p">)</span>
<a id="__codelineno-29-60" name="__codelineno-29-60" href="#__codelineno-29-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;search_radius&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SEARCH_RADIUS</span><span class="p">)</span>
<a id="__codelineno-29-61" name="__codelineno-29-61" href="#__codelineno-29-61"></a>
<a id="__codelineno-29-62" name="__codelineno-29-62" href="#__codelineno-29-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_negotiations</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
<a id="__codelineno-29-63" name="__codelineno-29-63" href="#__codelineno-29-63"></a>            <span class="s2">&quot;max_negotiations&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MAX_NEGOTIATIONS</span>
<a id="__codelineno-29-64" name="__codelineno-29-64" href="#__codelineno-29-64"></a>        <span class="p">)</span>
<a id="__codelineno-29-65" name="__codelineno-29-65" href="#__codelineno-29-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_stop_searching_on_result</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stop_searching_on_result&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-29-66" name="__codelineno-29-66" href="#__codelineno-29-66"></a>
<a id="__codelineno-29-67" name="__codelineno-29-67" href="#__codelineno-29-67"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-29-68" name="__codelineno-29-68" href="#__codelineno-29-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ledger_id</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-29-69" name="__codelineno-29-69" href="#__codelineno-29-69"></a>            <span class="n">ledger_id</span> <span class="k">if</span> <span class="n">ledger_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">default_ledger_id</span>
<a id="__codelineno-29-70" name="__codelineno-29-70" href="#__codelineno-29-70"></a>        <span class="p">)</span>
<a id="__codelineno-29-71" name="__codelineno-29-71" href="#__codelineno-29-71"></a>        <span class="k">if</span> <span class="n">currency_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-29-72" name="__codelineno-29-72" href="#__codelineno-29-72"></a>            <span class="n">currency_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">currency_denominations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ledger_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-29-73" name="__codelineno-29-73" href="#__codelineno-29-73"></a>            <span class="n">enforce</span><span class="p">(</span>
<a id="__codelineno-29-74" name="__codelineno-29-74" href="#__codelineno-29-74"></a>                <span class="n">currency_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-29-75" name="__codelineno-29-75" href="#__codelineno-29-75"></a>                <span class="sa">f</span><span class="s2">&quot;Currency denomination for ledger_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ledger_id</span><span class="si">}</span><span class="s2"> not specified.&quot;</span><span class="p">,</span>
<a id="__codelineno-29-76" name="__codelineno-29-76" href="#__codelineno-29-76"></a>            <span class="p">)</span>
<a id="__codelineno-29-77" name="__codelineno-29-77" href="#__codelineno-29-77"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_currency_id</span> <span class="o">=</span> <span class="n">currency_id</span>
<a id="__codelineno-29-78" name="__codelineno-29-78" href="#__codelineno-29-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_searching</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-29-79" name="__codelineno-29-79" href="#__codelineno-29-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_balance</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>
<p>Similar to the seller AEA, we initialize the strategy class by trying to read the strategy variables from the YAML file, and if not possible, use some default values. In the following snippet, the two methods after the properties are related to the OEF search service. Add this snippet under the initialization of the strategy class:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>    <span class="nd">@property</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>    <span class="k">def</span> <span class="nf">ledger_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ledger id.&quot;&quot;&quot;</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ledger_id</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    <span class="nd">@property</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>    <span class="k">def</span> <span class="nf">is_ledger_tx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether or not tx are settled on a ledger.&quot;&quot;&quot;</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_ledger_tx</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>    <span class="nd">@property</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>    <span class="k">def</span> <span class="nf">is_stop_searching_on_result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if search is stopped on result.&quot;&quot;&quot;</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_stop_searching_on_result</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>    <span class="nd">@property</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>    <span class="k">def</span> <span class="nf">is_searching</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the agent is searching.&quot;&quot;&quot;</span>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_searching</span>
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>    <span class="nd">@is_searching</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>    <span class="k">def</span> <span class="nf">is_searching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_searching</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the agent is searching.&quot;&quot;&quot;</span>
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>        <span class="n">enforce</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">is_searching</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="s2">&quot;Can only set bool on is_searching!&quot;</span><span class="p">)</span>
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_searching</span> <span class="o">=</span> <span class="n">is_searching</span>
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a>
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a>    <span class="nd">@property</span>
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>    <span class="k">def</span> <span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the balance.&quot;&quot;&quot;</span>
<a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_balance</span>
<a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a>
<a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a>    <span class="nd">@balance</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a>    <span class="k">def</span> <span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">balance</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the balance.&quot;&quot;&quot;</span>
<a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_balance</span> <span class="o">=</span> <span class="n">balance</span>
<a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a>
<a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a>    <span class="nd">@property</span>
<a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a>    <span class="k">def</span> <span class="nf">max_negotiations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the maximum number of negotiations the agent can start.&quot;&quot;&quot;</span>
<a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_negotiations</span>
<a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a>
<a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a>    <span class="k">def</span> <span class="nf">get_location_and_service_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
<a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a><span class="sd">        Get the location and service query of the agent.</span>
<a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a>
<a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a><span class="sd">        :return: the query</span>
<a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a>        <span class="n">close_to_my_service</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
<a id="__codelineno-30-49" name="__codelineno-30-49" href="#__codelineno-30-49"></a>            <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">ConstraintType</span><span class="p">(</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span><span class="p">))</span>
<a id="__codelineno-30-50" name="__codelineno-30-50" href="#__codelineno-30-50"></a>        <span class="p">)</span>
<a id="__codelineno-30-51" name="__codelineno-30-51" href="#__codelineno-30-51"></a>        <span class="n">service_key_filter</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
<a id="__codelineno-30-52" name="__codelineno-30-52" href="#__codelineno-30-52"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_search_query</span><span class="p">[</span><span class="s2">&quot;search_key&quot;</span><span class="p">],</span>
<a id="__codelineno-30-53" name="__codelineno-30-53" href="#__codelineno-30-53"></a>            <span class="n">ConstraintType</span><span class="p">(</span>
<a id="__codelineno-30-54" name="__codelineno-30-54" href="#__codelineno-30-54"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_search_query</span><span class="p">[</span><span class="s2">&quot;constraint_type&quot;</span><span class="p">],</span>
<a id="__codelineno-30-55" name="__codelineno-30-55" href="#__codelineno-30-55"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_search_query</span><span class="p">[</span><span class="s2">&quot;search_value&quot;</span><span class="p">],</span>
<a id="__codelineno-30-56" name="__codelineno-30-56" href="#__codelineno-30-56"></a>            <span class="p">),</span>
<a id="__codelineno-30-57" name="__codelineno-30-57" href="#__codelineno-30-57"></a>        <span class="p">)</span>
<a id="__codelineno-30-58" name="__codelineno-30-58" href="#__codelineno-30-58"></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span>
<a id="__codelineno-30-59" name="__codelineno-30-59" href="#__codelineno-30-59"></a>            <span class="p">[</span><span class="n">close_to_my_service</span><span class="p">,</span> <span class="n">service_key_filter</span><span class="p">],</span>
<a id="__codelineno-30-60" name="__codelineno-30-60" href="#__codelineno-30-60"></a>        <span class="p">)</span>
<a id="__codelineno-30-61" name="__codelineno-30-61" href="#__codelineno-30-61"></a>        <span class="k">return</span> <span class="n">query</span>
<a id="__codelineno-30-62" name="__codelineno-30-62" href="#__codelineno-30-62"></a>
<a id="__codelineno-30-63" name="__codelineno-30-63" href="#__codelineno-30-63"></a>    <span class="k">def</span> <span class="nf">get_service_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Query</span><span class="p">:</span>
<a id="__codelineno-30-64" name="__codelineno-30-64" href="#__codelineno-30-64"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-30-65" name="__codelineno-30-65" href="#__codelineno-30-65"></a><span class="sd">        Get the service query of the agent.</span>
<a id="__codelineno-30-66" name="__codelineno-30-66" href="#__codelineno-30-66"></a>
<a id="__codelineno-30-67" name="__codelineno-30-67" href="#__codelineno-30-67"></a><span class="sd">        :return: the query</span>
<a id="__codelineno-30-68" name="__codelineno-30-68" href="#__codelineno-30-68"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-30-69" name="__codelineno-30-69" href="#__codelineno-30-69"></a>        <span class="n">service_key_filter</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
<a id="__codelineno-30-70" name="__codelineno-30-70" href="#__codelineno-30-70"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_search_query</span><span class="p">[</span><span class="s2">&quot;search_key&quot;</span><span class="p">],</span>
<a id="__codelineno-30-71" name="__codelineno-30-71" href="#__codelineno-30-71"></a>            <span class="n">ConstraintType</span><span class="p">(</span>
<a id="__codelineno-30-72" name="__codelineno-30-72" href="#__codelineno-30-72"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_search_query</span><span class="p">[</span><span class="s2">&quot;constraint_type&quot;</span><span class="p">],</span>
<a id="__codelineno-30-73" name="__codelineno-30-73" href="#__codelineno-30-73"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_search_query</span><span class="p">[</span><span class="s2">&quot;search_value&quot;</span><span class="p">],</span>
<a id="__codelineno-30-74" name="__codelineno-30-74" href="#__codelineno-30-74"></a>            <span class="p">),</span>
<a id="__codelineno-30-75" name="__codelineno-30-75" href="#__codelineno-30-75"></a>        <span class="p">)</span>
<a id="__codelineno-30-76" name="__codelineno-30-76" href="#__codelineno-30-76"></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">([</span><span class="n">service_key_filter</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">SIMPLE_SERVICE_MODEL</span><span class="p">)</span>
<a id="__codelineno-30-77" name="__codelineno-30-77" href="#__codelineno-30-77"></a>        <span class="k">return</span> <span class="n">query</span>
</code></pre></div>
<p>The following code block checks if the proposal that we received is acceptable according to a strategy:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>    <span class="k">def</span> <span class="nf">is_acceptable_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposal</span><span class="p">:</span> <span class="n">Description</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="sd">        Check whether it is an acceptable proposal.</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="sd">        :param proposal: a description</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="sd">        :return: whether it is acceptable</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>            <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>                <span class="n">key</span> <span class="ow">in</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>                    <span class="s2">&quot;ledger_id&quot;</span><span class="p">,</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>                    <span class="s2">&quot;currency_id&quot;</span><span class="p">,</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>                    <span class="s2">&quot;price&quot;</span><span class="p">,</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>                    <span class="s2">&quot;service_id&quot;</span><span class="p">,</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>                    <span class="s2">&quot;quantity&quot;</span><span class="p">,</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>                    <span class="s2">&quot;tx_nonce&quot;</span><span class="p">,</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>                <span class="p">]</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>            <span class="p">)</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>            <span class="ow">and</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;ledger_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ledger_id</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>            <span class="ow">and</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>            <span class="ow">and</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_quantity</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>            <span class="ow">and</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_quantity</span>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>            <span class="ow">and</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>            <span class="o">&lt;=</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_unit_price</span>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>            <span class="ow">and</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;currency_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currency_id</span>
<a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>            <span class="ow">and</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;service_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_service_id</span>
<a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;tx_nonce&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span>
<a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a>            <span class="ow">and</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;tx_nonce&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>        <span class="p">)</span>
<a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
<p>The <code>is_affordable_proposal</code> method in the following code block checks if we can afford the transaction based on the funds we have in our wallet on the ledger. The rest of the methods are self-explanatory.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>    <span class="k">def</span> <span class="nf">is_affordable_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposal</span><span class="p">:</span> <span class="n">Description</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="sd">        Check whether it is an affordable proposal.</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="sd">        :param proposal: a description</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="sd">        :return: whether it is affordable</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ledger_tx</span><span class="p">:</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>            <span class="n">payable</span> <span class="o">=</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_tx_fee</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">&gt;=</span> <span class="n">payable</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>            <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>    <span class="k">def</span> <span class="nf">get_acceptable_counterparties</span><span class="p">(</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">counterparties</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="sd">        Process counterparties and drop unacceptable ones.</span>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="sd">        :param counterparties: a tuple of counterparties</span>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="sd">        :return: list of counterparties</span>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a>        <span class="n">valid_counterparties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">counterparty</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">counterparties</span><span class="p">):</span>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a>            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_negotiations</span><span class="p">:</span>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a>                <span class="n">valid_counterparties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counterparty</span><span class="p">)</span>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">valid_counterparties</span><span class="p">)</span>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a>
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a>    <span class="k">def</span> <span class="nf">terms_from_proposal</span><span class="p">(</span>
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">proposal</span><span class="p">:</span> <span class="n">Description</span><span class="p">,</span> <span class="n">counterparty_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Terms</span><span class="p">:</span>
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a><span class="sd">        Get the terms from a proposal.</span>
<a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a>
<a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a><span class="sd">        :param proposal: the proposal</span>
<a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a><span class="sd">        :param counterparty_address: the counterparty</span>
<a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a><span class="sd">        :return: terms</span>
<a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a>        <span class="n">buyer_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_addresses</span><span class="p">[</span><span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;ledger_id&quot;</span><span class="p">]]</span>
<a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a>        <span class="n">terms</span> <span class="o">=</span> <span class="n">Terms</span><span class="p">(</span>
<a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a>            <span class="n">ledger_id</span><span class="o">=</span><span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;ledger_id&quot;</span><span class="p">],</span>
<a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a>            <span class="n">sender_address</span><span class="o">=</span><span class="n">buyer_address</span><span class="p">,</span>
<a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a>            <span class="n">counterparty_address</span><span class="o">=</span><span class="n">counterparty_address</span><span class="p">,</span>
<a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a>            <span class="n">amount_by_currency_id</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-32-46" name="__codelineno-32-46" href="#__codelineno-32-46"></a>                <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;currency_id&quot;</span><span class="p">]:</span> <span class="o">-</span><span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span>
<a id="__codelineno-32-47" name="__codelineno-32-47" href="#__codelineno-32-47"></a>            <span class="p">},</span>
<a id="__codelineno-32-48" name="__codelineno-32-48" href="#__codelineno-32-48"></a>            <span class="n">quantities_by_good_id</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-32-49" name="__codelineno-32-49" href="#__codelineno-32-49"></a>                <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;service_id&quot;</span><span class="p">]:</span> <span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">]</span>
<a id="__codelineno-32-50" name="__codelineno-32-50" href="#__codelineno-32-50"></a>            <span class="p">},</span>
<a id="__codelineno-32-51" name="__codelineno-32-51" href="#__codelineno-32-51"></a>            <span class="n">is_sender_payable_tx_fee</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-32-52" name="__codelineno-32-52" href="#__codelineno-32-52"></a>            <span class="n">nonce</span><span class="o">=</span><span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;tx_nonce&quot;</span><span class="p">],</span>
<a id="__codelineno-32-53" name="__codelineno-32-53" href="#__codelineno-32-53"></a>            <span class="n">fee_by_currency_id</span><span class="o">=</span><span class="p">{</span><span class="n">proposal</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;currency_id&quot;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_tx_fee</span><span class="p">},</span>
<a id="__codelineno-32-54" name="__codelineno-32-54" href="#__codelineno-32-54"></a>        <span class="p">)</span>
<a id="__codelineno-32-55" name="__codelineno-32-55" href="#__codelineno-32-55"></a>        <span class="k">return</span> <span class="n">terms</span>
<a id="__codelineno-32-56" name="__codelineno-32-56" href="#__codelineno-32-56"></a>
<a id="__codelineno-32-57" name="__codelineno-32-57" href="#__codelineno-32-57"></a>    <span class="k">def</span> <span class="nf">successful_trade_with_counterparty</span><span class="p">(</span>
<a id="__codelineno-32-58" name="__codelineno-32-58" href="#__codelineno-32-58"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">counterparty</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<a id="__codelineno-32-59" name="__codelineno-32-59" href="#__codelineno-32-59"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-32-60" name="__codelineno-32-60" href="#__codelineno-32-60"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-32-61" name="__codelineno-32-61" href="#__codelineno-32-61"></a><span class="sd">        Do something on successful trade.</span>
<a id="__codelineno-32-62" name="__codelineno-32-62" href="#__codelineno-32-62"></a>
<a id="__codelineno-32-63" name="__codelineno-32-63" href="#__codelineno-32-63"></a><span class="sd">        :param counterparty: the counterparty address</span>
<a id="__codelineno-32-64" name="__codelineno-32-64" href="#__codelineno-32-64"></a><span class="sd">        :param data: the data</span>
<a id="__codelineno-32-65" name="__codelineno-32-65" href="#__codelineno-32-65"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-32-66" name="__codelineno-32-66" href="#__codelineno-32-66"></a>
<a id="__codelineno-32-67" name="__codelineno-32-67" href="#__codelineno-32-67"></a>    <span class="k">def</span> <span class="nf">update_search_query_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-32-68" name="__codelineno-32-68" href="#__codelineno-32-68"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update agent location and query for search.&quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="step-5-create-the-dialogues_1">Step 5: Create the Dialogues<a class="headerlink" href="#step-5-create-the-dialogues_1" title="Permanent link">&para;</a></h3>
<p>As mentioned during the creation of the seller AEA, we should keep track of the various interactions an AEA has with others and this is done via dialogues. Create a new file and name it <code>dialogues.py</code> (in <code>my_generic_buyer/skills/generic_buyer/</code>). Inside this file add the following code:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="kn">from</span> <span class="nn">aea.common</span> <span class="kn">import</span> <span class="n">Address</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="kn">from</span> <span class="nn">aea.exceptions</span> <span class="kn">import</span> <span class="n">AEAEnforceError</span><span class="p">,</span> <span class="n">enforce</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="kn">from</span> <span class="nn">aea.helpers.transaction.base</span> <span class="kn">import</span> <span class="n">Terms</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="kn">from</span> <span class="nn">aea.protocols.base</span> <span class="kn">import</span> <span class="n">Message</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="kn">from</span> <span class="nn">aea.protocols.dialogue.base</span> <span class="kn">import</span> <span class="n">Dialogue</span> <span class="k">as</span> <span class="n">BaseDialogue</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="kn">from</span> <span class="nn">aea.protocols.dialogue.base</span> <span class="kn">import</span> <span class="n">DialogueLabel</span> <span class="k">as</span> <span class="n">BaseDialogueLabel</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="kn">from</span> <span class="nn">aea.skills.base</span> <span class="kn">import</span> <span class="n">Model</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.default.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>    <span class="n">DefaultDialogue</span> <span class="k">as</span> <span class="n">BaseDefaultDialogue</span><span class="p">,</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="p">)</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.default.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>    <span class="n">DefaultDialogues</span> <span class="k">as</span> <span class="n">BaseDefaultDialogues</span><span class="p">,</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="p">)</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.fipa.dialogues</span> <span class="kn">import</span> <span class="n">FipaDialogue</span> <span class="k">as</span> <span class="n">BaseFipaDialogue</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.fipa.dialogues</span> <span class="kn">import</span> <span class="n">FipaDialogues</span> <span class="k">as</span> <span class="n">BaseFipaDialogues</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.fipa.message</span> <span class="kn">import</span> <span class="n">FipaMessage</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>    <span class="n">LedgerApiDialogue</span> <span class="k">as</span> <span class="n">BaseLedgerApiDialogue</span><span class="p">,</span>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="p">)</span>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a>    <span class="n">LedgerApiDialogues</span> <span class="k">as</span> <span class="n">BaseLedgerApiDialogues</span><span class="p">,</span>
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="p">)</span>
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.ledger_api.message</span> <span class="kn">import</span> <span class="n">LedgerApiMessage</span>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.oef_search.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a>    <span class="n">OefSearchDialogue</span> <span class="k">as</span> <span class="n">BaseOefSearchDialogue</span><span class="p">,</span>
<a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="p">)</span>
<a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.oef_search.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a>    <span class="n">OefSearchDialogues</span> <span class="k">as</span> <span class="n">BaseOefSearchDialogues</span><span class="p">,</span>
<a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a><span class="p">)</span>
<a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.signing.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a>    <span class="n">SigningDialogue</span> <span class="k">as</span> <span class="n">BaseSigningDialogue</span><span class="p">,</span>
<a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a><span class="p">)</span>
<a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.signing.dialogues</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-33-37" name="__codelineno-33-37" href="#__codelineno-33-37"></a>    <span class="n">SigningDialogues</span> <span class="k">as</span> <span class="n">BaseSigningDialogues</span><span class="p">,</span>
<a id="__codelineno-33-38" name="__codelineno-33-38" href="#__codelineno-33-38"></a><span class="p">)</span>
<a id="__codelineno-33-39" name="__codelineno-33-39" href="#__codelineno-33-39"></a><span class="kn">from</span> <span class="nn">packages.fetchai.protocols.signing.message</span> <span class="kn">import</span> <span class="n">SigningMessage</span>
<a id="__codelineno-33-40" name="__codelineno-33-40" href="#__codelineno-33-40"></a>
<a id="__codelineno-33-41" name="__codelineno-33-41" href="#__codelineno-33-41"></a>
<a id="__codelineno-33-42" name="__codelineno-33-42" href="#__codelineno-33-42"></a><span class="n">DefaultDialogue</span> <span class="o">=</span> <span class="n">BaseDefaultDialogue</span>
<a id="__codelineno-33-43" name="__codelineno-33-43" href="#__codelineno-33-43"></a>
<a id="__codelineno-33-44" name="__codelineno-33-44" href="#__codelineno-33-44"></a>
<a id="__codelineno-33-45" name="__codelineno-33-45" href="#__codelineno-33-45"></a><span class="k">class</span> <span class="nc">DefaultDialogues</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">BaseDefaultDialogues</span><span class="p">):</span>
<a id="__codelineno-33-46" name="__codelineno-33-46" href="#__codelineno-33-46"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogues class keeps track of all dialogues.&quot;&quot;&quot;</span>
<a id="__codelineno-33-47" name="__codelineno-33-47" href="#__codelineno-33-47"></a>
<a id="__codelineno-33-48" name="__codelineno-33-48" href="#__codelineno-33-48"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-49" name="__codelineno-33-49" href="#__codelineno-33-49"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-50" name="__codelineno-33-50" href="#__codelineno-33-50"></a><span class="sd">        Initialize dialogues.</span>
<a id="__codelineno-33-51" name="__codelineno-33-51" href="#__codelineno-33-51"></a>
<a id="__codelineno-33-52" name="__codelineno-33-52" href="#__codelineno-33-52"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-33-53" name="__codelineno-33-53" href="#__codelineno-33-53"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-33-54" name="__codelineno-33-54" href="#__codelineno-33-54"></a>        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-33-55" name="__codelineno-33-55" href="#__codelineno-33-55"></a>
<a id="__codelineno-33-56" name="__codelineno-33-56" href="#__codelineno-33-56"></a>        <span class="k">def</span> <span class="nf">role_from_first_message</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-33-57" name="__codelineno-33-57" href="#__codelineno-33-57"></a>            <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">receiver_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-33-58" name="__codelineno-33-58" href="#__codelineno-33-58"></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">:</span>
<a id="__codelineno-33-59" name="__codelineno-33-59" href="#__codelineno-33-59"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Infer the role of the agent from an incoming/outgoing first message</span>
<a id="__codelineno-33-60" name="__codelineno-33-60" href="#__codelineno-33-60"></a>
<a id="__codelineno-33-61" name="__codelineno-33-61" href="#__codelineno-33-61"></a><span class="sd">            :param message: an incoming/outgoing first message</span>
<a id="__codelineno-33-62" name="__codelineno-33-62" href="#__codelineno-33-62"></a><span class="sd">            :param receiver_address: the address of the receiving agent</span>
<a id="__codelineno-33-63" name="__codelineno-33-63" href="#__codelineno-33-63"></a><span class="sd">            :return: The role of the agent</span>
<a id="__codelineno-33-64" name="__codelineno-33-64" href="#__codelineno-33-64"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-33-65" name="__codelineno-33-65" href="#__codelineno-33-65"></a>            <span class="k">return</span> <span class="n">DefaultDialogue</span><span class="o">.</span><span class="n">Role</span><span class="o">.</span><span class="n">AGENT</span>
<a id="__codelineno-33-66" name="__codelineno-33-66" href="#__codelineno-33-66"></a>
<a id="__codelineno-33-67" name="__codelineno-33-67" href="#__codelineno-33-67"></a>        <span class="n">BaseDefaultDialogues</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-68" name="__codelineno-33-68" href="#__codelineno-33-68"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-69" name="__codelineno-33-69" href="#__codelineno-33-69"></a>            <span class="n">self_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_address</span><span class="p">,</span>
<a id="__codelineno-33-70" name="__codelineno-33-70" href="#__codelineno-33-70"></a>            <span class="n">role_from_first_message</span><span class="o">=</span><span class="n">role_from_first_message</span><span class="p">,</span>
<a id="__codelineno-33-71" name="__codelineno-33-71" href="#__codelineno-33-71"></a>        <span class="p">)</span>
<a id="__codelineno-33-72" name="__codelineno-33-72" href="#__codelineno-33-72"></a>
<a id="__codelineno-33-73" name="__codelineno-33-73" href="#__codelineno-33-73"></a>
<a id="__codelineno-33-74" name="__codelineno-33-74" href="#__codelineno-33-74"></a><span class="k">class</span> <span class="nc">FipaDialogue</span><span class="p">(</span><span class="n">BaseFipaDialogue</span><span class="p">):</span>
<a id="__codelineno-33-75" name="__codelineno-33-75" href="#__codelineno-33-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogue class maintains state of a dialogue and manages it.&quot;&quot;&quot;</span>
<a id="__codelineno-33-76" name="__codelineno-33-76" href="#__codelineno-33-76"></a>
<a id="__codelineno-33-77" name="__codelineno-33-77" href="#__codelineno-33-77"></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-33-78" name="__codelineno-33-78" href="#__codelineno-33-78"></a>        <span class="s2">&quot;_terms&quot;</span><span class="p">,</span>
<a id="__codelineno-33-79" name="__codelineno-33-79" href="#__codelineno-33-79"></a>        <span class="s2">&quot;_associated_ledger_api_dialogue&quot;</span><span class="p">,</span>
<a id="__codelineno-33-80" name="__codelineno-33-80" href="#__codelineno-33-80"></a>    <span class="p">)</span>
<a id="__codelineno-33-81" name="__codelineno-33-81" href="#__codelineno-33-81"></a>
<a id="__codelineno-33-82" name="__codelineno-33-82" href="#__codelineno-33-82"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-83" name="__codelineno-33-83" href="#__codelineno-33-83"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-84" name="__codelineno-33-84" href="#__codelineno-33-84"></a>        <span class="n">dialogue_label</span><span class="p">:</span> <span class="n">BaseDialogueLabel</span><span class="p">,</span>
<a id="__codelineno-33-85" name="__codelineno-33-85" href="#__codelineno-33-85"></a>        <span class="n">self_address</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
<a id="__codelineno-33-86" name="__codelineno-33-86" href="#__codelineno-33-86"></a>        <span class="n">role</span><span class="p">:</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">,</span>
<a id="__codelineno-33-87" name="__codelineno-33-87" href="#__codelineno-33-87"></a>        <span class="n">message_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">FipaMessage</span><span class="p">]</span> <span class="o">=</span> <span class="n">FipaMessage</span><span class="p">,</span>
<a id="__codelineno-33-88" name="__codelineno-33-88" href="#__codelineno-33-88"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-89" name="__codelineno-33-89" href="#__codelineno-33-89"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-90" name="__codelineno-33-90" href="#__codelineno-33-90"></a><span class="sd">        Initialize a dialogue.</span>
<a id="__codelineno-33-91" name="__codelineno-33-91" href="#__codelineno-33-91"></a>
<a id="__codelineno-33-92" name="__codelineno-33-92" href="#__codelineno-33-92"></a><span class="sd">        :param dialogue_label: the identifier of the dialogue</span>
<a id="__codelineno-33-93" name="__codelineno-33-93" href="#__codelineno-33-93"></a><span class="sd">        :param self_address: the address of the entity for whom this dialogue is maintained</span>
<a id="__codelineno-33-94" name="__codelineno-33-94" href="#__codelineno-33-94"></a><span class="sd">        :param role: the role of the agent this dialogue is maintained for</span>
<a id="__codelineno-33-95" name="__codelineno-33-95" href="#__codelineno-33-95"></a><span class="sd">        :param message_class: the message class</span>
<a id="__codelineno-33-96" name="__codelineno-33-96" href="#__codelineno-33-96"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-33-97" name="__codelineno-33-97" href="#__codelineno-33-97"></a>        <span class="n">BaseFipaDialogue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-98" name="__codelineno-33-98" href="#__codelineno-33-98"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-99" name="__codelineno-33-99" href="#__codelineno-33-99"></a>            <span class="n">dialogue_label</span><span class="o">=</span><span class="n">dialogue_label</span><span class="p">,</span>
<a id="__codelineno-33-100" name="__codelineno-33-100" href="#__codelineno-33-100"></a>            <span class="n">self_address</span><span class="o">=</span><span class="n">self_address</span><span class="p">,</span>
<a id="__codelineno-33-101" name="__codelineno-33-101" href="#__codelineno-33-101"></a>            <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
<a id="__codelineno-33-102" name="__codelineno-33-102" href="#__codelineno-33-102"></a>            <span class="n">message_class</span><span class="o">=</span><span class="n">message_class</span><span class="p">,</span>
<a id="__codelineno-33-103" name="__codelineno-33-103" href="#__codelineno-33-103"></a>        <span class="p">)</span>
<a id="__codelineno-33-104" name="__codelineno-33-104" href="#__codelineno-33-104"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[Terms]</span>
<a id="__codelineno-33-105" name="__codelineno-33-105" href="#__codelineno-33-105"></a>
<a id="__codelineno-33-106" name="__codelineno-33-106" href="#__codelineno-33-106"></a>    <span class="nd">@property</span>
<a id="__codelineno-33-107" name="__codelineno-33-107" href="#__codelineno-33-107"></a>    <span class="k">def</span> <span class="nf">terms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Terms</span><span class="p">:</span>
<a id="__codelineno-33-108" name="__codelineno-33-108" href="#__codelineno-33-108"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get terms.&quot;&quot;&quot;</span>
<a id="__codelineno-33-109" name="__codelineno-33-109" href="#__codelineno-33-109"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-110" name="__codelineno-33-110" href="#__codelineno-33-110"></a>            <span class="k">raise</span> <span class="n">AEAEnforceError</span><span class="p">(</span><span class="s2">&quot;Terms not set!&quot;</span><span class="p">)</span>
<a id="__codelineno-33-111" name="__codelineno-33-111" href="#__codelineno-33-111"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span>
<a id="__codelineno-33-112" name="__codelineno-33-112" href="#__codelineno-33-112"></a>
<a id="__codelineno-33-113" name="__codelineno-33-113" href="#__codelineno-33-113"></a>    <span class="nd">@terms</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-33-114" name="__codelineno-33-114" href="#__codelineno-33-114"></a>    <span class="k">def</span> <span class="nf">terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="n">Terms</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-115" name="__codelineno-33-115" href="#__codelineno-33-115"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set terms.&quot;&quot;&quot;</span>
<a id="__codelineno-33-116" name="__codelineno-33-116" href="#__codelineno-33-116"></a>        <span class="n">enforce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Terms already set!&quot;</span><span class="p">)</span>
<a id="__codelineno-33-117" name="__codelineno-33-117" href="#__codelineno-33-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_terms</span> <span class="o">=</span> <span class="n">terms</span>
<a id="__codelineno-33-118" name="__codelineno-33-118" href="#__codelineno-33-118"></a>
<a id="__codelineno-33-119" name="__codelineno-33-119" href="#__codelineno-33-119"></a>
<a id="__codelineno-33-120" name="__codelineno-33-120" href="#__codelineno-33-120"></a><span class="k">class</span> <span class="nc">FipaDialogues</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">BaseFipaDialogues</span><span class="p">):</span>
<a id="__codelineno-33-121" name="__codelineno-33-121" href="#__codelineno-33-121"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogues class keeps track of all dialogues.&quot;&quot;&quot;</span>
<a id="__codelineno-33-122" name="__codelineno-33-122" href="#__codelineno-33-122"></a>
<a id="__codelineno-33-123" name="__codelineno-33-123" href="#__codelineno-33-123"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-124" name="__codelineno-33-124" href="#__codelineno-33-124"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-125" name="__codelineno-33-125" href="#__codelineno-33-125"></a><span class="sd">        Initialize dialogues.</span>
<a id="__codelineno-33-126" name="__codelineno-33-126" href="#__codelineno-33-126"></a>
<a id="__codelineno-33-127" name="__codelineno-33-127" href="#__codelineno-33-127"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-33-128" name="__codelineno-33-128" href="#__codelineno-33-128"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-33-129" name="__codelineno-33-129" href="#__codelineno-33-129"></a>        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-33-130" name="__codelineno-33-130" href="#__codelineno-33-130"></a>
<a id="__codelineno-33-131" name="__codelineno-33-131" href="#__codelineno-33-131"></a>        <span class="k">def</span> <span class="nf">role_from_first_message</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-33-132" name="__codelineno-33-132" href="#__codelineno-33-132"></a>            <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">receiver_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-33-133" name="__codelineno-33-133" href="#__codelineno-33-133"></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">:</span>
<a id="__codelineno-33-134" name="__codelineno-33-134" href="#__codelineno-33-134"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Infer the role of the agent from an incoming/outgoing first message</span>
<a id="__codelineno-33-135" name="__codelineno-33-135" href="#__codelineno-33-135"></a>
<a id="__codelineno-33-136" name="__codelineno-33-136" href="#__codelineno-33-136"></a><span class="sd">            :param message: an incoming/outgoing first message</span>
<a id="__codelineno-33-137" name="__codelineno-33-137" href="#__codelineno-33-137"></a><span class="sd">            :param receiver_address: the address of the receiving agent</span>
<a id="__codelineno-33-138" name="__codelineno-33-138" href="#__codelineno-33-138"></a><span class="sd">            :return: The role of the agent</span>
<a id="__codelineno-33-139" name="__codelineno-33-139" href="#__codelineno-33-139"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-33-140" name="__codelineno-33-140" href="#__codelineno-33-140"></a>            <span class="k">return</span> <span class="n">BaseFipaDialogue</span><span class="o">.</span><span class="n">Role</span><span class="o">.</span><span class="n">BUYER</span>
<a id="__codelineno-33-141" name="__codelineno-33-141" href="#__codelineno-33-141"></a>
<a id="__codelineno-33-142" name="__codelineno-33-142" href="#__codelineno-33-142"></a>        <span class="n">BaseFipaDialogues</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-143" name="__codelineno-33-143" href="#__codelineno-33-143"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-144" name="__codelineno-33-144" href="#__codelineno-33-144"></a>            <span class="n">self_address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_address</span><span class="p">,</span>
<a id="__codelineno-33-145" name="__codelineno-33-145" href="#__codelineno-33-145"></a>            <span class="n">role_from_first_message</span><span class="o">=</span><span class="n">role_from_first_message</span><span class="p">,</span>
<a id="__codelineno-33-146" name="__codelineno-33-146" href="#__codelineno-33-146"></a>            <span class="n">dialogue_class</span><span class="o">=</span><span class="n">FipaDialogue</span><span class="p">,</span>
<a id="__codelineno-33-147" name="__codelineno-33-147" href="#__codelineno-33-147"></a>        <span class="p">)</span>
<a id="__codelineno-33-148" name="__codelineno-33-148" href="#__codelineno-33-148"></a>
<a id="__codelineno-33-149" name="__codelineno-33-149" href="#__codelineno-33-149"></a>
<a id="__codelineno-33-150" name="__codelineno-33-150" href="#__codelineno-33-150"></a><span class="k">class</span> <span class="nc">LedgerApiDialogue</span><span class="p">(</span><span class="n">BaseLedgerApiDialogue</span><span class="p">):</span>
<a id="__codelineno-33-151" name="__codelineno-33-151" href="#__codelineno-33-151"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogue class maintains state of a dialogue and manages it.&quot;&quot;&quot;</span>
<a id="__codelineno-33-152" name="__codelineno-33-152" href="#__codelineno-33-152"></a>
<a id="__codelineno-33-153" name="__codelineno-33-153" href="#__codelineno-33-153"></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_associated_fipa_dialogue&quot;</span><span class="p">,)</span>
<a id="__codelineno-33-154" name="__codelineno-33-154" href="#__codelineno-33-154"></a>
<a id="__codelineno-33-155" name="__codelineno-33-155" href="#__codelineno-33-155"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-156" name="__codelineno-33-156" href="#__codelineno-33-156"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-157" name="__codelineno-33-157" href="#__codelineno-33-157"></a>        <span class="n">dialogue_label</span><span class="p">:</span> <span class="n">BaseDialogueLabel</span><span class="p">,</span>
<a id="__codelineno-33-158" name="__codelineno-33-158" href="#__codelineno-33-158"></a>        <span class="n">self_address</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
<a id="__codelineno-33-159" name="__codelineno-33-159" href="#__codelineno-33-159"></a>        <span class="n">role</span><span class="p">:</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">,</span>
<a id="__codelineno-33-160" name="__codelineno-33-160" href="#__codelineno-33-160"></a>        <span class="n">message_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">LedgerApiMessage</span><span class="p">]</span> <span class="o">=</span> <span class="n">LedgerApiMessage</span><span class="p">,</span>
<a id="__codelineno-33-161" name="__codelineno-33-161" href="#__codelineno-33-161"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-162" name="__codelineno-33-162" href="#__codelineno-33-162"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-163" name="__codelineno-33-163" href="#__codelineno-33-163"></a><span class="sd">        Initialize a dialogue.</span>
<a id="__codelineno-33-164" name="__codelineno-33-164" href="#__codelineno-33-164"></a>
<a id="__codelineno-33-165" name="__codelineno-33-165" href="#__codelineno-33-165"></a><span class="sd">        :param dialogue_label: the identifier of the dialogue</span>
<a id="__codelineno-33-166" name="__codelineno-33-166" href="#__codelineno-33-166"></a><span class="sd">        :param self_address: the address of the entity for whom this dialogue is maintained</span>
<a id="__codelineno-33-167" name="__codelineno-33-167" href="#__codelineno-33-167"></a><span class="sd">        :param role: the role of the agent this dialogue is maintained for</span>
<a id="__codelineno-33-168" name="__codelineno-33-168" href="#__codelineno-33-168"></a><span class="sd">        :param message_class: the message class</span>
<a id="__codelineno-33-169" name="__codelineno-33-169" href="#__codelineno-33-169"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-33-170" name="__codelineno-33-170" href="#__codelineno-33-170"></a>        <span class="n">BaseLedgerApiDialogue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-171" name="__codelineno-33-171" href="#__codelineno-33-171"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-172" name="__codelineno-33-172" href="#__codelineno-33-172"></a>            <span class="n">dialogue_label</span><span class="o">=</span><span class="n">dialogue_label</span><span class="p">,</span>
<a id="__codelineno-33-173" name="__codelineno-33-173" href="#__codelineno-33-173"></a>            <span class="n">self_address</span><span class="o">=</span><span class="n">self_address</span><span class="p">,</span>
<a id="__codelineno-33-174" name="__codelineno-33-174" href="#__codelineno-33-174"></a>            <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
<a id="__codelineno-33-175" name="__codelineno-33-175" href="#__codelineno-33-175"></a>            <span class="n">message_class</span><span class="o">=</span><span class="n">message_class</span><span class="p">,</span>
<a id="__codelineno-33-176" name="__codelineno-33-176" href="#__codelineno-33-176"></a>        <span class="p">)</span>
<a id="__codelineno-33-177" name="__codelineno-33-177" href="#__codelineno-33-177"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[FipaDialogue]</span>
<a id="__codelineno-33-178" name="__codelineno-33-178" href="#__codelineno-33-178"></a>
<a id="__codelineno-33-179" name="__codelineno-33-179" href="#__codelineno-33-179"></a>    <span class="nd">@property</span>
<a id="__codelineno-33-180" name="__codelineno-33-180" href="#__codelineno-33-180"></a>    <span class="k">def</span> <span class="nf">associated_fipa_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FipaDialogue</span><span class="p">:</span>
<a id="__codelineno-33-181" name="__codelineno-33-181" href="#__codelineno-33-181"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get associated_fipa_dialogue.&quot;&quot;&quot;</span>
<a id="__codelineno-33-182" name="__codelineno-33-182" href="#__codelineno-33-182"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-183" name="__codelineno-33-183" href="#__codelineno-33-183"></a>            <span class="k">raise</span> <span class="n">AEAEnforceError</span><span class="p">(</span><span class="s2">&quot;FipaDialogue not set!&quot;</span><span class="p">)</span>
<a id="__codelineno-33-184" name="__codelineno-33-184" href="#__codelineno-33-184"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span>
<a id="__codelineno-33-185" name="__codelineno-33-185" href="#__codelineno-33-185"></a>
<a id="__codelineno-33-186" name="__codelineno-33-186" href="#__codelineno-33-186"></a>    <span class="nd">@associated_fipa_dialogue</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-33-187" name="__codelineno-33-187" href="#__codelineno-33-187"></a>    <span class="k">def</span> <span class="nf">associated_fipa_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fipa_dialogue</span><span class="p">:</span> <span class="n">FipaDialogue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-188" name="__codelineno-33-188" href="#__codelineno-33-188"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set associated_fipa_dialogue&quot;&quot;&quot;</span>
<a id="__codelineno-33-189" name="__codelineno-33-189" href="#__codelineno-33-189"></a>        <span class="n">enforce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;FipaDialogue already set!&quot;</span><span class="p">)</span>
<a id="__codelineno-33-190" name="__codelineno-33-190" href="#__codelineno-33-190"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_associated_fipa_dialogue</span> <span class="o">=</span> <span class="n">fipa_dialogue</span>
<a id="__codelineno-33-191" name="__codelineno-33-191" href="#__codelineno-33-191"></a>
<a id="__codelineno-33-192" name="__codelineno-33-192" href="#__codelineno-33-192"></a>
<a id="__codelineno-33-193" name="__codelineno-33-193" href="#__codelineno-33-193"></a><span class="k">class</span> <span class="nc">LedgerApiDialogues</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">BaseLedgerApiDialogues</span><span class="p">):</span>
<a id="__codelineno-33-194" name="__codelineno-33-194" href="#__codelineno-33-194"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogues class keeps track of all dialogues.&quot;&quot;&quot;</span>
<a id="__codelineno-33-195" name="__codelineno-33-195" href="#__codelineno-33-195"></a>
<a id="__codelineno-33-196" name="__codelineno-33-196" href="#__codelineno-33-196"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-197" name="__codelineno-33-197" href="#__codelineno-33-197"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-198" name="__codelineno-33-198" href="#__codelineno-33-198"></a><span class="sd">        Initialize dialogues.</span>
<a id="__codelineno-33-199" name="__codelineno-33-199" href="#__codelineno-33-199"></a>
<a id="__codelineno-33-200" name="__codelineno-33-200" href="#__codelineno-33-200"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-33-201" name="__codelineno-33-201" href="#__codelineno-33-201"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-33-202" name="__codelineno-33-202" href="#__codelineno-33-202"></a>        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-33-203" name="__codelineno-33-203" href="#__codelineno-33-203"></a>
<a id="__codelineno-33-204" name="__codelineno-33-204" href="#__codelineno-33-204"></a>        <span class="k">def</span> <span class="nf">role_from_first_message</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-33-205" name="__codelineno-33-205" href="#__codelineno-33-205"></a>            <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">receiver_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-33-206" name="__codelineno-33-206" href="#__codelineno-33-206"></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">:</span>
<a id="__codelineno-33-207" name="__codelineno-33-207" href="#__codelineno-33-207"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Infer the role of the agent from an incoming/outgoing first message</span>
<a id="__codelineno-33-208" name="__codelineno-33-208" href="#__codelineno-33-208"></a>
<a id="__codelineno-33-209" name="__codelineno-33-209" href="#__codelineno-33-209"></a><span class="sd">            :param message: an incoming/outgoing first message</span>
<a id="__codelineno-33-210" name="__codelineno-33-210" href="#__codelineno-33-210"></a><span class="sd">            :param receiver_address: the address of the receiving agent</span>
<a id="__codelineno-33-211" name="__codelineno-33-211" href="#__codelineno-33-211"></a><span class="sd">            :return: The role of the agent</span>
<a id="__codelineno-33-212" name="__codelineno-33-212" href="#__codelineno-33-212"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-33-213" name="__codelineno-33-213" href="#__codelineno-33-213"></a>            <span class="k">return</span> <span class="n">BaseLedgerApiDialogue</span><span class="o">.</span><span class="n">Role</span><span class="o">.</span><span class="n">AGENT</span>
<a id="__codelineno-33-214" name="__codelineno-33-214" href="#__codelineno-33-214"></a>
<a id="__codelineno-33-215" name="__codelineno-33-215" href="#__codelineno-33-215"></a>        <span class="n">BaseLedgerApiDialogues</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-216" name="__codelineno-33-216" href="#__codelineno-33-216"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-217" name="__codelineno-33-217" href="#__codelineno-33-217"></a>            <span class="n">self_address</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill_id</span><span class="p">),</span>
<a id="__codelineno-33-218" name="__codelineno-33-218" href="#__codelineno-33-218"></a>            <span class="n">role_from_first_message</span><span class="o">=</span><span class="n">role_from_first_message</span><span class="p">,</span>
<a id="__codelineno-33-219" name="__codelineno-33-219" href="#__codelineno-33-219"></a>            <span class="n">dialogue_class</span><span class="o">=</span><span class="n">LedgerApiDialogue</span><span class="p">,</span>
<a id="__codelineno-33-220" name="__codelineno-33-220" href="#__codelineno-33-220"></a>        <span class="p">)</span>
<a id="__codelineno-33-221" name="__codelineno-33-221" href="#__codelineno-33-221"></a>
<a id="__codelineno-33-222" name="__codelineno-33-222" href="#__codelineno-33-222"></a>
<a id="__codelineno-33-223" name="__codelineno-33-223" href="#__codelineno-33-223"></a><span class="n">OefSearchDialogue</span> <span class="o">=</span> <span class="n">BaseOefSearchDialogue</span>
<a id="__codelineno-33-224" name="__codelineno-33-224" href="#__codelineno-33-224"></a>
<a id="__codelineno-33-225" name="__codelineno-33-225" href="#__codelineno-33-225"></a>
<a id="__codelineno-33-226" name="__codelineno-33-226" href="#__codelineno-33-226"></a><span class="k">class</span> <span class="nc">OefSearchDialogues</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">BaseOefSearchDialogues</span><span class="p">):</span>
<a id="__codelineno-33-227" name="__codelineno-33-227" href="#__codelineno-33-227"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class keeps track of all oef_search dialogues.&quot;&quot;&quot;</span>
<a id="__codelineno-33-228" name="__codelineno-33-228" href="#__codelineno-33-228"></a>
<a id="__codelineno-33-229" name="__codelineno-33-229" href="#__codelineno-33-229"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-230" name="__codelineno-33-230" href="#__codelineno-33-230"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-231" name="__codelineno-33-231" href="#__codelineno-33-231"></a><span class="sd">        Initialize dialogues.</span>
<a id="__codelineno-33-232" name="__codelineno-33-232" href="#__codelineno-33-232"></a>
<a id="__codelineno-33-233" name="__codelineno-33-233" href="#__codelineno-33-233"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-33-234" name="__codelineno-33-234" href="#__codelineno-33-234"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-33-235" name="__codelineno-33-235" href="#__codelineno-33-235"></a>        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-33-236" name="__codelineno-33-236" href="#__codelineno-33-236"></a>
<a id="__codelineno-33-237" name="__codelineno-33-237" href="#__codelineno-33-237"></a>        <span class="k">def</span> <span class="nf">role_from_first_message</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-33-238" name="__codelineno-33-238" href="#__codelineno-33-238"></a>            <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">receiver_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-33-239" name="__codelineno-33-239" href="#__codelineno-33-239"></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">:</span>
<a id="__codelineno-33-240" name="__codelineno-33-240" href="#__codelineno-33-240"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Infer the role of the agent from an incoming/outgoing first message</span>
<a id="__codelineno-33-241" name="__codelineno-33-241" href="#__codelineno-33-241"></a>
<a id="__codelineno-33-242" name="__codelineno-33-242" href="#__codelineno-33-242"></a><span class="sd">            :param message: an incoming/outgoing first message</span>
<a id="__codelineno-33-243" name="__codelineno-33-243" href="#__codelineno-33-243"></a><span class="sd">            :param receiver_address: the address of the receiving agent</span>
<a id="__codelineno-33-244" name="__codelineno-33-244" href="#__codelineno-33-244"></a><span class="sd">            :return: The role of the agent</span>
<a id="__codelineno-33-245" name="__codelineno-33-245" href="#__codelineno-33-245"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-33-246" name="__codelineno-33-246" href="#__codelineno-33-246"></a>            <span class="k">return</span> <span class="n">BaseOefSearchDialogue</span><span class="o">.</span><span class="n">Role</span><span class="o">.</span><span class="n">AGENT</span>
<a id="__codelineno-33-247" name="__codelineno-33-247" href="#__codelineno-33-247"></a>
<a id="__codelineno-33-248" name="__codelineno-33-248" href="#__codelineno-33-248"></a>        <span class="n">BaseOefSearchDialogues</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-249" name="__codelineno-33-249" href="#__codelineno-33-249"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-250" name="__codelineno-33-250" href="#__codelineno-33-250"></a>            <span class="n">self_address</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill_id</span><span class="p">),</span>
<a id="__codelineno-33-251" name="__codelineno-33-251" href="#__codelineno-33-251"></a>            <span class="n">role_from_first_message</span><span class="o">=</span><span class="n">role_from_first_message</span><span class="p">,</span>
<a id="__codelineno-33-252" name="__codelineno-33-252" href="#__codelineno-33-252"></a>        <span class="p">)</span>
<a id="__codelineno-33-253" name="__codelineno-33-253" href="#__codelineno-33-253"></a>
<a id="__codelineno-33-254" name="__codelineno-33-254" href="#__codelineno-33-254"></a>
<a id="__codelineno-33-255" name="__codelineno-33-255" href="#__codelineno-33-255"></a><span class="k">class</span> <span class="nc">SigningDialogue</span><span class="p">(</span><span class="n">BaseSigningDialogue</span><span class="p">):</span>
<a id="__codelineno-33-256" name="__codelineno-33-256" href="#__codelineno-33-256"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The dialogue class maintains state of a dialogue and manages it.&quot;&quot;&quot;</span>
<a id="__codelineno-33-257" name="__codelineno-33-257" href="#__codelineno-33-257"></a>
<a id="__codelineno-33-258" name="__codelineno-33-258" href="#__codelineno-33-258"></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_associated_ledger_api_dialogue&quot;</span><span class="p">,)</span>
<a id="__codelineno-33-259" name="__codelineno-33-259" href="#__codelineno-33-259"></a>
<a id="__codelineno-33-260" name="__codelineno-33-260" href="#__codelineno-33-260"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-261" name="__codelineno-33-261" href="#__codelineno-33-261"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-262" name="__codelineno-33-262" href="#__codelineno-33-262"></a>        <span class="n">dialogue_label</span><span class="p">:</span> <span class="n">BaseDialogueLabel</span><span class="p">,</span>
<a id="__codelineno-33-263" name="__codelineno-33-263" href="#__codelineno-33-263"></a>        <span class="n">self_address</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span>
<a id="__codelineno-33-264" name="__codelineno-33-264" href="#__codelineno-33-264"></a>        <span class="n">role</span><span class="p">:</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">,</span>
<a id="__codelineno-33-265" name="__codelineno-33-265" href="#__codelineno-33-265"></a>        <span class="n">message_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">SigningMessage</span><span class="p">]</span> <span class="o">=</span> <span class="n">SigningMessage</span><span class="p">,</span>
<a id="__codelineno-33-266" name="__codelineno-33-266" href="#__codelineno-33-266"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-267" name="__codelineno-33-267" href="#__codelineno-33-267"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-268" name="__codelineno-33-268" href="#__codelineno-33-268"></a><span class="sd">        Initialize a dialogue.</span>
<a id="__codelineno-33-269" name="__codelineno-33-269" href="#__codelineno-33-269"></a>
<a id="__codelineno-33-270" name="__codelineno-33-270" href="#__codelineno-33-270"></a><span class="sd">        :param dialogue_label: the identifier of the dialogue</span>
<a id="__codelineno-33-271" name="__codelineno-33-271" href="#__codelineno-33-271"></a><span class="sd">        :param self_address: the address of the entity for whom this dialogue is maintained</span>
<a id="__codelineno-33-272" name="__codelineno-33-272" href="#__codelineno-33-272"></a><span class="sd">        :param role: the role of the agent this dialogue is maintained for</span>
<a id="__codelineno-33-273" name="__codelineno-33-273" href="#__codelineno-33-273"></a><span class="sd">        :param message_class: the message class</span>
<a id="__codelineno-33-274" name="__codelineno-33-274" href="#__codelineno-33-274"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-33-275" name="__codelineno-33-275" href="#__codelineno-33-275"></a>        <span class="n">BaseSigningDialogue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-276" name="__codelineno-33-276" href="#__codelineno-33-276"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-277" name="__codelineno-33-277" href="#__codelineno-33-277"></a>            <span class="n">dialogue_label</span><span class="o">=</span><span class="n">dialogue_label</span><span class="p">,</span>
<a id="__codelineno-33-278" name="__codelineno-33-278" href="#__codelineno-33-278"></a>            <span class="n">self_address</span><span class="o">=</span><span class="n">self_address</span><span class="p">,</span>
<a id="__codelineno-33-279" name="__codelineno-33-279" href="#__codelineno-33-279"></a>            <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">,</span>
<a id="__codelineno-33-280" name="__codelineno-33-280" href="#__codelineno-33-280"></a>            <span class="n">message_class</span><span class="o">=</span><span class="n">message_class</span><span class="p">,</span>
<a id="__codelineno-33-281" name="__codelineno-33-281" href="#__codelineno-33-281"></a>        <span class="p">)</span>
<a id="__codelineno-33-282" name="__codelineno-33-282" href="#__codelineno-33-282"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_associated_ledger_api_dialogue</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[LedgerApiDialogue]</span>
<a id="__codelineno-33-283" name="__codelineno-33-283" href="#__codelineno-33-283"></a>
<a id="__codelineno-33-284" name="__codelineno-33-284" href="#__codelineno-33-284"></a>    <span class="nd">@property</span>
<a id="__codelineno-33-285" name="__codelineno-33-285" href="#__codelineno-33-285"></a>    <span class="k">def</span> <span class="nf">associated_ledger_api_dialogue</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LedgerApiDialogue</span><span class="p">:</span>
<a id="__codelineno-33-286" name="__codelineno-33-286" href="#__codelineno-33-286"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get associated_ledger_api_dialogue.&quot;&quot;&quot;</span>
<a id="__codelineno-33-287" name="__codelineno-33-287" href="#__codelineno-33-287"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associated_ledger_api_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-288" name="__codelineno-33-288" href="#__codelineno-33-288"></a>            <span class="k">raise</span> <span class="n">AEAEnforceError</span><span class="p">(</span><span class="s2">&quot;LedgerApiDialogue not set!&quot;</span><span class="p">)</span>
<a id="__codelineno-33-289" name="__codelineno-33-289" href="#__codelineno-33-289"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_associated_ledger_api_dialogue</span>
<a id="__codelineno-33-290" name="__codelineno-33-290" href="#__codelineno-33-290"></a>
<a id="__codelineno-33-291" name="__codelineno-33-291" href="#__codelineno-33-291"></a>    <span class="nd">@associated_ledger_api_dialogue</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-33-292" name="__codelineno-33-292" href="#__codelineno-33-292"></a>    <span class="k">def</span> <span class="nf">associated_ledger_api_dialogue</span><span class="p">(</span>
<a id="__codelineno-33-293" name="__codelineno-33-293" href="#__codelineno-33-293"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ledger_api_dialogue</span><span class="p">:</span> <span class="n">LedgerApiDialogue</span>
<a id="__codelineno-33-294" name="__codelineno-33-294" href="#__codelineno-33-294"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-295" name="__codelineno-33-295" href="#__codelineno-33-295"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set associated_ledger_api_dialogue&quot;&quot;&quot;</span>
<a id="__codelineno-33-296" name="__codelineno-33-296" href="#__codelineno-33-296"></a>        <span class="n">enforce</span><span class="p">(</span>
<a id="__codelineno-33-297" name="__codelineno-33-297" href="#__codelineno-33-297"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_associated_ledger_api_dialogue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-33-298" name="__codelineno-33-298" href="#__codelineno-33-298"></a>            <span class="s2">&quot;LedgerApiDialogue already set!&quot;</span><span class="p">,</span>
<a id="__codelineno-33-299" name="__codelineno-33-299" href="#__codelineno-33-299"></a>        <span class="p">)</span>
<a id="__codelineno-33-300" name="__codelineno-33-300" href="#__codelineno-33-300"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_associated_ledger_api_dialogue</span> <span class="o">=</span> <span class="n">ledger_api_dialogue</span>
<a id="__codelineno-33-301" name="__codelineno-33-301" href="#__codelineno-33-301"></a>
<a id="__codelineno-33-302" name="__codelineno-33-302" href="#__codelineno-33-302"></a>
<a id="__codelineno-33-303" name="__codelineno-33-303" href="#__codelineno-33-303"></a><span class="k">class</span> <span class="nc">SigningDialogues</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">BaseSigningDialogues</span><span class="p">):</span>
<a id="__codelineno-33-304" name="__codelineno-33-304" href="#__codelineno-33-304"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class keeps track of all oef_search dialogues.&quot;&quot;&quot;</span>
<a id="__codelineno-33-305" name="__codelineno-33-305" href="#__codelineno-33-305"></a>
<a id="__codelineno-33-306" name="__codelineno-33-306" href="#__codelineno-33-306"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-33-307" name="__codelineno-33-307" href="#__codelineno-33-307"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-308" name="__codelineno-33-308" href="#__codelineno-33-308"></a><span class="sd">        Initialize dialogues.</span>
<a id="__codelineno-33-309" name="__codelineno-33-309" href="#__codelineno-33-309"></a>
<a id="__codelineno-33-310" name="__codelineno-33-310" href="#__codelineno-33-310"></a><span class="sd">        :param kwargs: keyword arguments</span>
<a id="__codelineno-33-311" name="__codelineno-33-311" href="#__codelineno-33-311"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-33-312" name="__codelineno-33-312" href="#__codelineno-33-312"></a>        <span class="n">Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-33-313" name="__codelineno-33-313" href="#__codelineno-33-313"></a>
<a id="__codelineno-33-314" name="__codelineno-33-314" href="#__codelineno-33-314"></a>        <span class="k">def</span> <span class="nf">role_from_first_message</span><span class="p">(</span>  <span class="c1"># pylint: disable=unused-argument</span>
<a id="__codelineno-33-315" name="__codelineno-33-315" href="#__codelineno-33-315"></a>            <span class="n">message</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">receiver_address</span><span class="p">:</span> <span class="n">Address</span>
<a id="__codelineno-33-316" name="__codelineno-33-316" href="#__codelineno-33-316"></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDialogue</span><span class="o">.</span><span class="n">Role</span><span class="p">:</span>
<a id="__codelineno-33-317" name="__codelineno-33-317" href="#__codelineno-33-317"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Infer the role of the agent from an incoming/outgoing first message</span>
<a id="__codelineno-33-318" name="__codelineno-33-318" href="#__codelineno-33-318"></a>
<a id="__codelineno-33-319" name="__codelineno-33-319" href="#__codelineno-33-319"></a><span class="sd">            :param message: an incoming/outgoing first message</span>
<a id="__codelineno-33-320" name="__codelineno-33-320" href="#__codelineno-33-320"></a><span class="sd">            :param receiver_address: the address of the receiving agent</span>
<a id="__codelineno-33-321" name="__codelineno-33-321" href="#__codelineno-33-321"></a><span class="sd">            :return: The role of the agent</span>
<a id="__codelineno-33-322" name="__codelineno-33-322" href="#__codelineno-33-322"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-33-323" name="__codelineno-33-323" href="#__codelineno-33-323"></a>            <span class="k">return</span> <span class="n">BaseSigningDialogue</span><span class="o">.</span><span class="n">Role</span><span class="o">.</span><span class="n">SKILL</span>
<a id="__codelineno-33-324" name="__codelineno-33-324" href="#__codelineno-33-324"></a>
<a id="__codelineno-33-325" name="__codelineno-33-325" href="#__codelineno-33-325"></a>        <span class="n">BaseSigningDialogues</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-33-326" name="__codelineno-33-326" href="#__codelineno-33-326"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-33-327" name="__codelineno-33-327" href="#__codelineno-33-327"></a>            <span class="n">self_address</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill_id</span><span class="p">),</span>
<a id="__codelineno-33-328" name="__codelineno-33-328" href="#__codelineno-33-328"></a>            <span class="n">role_from_first_message</span><span class="o">=</span><span class="n">role_from_first_message</span><span class="p">,</span>
<a id="__codelineno-33-329" name="__codelineno-33-329" href="#__codelineno-33-329"></a>            <span class="n">dialogue_class</span><span class="o">=</span><span class="n">SigningDialogue</span><span class="p">,</span>
<a id="__codelineno-33-330" name="__codelineno-33-330" href="#__codelineno-33-330"></a>        <span class="p">)</span>
</code></pre></div>
<p>The various dialogues classes in the above code snippet store dialogues with other AEAs, services and components, (e.g. SOEF search node via the <code>fetchai/soef</code> connection, ledgers via the <code>fetchai/ledger</code> connection and the decision maker). They expose useful methods to manipulate these interactions, access previous messages, and enable us to identify possible communications problems between <code>my_generic_seller</code> and <code>my_generic_buyer</code> AEAs.</p>
<h3 id="step-6-update-the-yaml-files_1">Step 6: Update the YAML Files<a class="headerlink" href="#step-6-update-the-yaml-files_1" title="Permanent link">&para;</a></h3>
<p>After making so many changes to our skill, we have to update the <code>skill.yaml</code> configuration file so it reflects our newly created classes, and contains the values used by the strategy. Make sure <code>skill.yaml</code> contains the following configuration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generic_buyer</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1.0</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">skill</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The weather client skill implements the skill to purchase weather data.</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="nt">license</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Apache-2.0</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="nt">aea_version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&gt;=1.0.0,</span><span class="nv"> </span><span class="s">&lt;2.0.0&#39;</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="nt">fingerprint</span><span class="p">:</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">  </span><span class="nt">README.md</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmTR91jm7WfJpmabisy74NR5mc35YXjDU1zQAUKZeHRw8L</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">  </span><span class="nt">__init__.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmU5vrC8FipyjfS5biNa6qDWdp4aeH5h4YTtbFDmCg8Chj</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">  </span><span class="nt">behaviours.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmNwvSjEz4kzM3gWtnKbZVFJc2Z85Nb748CWAK4C4Sa4nT</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">  </span><span class="nt">dialogues.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmNen91qQDWy4bNBKrB3LabAP5iRf29B8iwYss4NB13iNU</span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">  </span><span class="nt">handlers.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmZfudXXbdiREiViuwPZDXoQQyXT2ySQHdF7psQsohZXQy</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">  </span><span class="nt">strategy.py</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QmcrwaEWvKHDCNti8QjRhB4utJBJn5L8GpD27Uy9zHwKhY</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="nt">fingerprint_ignore_patterns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="nt">connections</span><span class="p">:</span>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/ledger:0.21.5</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="nt">contracts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="nt">protocols</span><span class="p">:</span>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/default:1.1.7</span>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/fipa:1.1.7</span>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/ledger_api:1.1.7</span>
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/oef_search:1.1.7</span>
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fetchai/signing:1.1.7</span>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="nt">skills</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="nt">behaviours</span><span class="p">:</span>
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="w">  </span><span class="nt">search</span><span class="p">:</span>
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="w">      </span><span class="nt">search_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericSearchBehaviour</span>
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="w">  </span><span class="nt">transaction</span><span class="p">:</span>
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="w">      </span><span class="nt">max_processing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">420</span>
<a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="w">      </span><span class="nt">transaction_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericTransactionBehaviour</span>
<a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="nt">handlers</span><span class="p">:</span>
<a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="w">  </span><span class="nt">fipa</span><span class="p">:</span>
<a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericFipaHandler</span>
<a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="w">  </span><span class="nt">ledger_api</span><span class="p">:</span>
<a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericLedgerApiHandler</span>
<a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="w">  </span><span class="nt">oef_search</span><span class="p">:</span>
<a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericOefSearchHandler</span>
<a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a><span class="w">  </span><span class="nt">signing</span><span class="p">:</span>
<a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-34-48" name="__codelineno-34-48" href="#__codelineno-34-48"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericSigningHandler</span>
<a id="__codelineno-34-49" name="__codelineno-34-49" href="#__codelineno-34-49"></a><span class="nt">models</span><span class="p">:</span>
<a id="__codelineno-34-50" name="__codelineno-34-50" href="#__codelineno-34-50"></a><span class="w">  </span><span class="nt">default_dialogues</span><span class="p">:</span>
<a id="__codelineno-34-51" name="__codelineno-34-51" href="#__codelineno-34-51"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-34-52" name="__codelineno-34-52" href="#__codelineno-34-52"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DefaultDialogues</span>
<a id="__codelineno-34-53" name="__codelineno-34-53" href="#__codelineno-34-53"></a><span class="w">  </span><span class="nt">fipa_dialogues</span><span class="p">:</span>
<a id="__codelineno-34-54" name="__codelineno-34-54" href="#__codelineno-34-54"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-34-55" name="__codelineno-34-55" href="#__codelineno-34-55"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FipaDialogues</span>
<a id="__codelineno-34-56" name="__codelineno-34-56" href="#__codelineno-34-56"></a><span class="w">  </span><span class="nt">ledger_api_dialogues</span><span class="p">:</span>
<a id="__codelineno-34-57" name="__codelineno-34-57" href="#__codelineno-34-57"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-34-58" name="__codelineno-34-58" href="#__codelineno-34-58"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LedgerApiDialogues</span>
<a id="__codelineno-34-59" name="__codelineno-34-59" href="#__codelineno-34-59"></a><span class="w">  </span><span class="nt">oef_search_dialogues</span><span class="p">:</span>
<a id="__codelineno-34-60" name="__codelineno-34-60" href="#__codelineno-34-60"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-34-61" name="__codelineno-34-61" href="#__codelineno-34-61"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OefSearchDialogues</span>
<a id="__codelineno-34-62" name="__codelineno-34-62" href="#__codelineno-34-62"></a><span class="w">  </span><span class="nt">signing_dialogues</span><span class="p">:</span>
<a id="__codelineno-34-63" name="__codelineno-34-63" href="#__codelineno-34-63"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<a id="__codelineno-34-64" name="__codelineno-34-64" href="#__codelineno-34-64"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SigningDialogues</span>
<a id="__codelineno-34-65" name="__codelineno-34-65" href="#__codelineno-34-65"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<a id="__codelineno-34-66" name="__codelineno-34-66" href="#__codelineno-34-66"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-34-67" name="__codelineno-34-67" href="#__codelineno-34-67"></a><span class="w">      </span><span class="nt">is_ledger_tx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-34-68" name="__codelineno-34-68" href="#__codelineno-34-68"></a><span class="w">      </span><span class="nt">location</span><span class="p">:</span>
<a id="__codelineno-34-69" name="__codelineno-34-69" href="#__codelineno-34-69"></a><span class="w">        </span><span class="nt">latitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">51.5194</span>
<a id="__codelineno-34-70" name="__codelineno-34-70" href="#__codelineno-34-70"></a><span class="w">        </span><span class="nt">longitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.127</span>
<a id="__codelineno-34-71" name="__codelineno-34-71" href="#__codelineno-34-71"></a><span class="w">      </span><span class="nt">max_negotiations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-34-72" name="__codelineno-34-72" href="#__codelineno-34-72"></a><span class="w">      </span><span class="nt">max_tx_fee</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3550000000000000</span>
<a id="__codelineno-34-73" name="__codelineno-34-73" href="#__codelineno-34-73"></a><span class="w">      </span><span class="nt">max_unit_price</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<a id="__codelineno-34-74" name="__codelineno-34-74" href="#__codelineno-34-74"></a><span class="w">      </span><span class="nt">min_quantity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-34-75" name="__codelineno-34-75" href="#__codelineno-34-75"></a><span class="w">      </span><span class="nt">search_query</span><span class="p">:</span>
<a id="__codelineno-34-76" name="__codelineno-34-76" href="#__codelineno-34-76"></a><span class="w">        </span><span class="nt">constraint_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">==</span>
<a id="__codelineno-34-77" name="__codelineno-34-77" href="#__codelineno-34-77"></a><span class="w">        </span><span class="nt">search_key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">seller_service</span>
<a id="__codelineno-34-78" name="__codelineno-34-78" href="#__codelineno-34-78"></a><span class="w">        </span><span class="nt">search_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generic_service</span>
<a id="__codelineno-34-79" name="__codelineno-34-79" href="#__codelineno-34-79"></a><span class="w">      </span><span class="nt">search_radius</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
<a id="__codelineno-34-80" name="__codelineno-34-80" href="#__codelineno-34-80"></a><span class="w">      </span><span class="nt">service_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">generic_service</span>
<a id="__codelineno-34-81" name="__codelineno-34-81" href="#__codelineno-34-81"></a><span class="w">      </span><span class="nt">stop_searching_on_result</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-34-82" name="__codelineno-34-82" href="#__codelineno-34-82"></a><span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GenericStrategy</span>
<a id="__codelineno-34-83" name="__codelineno-34-83" href="#__codelineno-34-83"></a><span class="nt">is_abstract</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-34-84" name="__codelineno-34-84" href="#__codelineno-34-84"></a><span class="nt">dependencies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</code></pre></div>
<p>We must pay attention to the models and the strategy’s variables. Here we can change the price we would like to buy each reading at, the maximum transaction fee we are prepared to pay, and so on.</p>
<p>Finally, we fingerprint our new skill:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>aea<span class="w"> </span>fingerprint<span class="w"> </span>skill<span class="w"> </span>fetchai/generic_buyer:0.1.0
</code></pre></div>
<p>This will hash each file and save the hash in the fingerprint. This way, in the future we can easily track if any of the files have changed.</p>
<h2 id="run-the-aeas">Run the AEAs<a class="headerlink" href="#run-the-aeas" title="Permanent link">&para;</a></h2>
<h3 id="create-private-keys">Create Private Keys<a class="headerlink" href="#create-private-keys" title="Permanent link">&para;</a></h3>
<p>For each AEA, create a private key:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>aea<span class="w"> </span>generate-key<span class="w"> </span>fetchai
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>aea<span class="w"> </span>add-key<span class="w"> </span>fetchai<span class="w"> </span>fetchai_private_key.txt
</code></pre></div>
<p>Next, create a private key to secure the AEA's communications:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>aea<span class="w"> </span>generate-key<span class="w"> </span>fetchai<span class="w"> </span>fetchai_connection_private_key.txt
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>aea<span class="w"> </span>add-key<span class="w"> </span>fetchai<span class="w"> </span>fetchai_connection_private_key.txt<span class="w"> </span>--connection
</code></pre></div>
<p>Finally, certify the key for use by the connections that request that:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>aea<span class="w"> </span>issue-certificates
</code></pre></div>
<h3 id="update-the-aea-configurations">Update the AEA Configurations<a class="headerlink" href="#update-the-aea-configurations" title="Permanent link">&para;</a></h3>
<p>In both AEAs run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>aea<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--type<span class="w"> </span>dict<span class="w"> </span>agent.default_routing<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="s1">&#39;{</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="s1">  &quot;fetchai/ledger_api:1.1.7&quot;: &quot;fetchai/ledger:0.21.5&quot;,</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="s1">  &quot;fetchai/oef_search:1.1.7&quot;: &quot;fetchai/soef:0.27.6&quot;</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="s1">}&#39;</span>
</code></pre></div>
<h3 id="fund-the-buyer-aea">Fund the Buyer AEA<a class="headerlink" href="#fund-the-buyer-aea" title="Permanent link">&para;</a></h3>
<p>Create some wealth for your buyer on the Fetch.ai testnet (this operation might take a while).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>aea<span class="w"> </span>generate-wealth<span class="w"> </span>fetchai<span class="w"> </span>--sync
</code></pre></div>
<h3 id="run-seller-aea">Run Seller AEA<a class="headerlink" href="#run-seller-aea" title="Permanent link">&para;</a></h3>
<p>Add the remaining packages for the seller AEA, then run it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>aea<span class="w"> </span>add<span class="w"> </span>connection<span class="w"> </span>fetchai/p2p_libp2p:0.27.5
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>aea<span class="w"> </span>add<span class="w"> </span>connection<span class="w"> </span>fetchai/soef:0.27.6
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>aea<span class="w"> </span>add<span class="w"> </span>connection<span class="w"> </span>fetchai/ledger:0.21.5
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>aea<span class="w"> </span>add<span class="w"> </span>protocol<span class="w"> </span>fetchai/fipa:1.1.7
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>aea<span class="w"> </span>install
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>aea<span class="w"> </span>build
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>aea<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>agent.default_connection<span class="w"> </span>fetchai/p2p_libp2p:0.27.5
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>aea<span class="w"> </span>run
</code></pre></div>
<p>Once you see a message of the form <code>To join its network use multiaddr: ['SOME_ADDRESS']</code> take note of the address.</p>
<h4 id="run-buyer-aea">Run Buyer AEA<a class="headerlink" href="#run-buyer-aea" title="Permanent link">&para;</a></h4>
<p>Add the remaining packages for the buyer AEA:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>aea<span class="w"> </span>add<span class="w"> </span>connection<span class="w"> </span>fetchai/p2p_libp2p:0.27.5
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>aea<span class="w"> </span>add<span class="w"> </span>connection<span class="w"> </span>fetchai/soef:0.27.6
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>aea<span class="w"> </span>add<span class="w"> </span>connection<span class="w"> </span>fetchai/ledger:0.21.5
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>aea<span class="w"> </span>add<span class="w"> </span>protocol<span class="w"> </span>fetchai/fipa:1.1.7
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>aea<span class="w"> </span>add<span class="w"> </span>protocol<span class="w"> </span>fetchai/signing:1.1.7
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>aea<span class="w"> </span>install
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>aea<span class="w"> </span>build
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>aea<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>agent.default_connection<span class="w"> </span>fetchai/p2p_libp2p:0.27.5
</code></pre></div>
<p>Then, update the configuration of the buyer AEA's P2P connection:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>aea<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--type<span class="w"> </span>dict<span class="w"> </span>vendor.fetchai.connections.p2p_libp2p.config<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="s1">&#39;{</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="s1">  &quot;delegate_uri&quot;: &quot;127.0.0.1:11001&quot;,</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="s1">  &quot;entry_peers&quot;: [&quot;SOME_ADDRESS&quot;],</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="s1">  &quot;local_uri&quot;: &quot;127.0.0.1:9001&quot;,</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="s1">  &quot;log_file&quot;: &quot;libp2p_node.log&quot;,</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="s1">  &quot;public_uri&quot;: &quot;127.0.0.1:9001&quot;</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="s1">}&#39;</span>
</code></pre></div>
<p>where <code>SOME_ADDRESS</code> is replaced accordingly.</p>
<p>Then run the buyer AEA:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>aea<span class="w"> </span>run
</code></pre></div>
<p>You will see that the AEAs negotiate and then transact using the Dorado testnet.</p>
<h2 id="delete-the-aeas">Delete the AEAs<a class="headerlink" href="#delete-the-aeas" title="Permanent link">&para;</a></h2>
<p>When you are done, go up a level and delete the AEAs.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nb">cd</span><span class="w"> </span>..
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>aea<span class="w"> </span>delete<span class="w"> </span>my_generic_seller
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>aea<span class="w"> </span>delete<span class="w"> </span>my_generic_buyer
</code></pre></div>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>You have completed the "Getting Started" series. Congratulations!</p>
<p>The following guide provides some hints on <a href="../development-setup">AEA development setup</a>.</p>
<h3 id="recommended">Recommended<a class="headerlink" href="#recommended" title="Permanent link">&para;</a></h3>
<p>We recommend you build your own AEA next. There are many helpful guides and demos in the documentation, and a developer community on <a href="https://discord.com/invite/btedfjPJTj" target="_blank">Discord</a>. Speak to you there!</p>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by <a href="https://github.com/fetchai/docs/issues/new?labels=feedback&template=improve-docs.yml&title=[feedback]+Trade%20between%20two%20AEAs+-+/aea-framework-documentation/generic-skills-step-by-step/" target="_blank" rel="noopener">reporting what's wrong</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../skill-guide/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Build your first skill - search &amp; discovery" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Build your first skill - search & discovery
              </div>
            </div>
          </a>
        
        
          
          <a href="../skill-testing/" class="md-footer__link md-footer__link--next" aria-label="Next: Testing Skills" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Testing Skills
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2018 - 2023 Fetch.ai - <a href="#__consent">Change cookie settings</a>

    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://bit.ly/3oDuI3f" target="_blank" rel="noopener" title="fetch.ai on Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://t.me/fetch_ai" target="_blank" rel="noopener" title="fetch.ai on Telegram" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://bit.ly/3ra5uMI" target="_blank" rel="noopener" title="fetch.ai on Discord" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://bit.ly/3AFCWxl" target="_blank" rel="noopener" title="fetch.ai on GitHubs" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://bit.ly/30zS1Tg" target="_blank" rel="noopener" title="fetch.ai on Reddit" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://bit.ly/3DxFazs" target="_blank" rel="noopener" title="fetch.ai on YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://bit.ly/3kNO70p" target="_blank" rel="noopener" title="fetch.ai on LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  





<h4>Cookie consent</h4>
<p>We use cookies to recognize your preferences and measure the effectiveness of our  documentation via the feedback widget at the bottom of every docs page. With your consent, you're helping us make this documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
    
    
      <button type="reset" class="md-button md-button--primary">Reject</button>
    
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share", "toc.follow", "content.code.copy"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6df46069.min.js"></script>
      
        <script src="../../js/termynal-fast.js"></script>
      
    
  </body>
</html>