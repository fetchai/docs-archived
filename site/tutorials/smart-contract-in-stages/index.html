<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="Everything you need to know about Fetch.AI."><link rel="canonical" href="https://docs.fetch.ai/tutorials/smart-contract-in-stages/"><meta name="author" content="katharine.murphy@fetch.ai"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="/assets/images/favicon.ico"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>Smart contract in stages - Fetch.AI Developer Documentation</title><link rel="stylesheet" href="../../assets/stylesheets/application.4031d38b.css"><script src="../../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../../assets/fonts/material-icons.css"><link rel="stylesheet" href="../../css/my-styles.css"></head><body dir="ltr"><svg class="md-svg"><defs></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="https://docs.fetch.ai/" title="Fetch.AI Developer Documentation" class="md-header-nav__button md-logo"><i class="md-icon">code</i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Fetch.AI Developer Documentation</span><span class="md-header-nav__topic">Smart contract in stages</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div></div></nav></header><div class="md-container"><nav class="md-tabs md-tabs--active" data-md-component="tabs"><div class="md-tabs__inner md-grid"><ul class="md-tabs__list"><li class="md-tabs__item"><a href="../../getting-started/versions/" title="Getting Started" class="md-tabs__link">Getting Started</a></li><li class="md-tabs__item"><a href="../../oef/" title="Open Economic Framework" class="md-tabs__link">Open Economic Framework</a></li><li class="md-tabs__item"><a href="../../etch-language/" title="Etch Language" class="md-tabs__link">Etch Language</a></li><li class="md-tabs__item"><a href="../../smart-contracts/smart-contract-intro/" title="Smart Contracts" class="md-tabs__link">Smart Contracts</a></li><li class="md-tabs__item"><a href="../submitting_contract/" title="Tutorials" class="md-tabs__link md-tabs__link--active">Tutorials</a></li></ul></div></nav><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="https://docs.fetch.ai/" title="Fetch.AI Developer Documentation" class="md-nav__button md-logo"><i class="md-icon">code</i></a>Fetch.AI Developer Documentation</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1"><label class="md-nav__link" for="nav-1">Getting Started</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-1">Getting Started</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../getting-started/versions/" title="Versions" class="md-nav__link">Versions</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2" type="checkbox" id="nav-1-2"><label class="md-nav__link" for="nav-1-2">Install the Fetch.AI Ledger</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-1-2">Install the Fetch.AI Ledger</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../getting-started/installation-mac/" title="MacOS" class="md-nav__link">MacOS</a></li><li class="md-nav__item"><a href="../../getting-started/installation-ubuntu/" title="Ubuntu" class="md-nav__link">Ubuntu</a></li><li class="md-nav__item"><a href="../../getting-started/installation-redhat/" title="Redhat" class="md-nav__link">Redhat</a></li></ul></nav></li><li class="md-nav__item"><a href="../../getting-started/run-a-node/" title="Run a local node" class="md-nav__link">Run a local node</a></li><li class="md-nav__item"><a href="../../getting-started/python-api-install/" title="Python Ledger API" class="md-nav__link">Python Ledger API</a></li><li class="md-nav__item"><a href="../../getting-started/oef-install/" title="Open Economic Framework" class="md-nav__link">Open Economic Framework</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2"><label class="md-nav__link" for="nav-2">Open Economic Framework</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">Open Economic Framework</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1"><label class="md-nav__link" for="nav-2-1">Welcome</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-2-1">Welcome</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../oef/" title="What is the OEF?" class="md-nav__link">What is the OEF?</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2"><label class="md-nav__link" for="nav-2-2">The Basics</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-2-2">The Basics</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../oef/running-a-node/" title="Running a node" class="md-nav__link">Running a node</a></li><li class="md-nav__item"><a href="../../oef/sdk/" title="Get the SDK" class="md-nav__link">Get the SDK</a></li><li class="md-nav__item"><a href="../../oef/public-key/" title="Get a public key" class="md-nav__link">Get a public key</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3"><label class="md-nav__link" for="nav-2-3">How It Works</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-2-3">How It Works</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../oef/registering/" title="Registering" class="md-nav__link">Registering</a></li><li class="md-nav__item"><a href="../../oef/advertising/" title="Advertising" class="md-nav__link">Advertising</a></li><li class="md-nav__item"><a href="../../oef/searching/" title="Searching" class="md-nav__link">Searching</a></li><li class="md-nav__item"><a href="../../oef/negotiating/" title="Negotiating" class="md-nav__link">Negotiating</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4"><label class="md-nav__link" for="nav-2-4">Python API</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-2-4">Python API</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../oef/python-API/" title="Python API" class="md-nav__link">Python API</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3"><label class="md-nav__link" for="nav-3">Etch Language</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">Etch Language</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1"><label class="md-nav__link" for="nav-3-1">Welcome</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-1">Welcome</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../etch-language/" title="What's etch?" class="md-nav__link">What's etch?</a></li><li class="md-nav__item"><a href="../../etch-language/getstarted/" title="Getting started" class="md-nav__link">Getting started</a></li><li class="md-nav__item"><a href="../../etch-language/debug/" title="Debugging" class="md-nav__link">Debugging</a></li><li class="md-nav__item"><a href="../../etch-language/release-notes/" title="Release notes" class="md-nav__link">Release notes</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2"><label class="md-nav__link" for="nav-3-2">The Basics</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-2">The Basics</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../etch-language/syntax/" title="Syntax" class="md-nav__link">Syntax</a></li><li class="md-nav__item"><a href="../../etch-language/variables/" title="Variables" class="md-nav__link">Variables</a></li><li class="md-nav__item"><a href="../../etch-language/operators/" title="Operators" class="md-nav__link">Operators</a></li><li class="md-nav__item"><a href="../../etch-language/logic/" title="Logical operators" class="md-nav__link">Logical operators</a></li><li class="md-nav__item"><a href="../../etch-language/control-flow/" title="Control flow" class="md-nav__link">Control flow</a></li><li class="md-nav__item"><a href="../../etch-language/strings/" title="Strings" class="md-nav__link">Strings</a></li><li class="md-nav__item"><a href="../../etch-language/arrays/" title="Arrays" class="md-nav__link">Arrays</a></li><li class="md-nav__item"><a href="../../etch-language/functions/" title="Functions" class="md-nav__link">Functions</a></li><li class="md-nav__item"><a href="../../etch-language/regex/" title="Regex" class="md-nav__link">Regex</a></li><li class="md-nav__item"><a href="../../etch-language/error-checking/" title="Error checking" class="md-nav__link">Error checking</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3"><label class="md-nav__link" for="nav-3-3">Fetch Ledger Types</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-3">Fetch Ledger Types</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../etch-language/states/" title="States" class="md-nav__link">States</a></li><li class="md-nav__item"><a href="../../etch-language/sharded-state/" title="Sharded State" class="md-nav__link">Sharded State</a></li><li class="md-nav__item"><a href="../../etch-language/addresses/" title="Addresses" class="md-nav__link">Addresses</a></li><li class="md-nav__item"><a href="../../etch-language/crypto/" title="Cryptographic functions" class="md-nav__link">Cryptographic functions</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4"><label class="md-nav__link" for="nav-3-4">Maths and ML</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-4">Maths and ML</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../etch-language/maths-libs/" title="Maths libraries and functions" class="md-nav__link">Maths libraries and functions</a></li><li class="md-nav__item"><a href="../../etch-language/ML-AI/" title="Machine learning and AI" class="md-nav__link">Machine learning and AI</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5"><label class="md-nav__link" for="nav-3-5">Extending Etch</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-5">Extending Etch</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../etch-language/extending-etch/" title="Extending etch in C++" class="md-nav__link">Extending etch in C++</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6"><label class="md-nav__link" for="nav-3-6">Examples</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-6">Examples</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../etch-language/examples/fetch-logo/" title="Fetch logo" class="md-nav__link">Fetch logo</a></li><li class="md-nav__item"><a href="../../etch-language/examples/mandelbrot/" title="Mandelbrot" class="md-nav__link">Mandelbrot</a></li><li class="md-nav__item"><a href="../../etch-language/examples/searching-algorithms/" title="Searching algorithms" class="md-nav__link">Searching algorithms</a></li><li class="md-nav__item"><a href="../../etch-language/examples/sorting-algorithms/" title="Sorting algorithms" class="md-nav__link">Sorting algorithms</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4"><label class="md-nav__link" for="nav-4">Smart Contracts</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-4">Smart Contracts</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../smart-contracts/smart-contract-intro/" title="Introduction" class="md-nav__link">Introduction</a></li><li class="md-nav__item"><a href="../../smart-contracts/data-types/" title="Data types" class="md-nav__link">Data types</a></li><li class="md-nav__item"><a href="../../smart-contracts/memory/" title="Memory" class="md-nav__link">Memory</a></li><li class="md-nav__item"><a href="../../smart-contracts/smart-contracts/" title="Etch smart contracts" class="md-nav__link">Etch smart contracts</a></li><li class="md-nav__item"><a href="../../smart-contracts/pipenv/" title="Python environment" class="md-nav__link">Python environment</a></li><li class="md-nav__item"><a href="../../smart-contracts/executing-smart-contract-code/" title="Executing smart contracts" class="md-nav__link">Executing smart contracts</a></li><li class="md-nav__item"><a href="../../smart-contracts/wallets/" title="Wallets" class="md-nav__link">Wallets</a></li><li class="md-nav__item"><a href="../../smart-contracts/synergetic/" title="Synergetic contracts" class="md-nav__link">Synergetic contracts</a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked><label class="md-nav__link" for="nav-5">Tutorials</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-5">Tutorials</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../submitting_contract/" title="Hello world smart contract" class="md-nav__link">Hello world smart contract</a></li><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><a href="./" title="Smart contract in stages" class="md-nav__link md-nav__link--active">Smart contract in stages</a></li><li class="md-nav__item"><a href="../block-number/" title="Get block number" class="md-nav__link">Get block number</a></li><li class="md-nav__item"><a href="../erc20/" title="Create FET-20 contract" class="md-nav__link">Create FET-20 contract</a></li><li class="md-nav__item"><a href="../erc721/" title="Create FET-721 contract" class="md-nav__link">Create FET-721 contract</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1>Smart contract in stages</h1>

<p>Let's look at the three Python scripts in the <code>contract_in_stages</code> directory.</p>
<p>The first script <code>01_create_private_key.py</code> creates an <code>Entity</code> object and inserts the private key from the <code>private.key</code> file in the same directory.</p>
<p>Once this is done, the script gives the <code>Entity</code> 10000 tokens.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Creating private key...&#39;</span><span class="p">)</span>

    <span class="c1"># create our first private key pair</span>
    <span class="n">entity1</span> <span class="o">=</span> <span class="n">Entity</span><span class="p">()</span>

    <span class="c1"># save the private key to disk</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;private.key&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">private_key_file</span><span class="p">:</span>
        <span class="n">entity1</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">private_key_file</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Creating private key...complete&#39;</span><span class="p">)</span>

    <span class="c1"># build the ledger API</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">LedgerApi</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8100</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Creating initial balance...&#39;</span><span class="p">)</span>

    <span class="c1"># create wealth so that we have the funds to be able to create contracts on the network</span>
    <span class="n">api</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">wealth</span><span class="p">(</span><span class="n">entity1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Creating initial balance...complete&#39;</span><span class="p">)</span>
</pre></div>

<p>In the <code>02_create_contract.py</code> file, we embed the <code>etch</code> smart contract code into the script as a string.</p>
<p>We have an <code>init()</code> function which receives an <code>Address</code> object and sets its balance to 1000000 tokens in a <code>State</code> variable.</p>
<p>The <code>transfer()</code> function grabs or creates the <code>State</code> objects from two <code>Address</code> objects.</p>
<p>After a check to make sure there are enough funds in the from_account, the <code>from_account</code> transfers the <code>amount</code> to the <code>to_account</code>.</p>
<p>The <code>query()</code> function allows you to query the balance of an <code>Address</code> on the ledger via a <code>State</code> construct.</p>
<div class="highlight"><pre><span></span><span class="err">@</span><span class="n">init</span>
<span class="n">function</span> <span class="n">setup</span><span class="p">(</span><span class="nl">owner</span> <span class="p">:</span> <span class="n">Address</span><span class="p">)</span>
  <span class="n">var</span> <span class="n">owner_balance</span> <span class="o">=</span> <span class="n">State</span><span class="o">&lt;</span><span class="n">UInt64</span><span class="o">&gt;</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
  <span class="n">owner_balance</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000000u64</span><span class="p">);</span>
<span class="n">endfunction</span>

<span class="err">@</span><span class="n">action</span>
<span class="n">function</span> <span class="n">transfer</span><span class="p">(</span><span class="nl">from</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span> <span class="nl">to</span><span class="p">:</span> <span class="n">Address</span><span class="p">,</span> <span class="nl">amount</span><span class="p">:</span> <span class="n">UInt64</span><span class="p">)</span>

  <span class="c1">// define the accounts</span>
  <span class="n">var</span> <span class="n">from_account</span> <span class="o">=</span> <span class="n">State</span><span class="o">&lt;</span><span class="n">UInt64</span><span class="o">&gt;</span><span class="p">(</span><span class="n">from</span><span class="p">);</span>
  <span class="n">var</span> <span class="n">to_account</span> <span class="o">=</span> <span class="n">State</span><span class="o">&lt;</span><span class="n">UInt64</span><span class="o">&gt;</span><span class="p">(</span><span class="n">to</span><span class="p">);</span> <span class="c1">// if new sets to 0u</span>

  <span class="c1">// Check if the sender has enough balance to proceed</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">from_account</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">)</span>

    <span class="c1">// update the account balances</span>
    <span class="n">from_account</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">from_account</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">-</span> <span class="n">amount</span><span class="p">);</span>
    <span class="n">to_account</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">to_account</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0u64</span><span class="p">)</span> <span class="o">+</span> <span class="n">amount</span><span class="p">);</span>
  <span class="n">endif</span>

<span class="n">endfunction</span>

<span class="err">@</span><span class="n">query</span>
<span class="n">function</span> <span class="n">balance</span><span class="p">(</span><span class="nl">address</span><span class="p">:</span> <span class="n">Address</span><span class="p">)</span> <span class="o">:</span> <span class="n">UInt64</span>
    <span class="n">var</span> <span class="n">account</span> <span class="o">=</span> <span class="n">State</span><span class="o">&lt;</span><span class="n">UInt64</span><span class="o">&gt;</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">account</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0u64</span><span class="p">);</span>
<span class="n">endfunction</span>
</pre></div>

<p>The Python script loads the private key created in the first step, connects to the running ledger node, and deploys the contract to the ledger paying 2000 tokens to do so and designating <code>entity1</code> as the owner of the contract.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Loading private key...&#39;</span><span class="p">)</span>

    <span class="c1"># load up the previously created private key</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;private.key&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">private_key_file</span><span class="p">:</span>
        <span class="n">entity1</span> <span class="o">=</span> <span class="n">Entity</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">private_key_file</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Loading private key...complete&#39;</span><span class="p">)</span>

    <span class="c1"># build the ledger API</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">LedgerApi</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8100</span><span class="p">)</span>

    <span class="c1"># create the smart contract</span>
    <span class="n">contract</span> <span class="o">=</span> <span class="n">SmartContract</span><span class="p">(</span><span class="n">CONTRACT_TEXT</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Deploying contract...&#39;</span><span class="p">)</span>

    <span class="c1"># deploy the contract to the network</span>
    <span class="n">api</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">contracts</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">entity1</span><span class="p">,</span> <span class="n">contract</span><span class="p">,</span> <span class="mi">2000</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Deploying contract...complete&#39;</span><span class="p">)</span>

    <span class="c1"># save the contract to the disk</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sample.contract&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">contract_file</span><span class="p">:</span>
        <span class="n">contract</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">contract_file</span><span class="p">)</span>
</pre></div>

<p>In <code>03_transfer.py</code> we load up the demo private key and the smart contract file. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember, the smart contract is now on the ledger and can be referenced with the correct hash.</p>
</div>
<p>We then perform a transfer using the contract code between the owner and a new user we create as <code>entity2</code>.</p>
<p><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># load up the previously created private key</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;private.key&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">private_key_file</span><span class="p">:</span>
        <span class="n">entity1</span> <span class="o">=</span> <span class="n">Entity</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">private_key_file</span><span class="p">)</span>

    <span class="c1"># load up the deployed contract</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;sample.contract&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">contract_file</span><span class="p">:</span>
        <span class="n">contract</span> <span class="o">=</span> <span class="n">SmartContract</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">contract_file</span><span class="p">)</span>

    <span class="c1"># for the purposes of this example create a second private key pair to transfer funds to</span>
    <span class="n">entity2</span> <span class="o">=</span> <span class="n">Entity</span><span class="p">()</span>

    <span class="c1"># build the ledger API</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">LedgerApi</span><span class="p">(</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8100</span><span class="p">)</span>

    <span class="c1"># print the current status of all the tokens</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;-- BEFORE --&#39;</span><span class="p">)</span>
    <span class="n">print_address_balances</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">contract</span><span class="p">,</span> <span class="p">[</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">])</span>

    <span class="c1"># transfer from one to the other using our newly deployed contract</span>
    <span class="n">tok_transfer_amount</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">fet_tx_fee</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">api</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="s1">&#39;transfer&#39;</span><span class="p">,</span> <span class="n">fet_tx_fee</span><span class="p">,</span> <span class="p">[</span><span class="n">entity1</span><span class="p">],</span> <span class="n">Address</span><span class="p">(</span><span class="n">entity1</span><span class="p">),</span> <span class="n">Address</span><span class="p">(</span><span class="n">entity2</span><span class="p">),</span>
                             <span class="n">tok_transfer_amount</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;-- AFTER --&#39;</span><span class="p">)</span>
    <span class="n">print_address_balances</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">contract</span><span class="p">,</span> <span class="p">[</span><span class="n">entity1</span><span class="p">,</span> <span class="n">entity2</span><span class="p">])</span>
</pre></div>
You should see a result like this:</p>
<div class="highlight"><pre><span></span>-- BEFORE --
Address0: <span class="m">8540</span>   bFET <span class="m">1000000</span>    TOK
Address1: <span class="m">0</span>      bFET <span class="m">0</span>          TOK

-- AFTER --
Address0: <span class="m">8508</span>   bFET <span class="m">999800</span>     TOK
Address1: <span class="m">0</span>      bFET <span class="m">200</span>        TOK
</pre></div>

<p><br/></p></article></div></div></main><footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../submitting_contract/" title="Hello world smart contract" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Hello world smart contract
              </span>
            </div>
          </a>
        
        
          <a href="../block-number/" title="Get block number" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Get block number
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://fetch.ai/" target=_blank>Fetch.AI &copy 2019</a>
        and the
        <a href="https://github.com/fetchai/docs/" target=_blank>
          Fetch.AI Documentation Suite</a>
      </div>
      
    </div>
  </div>
</footer></div><script src="../../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script></body></html>